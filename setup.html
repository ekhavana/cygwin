<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
  <title>Cygwin Package Contributors Guide</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 

<!--#include virtual="cygwin-header.html"-->

<h1 align=center>Cygwin Package Contributors Guide</h1>

<p>This document is intended for people who post packages to
sources.redhat.com, and thus need to make them available through the
standard Cygwin setup program.  This documents the syntax of the
setup.ini file, the program that automatically generates it on a regular
basis, the layout required for packages, and the related policies to
ensure good behaviour from the setup.exe program.</p> <p>Setup depends
on certain conventions being followed.  If they are not followed, bad
things may happen to the users of setup.exe.  Where a convention can be
ignored, should circumstances warrent, this document will specify
that.</p> <p>The mailing list cygwin-apps@cygwin.com is the correct
place to discuss any package creation or maintenance issues.  It is not
a place for end user bug reports - direct those to cygwin at cygwin dot
com instead.</p>
<h2>Contents</h2>
<ul>
  <li><p><a href="#naming">package naming</a></p></li>
  <li><p><a href="#sources.redhat.com">Sources.redhat.com</a></p></li>
  <li><p><a href="#setup.hint">setup.hint</a></p></li>
  <li><p><a href="#setup.ini">setup.ini</a></p></li>
  <li><p><a href="#package_contents">making packages</a></p></li>
  <li><p><a href="#postinstall">Creating a package postinstall script</a></p></li>
  <li><p><a href="#submitting">Submitting a package</a></p></li>
</ul>

<h2><a id="naming" name="naming">Package file naming</a></h2>
<p> Package naming scheme: use the vendor's version plus a suffix for
ports of existing packages (i.e.  bash 2.04 becomes 2.04-1, 2.04-2, etc,
until bash 2.05 is ported, which would be 2.05-1, etc).  Some packages
also use a YYMMDD format for their versions, e.g.  binutils-20010901-1.tar.bz2.
The first release of a package should have a -1 suffix.</p>

<p>A complete package currently consists of three files:</p>
<ul>
<li>a binary tar file
<li>a source tar file
<li>a setup.hint file
</ul>

<p>Binary tar files are named "package-version.tar.bz2".  They generally
contain the executable files that will be installed on a user's system
plus any auxilliary files needed by the package.  See the <a
href="#package_contents">making packages</a> section below for more
details on how to generate a binary tar file.</p>

<p>Source tar files are named "package-version-src.tar.bz2".  Source tar files
should contain the source files needed to rebuild the package.  While
installing these files is optional under setup.exe, the inclusion of a
source tar file is part of the totality that makes up a cygwin package
and so, these files are <em>not</em> optional.  See the <a
href="#package_contents"> making packages</a> section below for more
details on the contents of a -src tar file..</p>

<p>The setup.hint file is discussed <a href="#setup.hint">below</a>.

<h2><a id="sources.redhat.com" name="sources.redhat.com">Automatic setup.ini generation on sources.redhat.com</a></h2>

<p>A script runs on sources.redhat.com which collects information from
(currently) the <tt>latest</tt> and <tt>contrib</tt> directories in the
ftp download area.  Information from subdirectories of these directories
is parsed to automatically generate the default <a href="#setup.ini">
setup.ini</a> file which is used by the cygwin setup.exe program for
installation control.  If you are responsible for maintaining a cygwin
package, it is important that you understand how this process works.</p>

<p>Packages are grouped by directory under <tt>latest</tt> or
<tt>contrib</tt>.  The directory name is typically the same as the
package name.  For example, the <tt>boffo</tt> package will live in the
<tt>boffo</tt> subdirectory.  Exceptions to this rule are historical.
All new packages will follow the rule of package name == directory name.

<p>Each directory contains <a href="#naming">source and binary tar
files</a> which have been been compressed using bzip2.  The required <a
href="#naming">format of these filenames</a> is: <tt>package-version[<i>-src</i>].tar.bz2</tt> .
The contents of these files is discussed <a href="#package_contents">
below</a>.

<p>The "package" part of the filename is the name mentioned
above.</p>

<p>The version number <b>must</b> start with a digit and must adhere to
the rules in <a href="#naming">package file naming</a> above.  Higher
version numbers are used for the current version of a package; the
previous stable version (if any) is used for the previous version
(however see <a href="#setup.hint">setup.hint</a> for exceptions to
this rule).</p>

<p>The <i>-src</i> component of the filename is added to files which
contain source code.</p>

<p>A complete "package" is made up of three files: the "binary" package
tar file, the "source" tar file, and the "setup.hint" file, e.g.:

<pre>
bash$ ls contrib/boffo
boffo-1.0-1.tar.bz2  boffo-1.0-1-src.tar.bz2  setup.hint
</pre>

<p>Setup is currently unable to list more than three versions of each
package.  Therefore you should not keep more than three versions of each
package around: The current version, the previous stable version, and,
optionally, one test version.  By keeping a previous stable version
around, you isolate yourself (somewhat) from problems with partial
mirrors.  When you add a new "current" version, you can either keep the
old "previous" version, or make the old current version the new previous
version, depending on how stable they each were.</p>

<p>Test versions are specified via the setup.hint file as described <a
href="#setup.hint">below</a>.  It is not required that your package have
a <tt>test</tt> version.  Use of a <tt>test</tt> version of a package is
at the discretion of the package maintainer.

<p>Note that currently some files in the distribution are gzipped.  Use of
gzip for file compression is deprecated, however.  New package
submissions must be bzip2'ed.</p>

<h2><a id="setup.hint" name="setup.hint"><tt>setup.hint</tt></a></h2>

<p>Each package must be submitted with a file called <tt>setup.hint</tt>.  This
file is used for information that cannot be inferred just from the
context of the file name or package name. Lines in <tt>setup.hint</tt>
will consist of one of the following:

<pre>
# comment
@ <i>package</i>
sdesc: <i>"some text"</i>
ldesc: <i>"some text"</i>
skip:
curr: <i>version</i>
prev: <i>version</i>
test: <i>version</i>
category: <i>name1[ name2...]</i>
requires: <i>package[ package...]</i>
</pre>

<p>(You may see some older setup.hint files which lack the colons after
the introducing field.  This usage is allowed but deprecated.  Please
use colons in your setup.hint for everything but '#' and "@'.)</p>

<p>Lines that begin with '#' are considered to be comments and are ignored
by the setup.ini generator.</p>

<p>A line that begins with a "<tt>@</tt>" behaves similarly to the
setup.ini field (<a href="#setup.ini">see below</a>).  It overrides the
package name for the enclosing directory.  This is an optional entry.
It is intended only for historical packages where the package name is
different from the name of the directory in which the package resides.  This
should not be necessary for "modern" setup.hint files.</p>

<p>The <tt>curr</tt>,<tt> prev</tt>, and <tt>test</tt> lines indicate
which versions should be used for which sections of that package.  Use
these settings <em>only</em> if you need to circumvent the normal
intuitive version numbering scheme.</p>

<p>Use of <tt>curr</tt> and <tt>prev</tt> is usually not required since
the setup.ini generator does a good job of figuring out version number
ordering.  So, e.g., if you had previously released <tt>boffo-0.9-1</tt>
and now have a new <tt>boffo-1.0-1</tt>, the version numbering is
obvious and there is no need to use <tt>curr</tt> or <tt>prev</tt>.  It
is obvious that <tt>boffo-1.0-1</tt> is newer than <tt>boffo-0.9-1</tt> and the setup.ini
generator will do the right thing in this case.</p>

<p>However, if you had discovered a serious error in the <tt>boffo-1.0</tt>
release, and then decided that you want to drop back to <tt>boffo-0.9-1</tt>, you
could include entries like this:

<pre>
<tt>prev: 1.0-1
curr: 0.9-1</tt>
</pre>

This usage should be rare, however.

<p>In general, you should trust the automatic setup.ini generator to "do
the right thing" -- with one exception.  If you decide that you need to
release a <i>test</i> version of your package, there is no way for the
setup.ini generator to know that.</p>

<p>So, you will have to put something like "<tt>test: 1.9-1</tt>" in
your setup.hint file.  This will cause setup.exe to characterize the
1.9-1 version as a "test" package.  With the current setup.exe
implementation, it will also mean that it will be overlooked by most
people during installation.  So, unless you have made arrangements to
advertise your test release, this option should be used sparingly.</p>

<p>Note that if any of the <tt>curr</tt>, <tt>prev</tt>, or <tt>test</tt>
options are used, they will short circuit <em>all</em> of the
automatic version detection used for generating setup.ini.  So, if you
include a <tt>test</tt> option, and you have valid current and/or
previous tar files, you <em>must</em> specify <tt>curr</tt> and/or
<tt>prev</tt>.  Otherwise, the <b>only</b> version that setup.exe will
display will be the <tt>test</tt> version.</p>

<p>For example, if your setup.hint looks like this:</p>

<pre>
<tt>test: 1.9-1</tt>
</pre>

then setup.ini will not contain the 0.9-1 or 1.0-1 versions.

<p>If you want all of the versions included, you must do this:</p>

<pre>
<tt>prev: 0.9-1
curr: 1.0-1
test: 1.9-1</tt>
</pre>

<p>The <tt>skip</tt> line indicates that that package should not appear in
setup.ini.  It is intended for directories that exist in the hierarchy that
should not be considered for inclusion in setup.ini.</p>

<p><tt>sdesc</tt> and <tt>ldesc</tt> are both mandatory fields for
setup.hint.  Your package <em>must</em> contain these fields.  In particular,
the <tt>sdesc</tt> field is required for correct operation of setup.exe.

<p><tt>sdesc</tt> is a one line description of the package.  This is the
information that will be displayed when installing packages via
setup.exe.</p>

<p><tt>ldesc</tt> is a more descriptive, multi-line description of the
package, intended for future use in setup.exe.</p>

Please note that the package name should <em>not</em> be part of the
description, e.g., this is incorrect:

<pre>
<tt>sdesc:	"boffo: A whackamole simulation in ASCII art"</tt>
</pre>

This is correct:

<pre>
<tt>sdesc:	"A whackamole simulation in ASCII art"</tt>
</pre>

<p>Quote text that takes up several lines e.g.:</p>
<pre>
ldesc: "A whackamole simulation in ASCII art.
Intended for use on VT100 terminals at BAUD rates 1200 and
above.  Uses arrow keys for positioning over moles.  Space
bar whacks the mole.

No actual moles will be harmed during execution of this game."
</pre>

<p>The <tt>category</tt> line indicates the categories that this package belongs
to.  One package can belong to multiple categories.  Multiple categories
are separated by spaces.</p>
<p>Do no enclose multiple category names within quotation marks.</p>

<p>Please do not invent a new category without checking with the cygwin-apps
mailing list first.  As of this writing, the current categories are:</p>
<table width="50%" align=center>
<tr>
<td>Admin</td>
<td>Archive</td>
<td>Base</td>
<td>Database</td>
<td>Devel</td>
</tr>
<tr>
<td>Doc</td>
<td>Editors</td>
<td>Games</td>
<td>Graphics</td>
<td>Interpreters</td>
</tr>
<tr>
<td>Libs</td>
<td>Mail</td>
<td>Math</td>
<td>Net</td>
<td>Shells</td>
</tr>
<tr>
<td>System</td>
<td>Text</td>
<td>Utils</td>
<td>Web</td>
</tr>
</table>

<p>As you can see, currently, all categories consist of only a single
word.  We don't anticipate that this will change anytime soon.  However,
with the use of quotes, setup.exe will understand category names which
contain spaces, for example:</p><pre><tt>category: "ASCII Games"</tt></pre></p>

<p>The above would place a package in a single category called "ASCII Games"
rather than two categories "ASCII" and "Games".</p>

<p>The <tt>requires</tt> line indicates the packages that this package
relies on.  If your package is dependent on a file provided by another
package that other package should be included here.  The requires
field may be missing or empty if your package truly does not require any
other package.</p>

<p>A package will probably require the <tt>cygwin</tt> package if it
contain any DLLs or executable files since the <tt>cygwin</tt> package
contains <tt>cygwin1.dll</tt>, which is required for most programs.
However, the <tt>cygwin</tt> package would not be a required dependency
for a package which contained only text files, as is the case with, for
example, packages that consist entirely of man pages.</p>

<p>A package can rely on multiple other packages.  Hierarchical
dependencies should work correctly, however, it is best to always
include specific dependencies, i.e., don't drop '<tt>bar</tt>' from your
dependency list if your package requires it, even if you are including
'<tt>foo</tt>' which relies on '<tt>bar</tt>'.</p>

<p>Conversely, do not include package dependencies of <em>dependent</em>
packages in your dependency list.  If you think that another package has
an incorrect dependency list, send email to cygwin-apps noting that
fact.</p>

<p>Multiple packages are separated by spaces.  Do not enclose multiple
package names within quotation marks.</p>

<p>Here's an example of a complete <i>contrib/current/boffo/setup.hint</i>:</p>
<pre>
<tt>
    category: Games Text
    requires: libncurses6 cygwin
    sdesc:    "A whackamole simulation in ASCII art"
    ldesc:    "A whackamole simulation in ASCII art.
    Intended for use on VT100 terminals at BAUD rates 1200 and
    above.  Uses arrow keys for positioning over moles.  Space
    bar whacks the mole.

    No actual moles will be harmed during execution of this game."
</tt>
</pre>

<p>Notice that we didn't use the <tt>prev</tt>, <tt>curr</tt>,
<tt>test</tt>, or <tt>@</tt> options.  Instead, we relied on the
automatic setup.ini generator to do as much as possible for us.</p>

<h2><a id="setup.ini" name="setup.ini"><tt>setup.ini</tt></a></h2>

<p>Note that <tt>setup.ini</tt> is automatically generated.  This
section is for completeness, not instruction.

<p>Setup reads a file called <tt>setup.ini</tt> that resides on all
cygwin FTP mirrors.  There are a two global parameters in this file,
followed by a list of packages.  Any line beginning with<tt> # </tt> is
ignored by setup and can be used to add commentary to the file at any
point.

<p><tt>setup-timestamp: <i>number</i></tt></p>

This line is at the beginning of all setup.ini files.  It indicates
the time that the setup.ini file was created.  Its only purpose is to
warn the user when the timestamp is <em>less</em> than the last
setup.ini used; i.e. it prevents accidental regression.  Use "perl -e
'print time'" to get a timestamp.

<p><tt>setup-version: <i>number</i></tt></p>

This line follows the setup-timestamp in all setupl.ini files.  It
indicates the version number of the setup.exe for which this setup.ini
was generated.

<p><tt>@ <i>package</i></tt></p>

Lines beginning with the "at" symbol indicate the start of a package
section.  Each package consists of a name, one or more descriptive
texts, package categories, package requirements, and up to three version
definitions.

<p><tt>sdesc: <i>"some text"</i></tt></p>

This is the "short description" of the package.  This text, if
available, accompanies the package name in package listings.

<p><tt>ldesc: <i>"some text"</i></tt></p>

This is the "long description" of the package.  This text, if
available, is used as a supplimental description of the package.

<p><tt>category: <i>name1[ name2...]</i></tt></p>

The category line indicates the categories that this package belongs to.
One package can belong to multiple categories.  Multiple categories are
separated by spaces.  See the description of categories in setup.hint
above for more information on categories.

<p><tt>requires: <i>package[ package...]</i></tt></p>

The requires line indicates the packages that this package belongs to.  A
package can rely on multiple packages.  Multiple packages are separated
by spaces.

<p><tt>[curr]<br>[prev]<br>[test]</tt></p>

These indicate the start of a version description within a package.
Note that<tt> [curr] </tt> is the default and may be omitted if that
version happens to be specified before the others.  "Curr" indicates
the current stable (preferred) version, "prev" is the previous stable
version, and "test" indicates a test or experimental version.

<p><tt>version: <i>version</i></tt></p>

Indicates the version of the package.  This is currently derived from
the <a href="#naming">name of the package</a>.

<p><tt>install: <i>filename</i> <i>size-in-bytes</i></tt></p>

Indicates the file to install for that version, and its size in bytes.
The file name must include the full path (relative to setup.ini's
directory), and the file size must match the actual file size (setup
uses this to verify it got the whole file).

<p><tt>source: <i>filename</i> <i>size-in-bytes</i></tt></p>

Like the file to install, this is the corresponding sources.

<h3>Example</h3>

<pre>
setup-timestamp: 967844652

@ cygwin
sdesc: Cygwin Runtime
ldesc: A Posix runtime emulator for Windows platforms
version: 1.1.4
install: latest/cygwin/cygwin-1.1.4.tar.bz2 1234567
source: latest/cygwin/cygwin-1.1.4.tar.bz2 1341245
[prev]
version: 1.1.3
install: latest/cygwin/cygwin-1.1.3.tar.bz2 1234580
source: latest/cygwin/cygwin-1.1.3.tar.bz2 1341123

@ bash
[test]
version: 20000901
install: latest/bash/bash-20000901.tar.bz2 276403
source:  latest/bash/bash-20000901-src.tar.bz2 1892899
[curr]
version: 2.04
install: latest/bash/bash-2.04.tar.bz2 277375
source:  latest/bash/bash-2.04-src.tar.bz2 1815177

</pre>

<h2><a id="package_contents" name="package_contents">Making Packages</a></h2>
<p>The files paths within both the -src and the binary package files are
quite important.  Since setup.exe extracts into a predetermined
directory, you must structure your package contents accordingly.</p>
<p>The following requirements avoid problems that have occured in the past with packages. Thus only skip them if you *know* your package will not recreate that prior problem.</p>
<ul>
  <li>Binary packages are extracted in /, include all file paths from
  the root in your archive, e.g.:<pre><tt>  usr/bin/boffo.exe
  usr/share/boffo/boffo.dat
  etc...</tt></pre></li>
  <li>The package is configured using (at a minimum) the following paths:
  <pre>  --prefix=/usr
  --sysconfdir=/etc
  --libexecdir='$(sbindir)'
  --localstatedir=/var
  --datadir='$(prefix)/share'</pre></li>
  <li><p>All executables in your binary package are stripped (run 'strip' on them). Some makefiles have a install-strip command you can use to do this automatically when you setup your 'installed' tree.</p></li>
  <li><p>Source packages are extracted in /usr/src.  On extraction, the tar file should put the sources in a directory with the same name as the package tar ball minus the -src.tar.bz2 part:<pre><tt>  boffo-1.0-1/Makefile.in
  boffo-1.0-1/README
  boffo-1.0-1/configure
  boffo-1.0-1/configure.in
  etc...
</tt></pre></li>

  <li><p>In your binary package, include a file /usr/doc/Cygwin/foo-vendor-suffix.README containing (at a minimum) the information needed for an end user to recreate the package. This includes CFLAGS settings, configure parameters, etc.</p></li>
  <li><p>In your binary package include a directory /usr/doc/foo-vendor/ that includes any binary-relevant vendor documentation, such as ChangeLog's, copyright licence's, README's etc.</p></li>
  <li><p>In your source package include the same foo-vendor-suffix.README as used in the binary package.</p></li>
  <li><p>Your source package should contain any patches you've applied to it pre-applied.</p></li>
  <li><p>Include a single file foo-vendor-suffix.patch in your source package, that when applied will remove all the patches you've applied to the package, leaving it as the vendor distributes it. This file should extract as /usr/src/foo-vendor-suffix.patch.<p><p>To create such a patch you might run <tt>diff -Nrup patched-src-dir vendor-src-dir &gt; foo-vendor-suffix.patch</tt></p><p>To apply the generated patch the user would run (from within the source tree) <tt>patch -p1 &lt; ../foo-vendor-suffix.patch</tt></p></li>
  <li><p>If you are not creating your package from an installed virtual root, be sure to check that the file permissions are appropriate.</p></li>
  <li><p>If you have any 'info' documention in your package, run install-info as part of your post-install script</p></li>
  <li><p>If the package has any global settings (ie in files in /etc) that are not overrideable on a per user basis (sshd, as a daemon, is an example of this) do not include the relevant config files in your package. Instead include in your post-install script to install the settings files. Be sure that if you would overwrite an already present file that the user is offered the choice of keeping their own or overwriting with your defaults.</p></li>
  <li><p>Ensure that your package handles binary only systems, textmode only systems, and hybrid systems correctly.</p></li>
</ul>

<h2><a id="postinstall" name="postinstall">Creating a package postinstall script</a></h2>

<p>If your package requires certain commands to be executed after the
files in the package are installed, include them in a file in the
package called /etc/postinstall/<var>package</var>.sh or
/etc/postinstall/<var>package</var>.bat.</p>

<p>If the file's name ends in ".sh", it is executed with the Cygwin
shell; if it ends in ".bat", it is executed with the DOS command
interpreter.  If it doesn't end with either of these suffixes, it is
ignored.</p>

<p>After the script has been run it is renamed by appending the suffix
".done" to its previous name, to prevent it from being run again the
next time the user runs the setup program.</p>

<p>Note that the setup program runs all the postinstall scripts after
all desired packages have been installed, that is, it does not run
each package's postinstall script immediately after installing that
package.  Note, furthermore, that the order in which the scripts are
run is not guaranteed.  Therefore, if your package depends on others
which have their own postinstall scripts, you cannot assume in your
script that the other packages' scripts have already been run.</p>

<h2><a id="submitting" name="submitting">Submitting a package</a></h2>
<p>So you've got a package you want to submit. Follow the following checklist before emailing cygwin-apps@cygwin.com and you'll almost certainly save time.</p>
<ol>
  <li><p>Propose on cygwin-apps@cygwin.com that you are interested in becoming a package maintainer for package foo. Some packages cannot be distributed via cygwin's setup due to vendor licence limitations. Other packages may not be appropriate for cygwin. This step will save time if, for some reason we cannot accept the package.</p></li>
  <li>If this is a new package, <b>post a complete <tt>setup.hint</tt> file as part of your proposal</b>.  Include this file in the text of your message so that it can be commented on.  Do not submit it as an attachment.</li>
  <li><p>Do you have the time to maintain the package? Packages without active maintainers are pulled from the distribution. Generally speaking the time commitment is relatively low, simply subscribe to cygwin at cygwin dot com (digest mode is fine) and when a <i>bug</i> is reported in your package, address the bug (if it's a cygwin-only bug) or pass back to the vendor. When a solution exists, create an updated package with the fix in it, and upload that. Note that you are not expected to be a helpdesk for the package - the users are pointed back at the vendors lists, once you've determined that the bug is not a cygwin-related bug.</p></li>
  <li><p>Look in the debian package list and identify the section that your package is present in there - if it's available via debian. If it's not, have a look and take a sensible guess.</p></li>
  <li><p>Create setup.hint file following the documentation on this web page.  Opinion on whether to mark your initial version as a <tt>Test</tt> version is currently mixed. If you have doubts about the stability of your initial offering you may decide to mark it as <tt>Test</tt>.  Then, once the package has no major bug reports from users, a current package may be introduced.  Otherwise, it is perfectly acceptable to forgo the <tt>Test</tt> designation in your first release.</p></li>
  <li><p>If possible, place the package files in a web accessible http/ftp site somewhere.</p></li>
  <li><p>Announce on cygwin-apps@cygwin.com that you have the package ready for uploading, and Robert Collins will contact you to get access to the package files, which he'll then upload to sources.redhat.com for you.</p></li>
  <li><p>Delete your temporary copy once they have been uploaded to sources.redhat.com.</p></li>
  <li><p>Announce via cygwin-announce@cygwin.com that the new package, is available for experimentation. Use a recent cygwin-announce message from one of the core maintainers as a template for your announcement.</p><p>Once sent, your message will be reviewed by one of the cygwin-announce moderators and, once approved, will be automatically forwarded to the cygwin mailing list with an [ANNOUNCEMENT] prepended to the subject.</p></li>
</ol>
<p>NOTE: On any major version upgrade, you may want to mark the release as <tt>Test</tt>.
<!--#include virtual="cygwin-footer.html"-->
