<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
  <title>Cygwin Package Contributor's Guide</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 

<!--#include virtual="cygwin-header.html"-->

<h1 align=center>Cygwin Package Contributor's Guide</h1>

<p>This document is intended for people who post packages to
sourceware.org, and thus need to make them available through the
standard Cygwin setup program.  This documents the syntax of the
setup.hint file, the program that automatically generates it on a regular
basis, the layout required for packages, and the related policies to
ensure good behaviour from the setup.exe program.</p> <p><a href="http://sourceware.org/cygwin-apps/setup.html">Setup.exe</a> depends
on certain conventions being followed.  If they are not followed, bad
things may happen to the users of setup.exe.  Where a convention can be
ignored, should circumstances warrent, this document will specify
that. Setup.exe has it's own homepage <a href="http://sourceware.org/cygwin-apps/setup.html">http://sourceware.org/cygwin-apps/setup.html</a>. If you are interested in adding features to setup.exe, or in manually creating a setup.ini file, you should consult the setup.exe homepage.</p>
<p>The mailing list cygwin-apps@cygwin.com is the correct place to discuss any package creation or maintenance issues.  It is not a place for end user bug reports - direct those to cygwin at cygwin dot com instead.</p>
<h2>Contents</h2>
<ul>
  <li><p><a href="#naming">package naming</a></p></li>
  <li><p><a href="#sourceware.org">Sources.redhat.com</a></p></li>
  <li><p><a href="#setup.hint">setup.hint</a></p></li>
  <li><p><a href="http://sourceware.org/cygwin-apps/setup.html#setup.ini">setup.ini</a></p></li>
  <li><p><a href="#package_contents">making packages</a></p></li>
  <li><p><a href="#postinstall">Creating a package postinstall script</a></p></li>
  <li><p><a href="#submitting">Submitting a package</a></p></li>
</ul>

<h2><a id="naming" name="naming">Package file naming</a></h2>
<p> Package naming scheme: use the vendor's version plus a release suffix for
ports of existing packages (i.e.  bash 2.04 becomes 2.04-1, 2.04-2, etc,
until bash 2.05 is ported, which would be 2.05-1, etc).  Some packages
also use a YYMMDD format for their versions, e.g.  binutils-20010901-1.tar.bz2.
The first release of a package should have a -1 release suffix.</p>

<p>A complete package currently consists of three files:</p>
<ul>
<li>a binary tar file
<li>a source tar file
<li>a setup.hint file
</ul>

<p>Binary tar files are named "package-version-release.tar.bz2".  They generally
contain the executable files that will be installed on a user's system
plus any auxilliary files needed by the package.  See the <a
href="#package_contents">making packages</a> section below for more
details on how to generate a binary tar file.</p>

<p>Source tar files are named "package-version-release-src.tar.bz2".  Source tar files
should contain the source files needed to rebuild the package.  While
installing these files is optional under setup.exe, the inclusion of a
source tar file is part of the totality that makes up a cygwin package
and so, these files are <em>not</em> optional.  In some cases, there 
may be multiple packages generated from the same source; for instance,
one might have a "boffo" package and its associate shared library in
"libboffo7", where both are generated from the same -src tarball.  See the <a
href="#srcpackage_contents"> making packages</a> section below for more
details on the contents of a -src tar file, and the <a href="#setup.hint">setup.hint</a>
section for information on the "external-source:" option.</p>

<p>The setup.hint file is discussed <a href="#setup.hint">below</a>.

<h2><a id="sourceware.org" name="sourceware.org">Automatic setup.ini generation on sourceware.org</a></h2>

<p>A script runs on sourceware.org which collects information from
(currently) the <tt>release</tt> directory in the
ftp download area.  Information from subdirectories of these directories
is parsed to automatically generate the default <a href="http://sourceware.org/cygwin-apps/setup.html#setup.ini">
setup.ini</a> file which is used by the cygwin setup.exe program for
installation control.  If you are responsible for maintaining a cygwin
package, it is important that you understand how this process works.</p>

<p>Packages are grouped by directory under <tt>release</tt>.  The directory
name is the same as the package name.  For example, the <tt>boffo</tt> package
will live in the <tt>boffo</tt> subdirectory.  Exceptions to this rule are
historical. All new packages will follow the rule of package name ==
directory name.  However, for closely related groups of packages, it is acceptable
to use a heirarchical tree under <tt>release/</tt>:
<pre><tt>
  release/
  release/boffo/
  release/boffo/&lt;boffo files&gt;
  release/boffo/boffo-devel/
  release/boffo/boffo-devel/&lt;boffo-devel file&gt;
</tt></pre>

<p>Each directory contains <a href="#naming">source and binary tar
files</a> which have been been compressed using bzip2.  The required <a
href="#naming">format of these filenames</a> is:
<tt>package-version-release[<i>-src</i>].tar.bz2</tt> .
The contents of these files is discussed <a href="#package_contents">
below</a>.

<p>The "package" part of the filename is the name mentioned
above.</p>

<p>The version number <b>must</b> start with a digit and must adhere to
the rules in <a href="#naming">package file naming</a> above.  Higher
version (and release) numbers are used for the current version of a
package; the previous stable version (if any) is used for the
previous version (however see <a href="#setup.hint">setup.hint</a> for
exceptions to this rule).  Lexically, when two packages have identical vendor
version numbers, the one with the higher release number is considered
newer.  Also, given two packages, the one with the higher vendor version
number is always considered newer, regardless of the release number.</p>

<p>The <i>-src</i> component of the filename is added to files which
contain source code.</p>

<p>A complete "package" is made up of three files: the "binary" package
tar file, the "source" tar file, and the "setup.hint" file, e.g.:

<pre>
bash$ ls release/boffo
boffo-1.0-1.tar.bz2  boffo-1.0-1-src.tar.bz2  setup.hint
</pre>

<p>Setup is currently unable to list more than three versions of each
package.  Therefore you should not keep more than three versions of each
package around: The current version, the previous stable version, and,
optionally, one test version.  By keeping a previous stable version
around, you isolate yourself (somewhat) from problems with partial
mirrors.  When you add a new "current" version, you can either keep the
old "previous" version, or make the old current version the new previous
version, depending on how stable they each were.</p>

<p>Test versions are specified via the setup.hint file as described <a
href="#setup.hint">below</a>.  It is not required that your package have
a <tt>test</tt> version.  Use of a <tt>test</tt> version of a package is
at the discretion of the package maintainer.

<p>Note that currently some files in the distribution are gzipped.  Use of
gzip for file compression is deprecated, however.  New package
submissions must be bzip2'ed.</p>

<h2><a id="setup.hint" name="setup.hint"><tt>setup.hint</tt></a></h2>

<p>Each package must be submitted with a file called <tt>setup.hint</tt>.  This
file is used for information that cannot be inferred just from the
context of the file name or package name. Lines in <tt>setup.hint</tt>
will consist of one of the following:

<pre>
# comment
@ <i>package</i>
sdesc: <i>"some text"</i>
ldesc: <i>"some text"</i>
skip:
curr: <i>version</i>
prev: <i>version</i>
test: <i>version</i>
category: <i>name1[ name2...]</i>
requires: <i>package[ package...]</i>
external-source: <i>package</i>
</pre>

<h3>Note: Not all of the above setup.hint lines are required.  Please read
the text below for further details on the above lines.</h3>

<p>(You may see some older setup.hint files which lack the colons after
the introducing field.  This usage is allowed but deprecated.  Please
use colons in your setup.hint for everything but '#' and "@'.)</p>

<p>Lines that begin with '#' are considered to be comments and are ignored
by the setup.ini generator.</p>

<p>A line that begins with a "<tt>@</tt>" behaves similarly to the
setup.ini field (<a href="http://sourceware.org/cygwin-apps/setup.html#setup.ini">see below</a>).  It overrides the
package name for the enclosing directory.  This is an optional entry.
It is intended only for historical packages where the package name is
different from the name of the directory in which the package resides.  This
should not be necessary for "modern" setup.hint files.</p>

<p>The <tt>curr</tt>,<tt> prev</tt>, and <tt>test</tt> lines indicate
which versions should be used for which sections of that package.  Use
these settings <em>only</em> if you need to circumvent the normal
intuitive version numbering scheme.</p>

<p>Use of <tt>curr</tt> and <tt>prev</tt> is usually not required since
the setup.ini generator does a good job of figuring out version number
ordering.  So, e.g. if you had previously released <tt>boffo-0.9-1</tt>
and now have a new <tt>boffo-1.0-1</tt>, the version numbering is
obvious and there is no need to use <tt>curr</tt> or <tt>prev</tt>.  It
is obvious that <tt>boffo-1.0-1</tt> is newer than <tt>boffo-0.9-1</tt> and
the setup.ini generator will do the right thing in this case.</p>

<p>However, if you had discovered a serious error in the <tt>boffo-1.0</tt>
release, and then decided that you want to drop back to <tt>boffo-0.9-1</tt>, you
could include entries like this:

<pre>
<tt>prev: 1.0-1
curr: 0.9-1</tt>
</pre>

This usage should be rare, however.

<p>In general, you should trust the automatic setup.ini generator to "do
the right thing" -- with one exception.  If you decide that you need to
release a <i>test</i> version of your package, there is no way for the
setup.ini generator to know that.</p>

<p>So, you will have to put something like "<tt>test: 1.9-1</tt>" in
your setup.hint file.  This will cause setup.exe to characterize the
1.9-1 version as a "test" package.  With the current setup.exe
implementation, it will also mean that it will be overlooked by most
people during installation.  So, unless you have made arrangements to
advertise your test release, this option should be used sparingly.</p>

<p>Note that if any of the <tt>curr</tt>, <tt>prev</tt>, or <tt>test</tt>
options are used, they will short circuit <em>all</em> of the
automatic version detection used for generating setup.ini.  So, if you
include a <tt>test</tt> option, and you have valid current and/or
previous tar files, you <em>must</em> specify <tt>curr</tt> and/or
<tt>prev</tt>.  Otherwise, the <b>only</b> version that setup.exe will
display will be the <tt>test</tt> version.</p>

<p>For example, if your setup.hint looks like this:</p>

<pre>
<tt>test: 1.9-1</tt>
</pre>

then setup.ini will not contain the 0.9-1 or 1.0-1 versions.

<p>If you want all of the versions included, you must do this:</p>

<pre>
<tt>prev: 0.9-1
curr: 1.0-1
test: 1.9-1</tt>
</pre>

<p>The <tt>skip</tt> line indicates that that package should not appear in
setup.ini.  It is intended for directories that exist in the hierarchy that
should not be considered for inclusion in setup.ini.</p>

<p><tt>sdesc</tt> is a mandatory field for setup.hint.  Your package
<em>must</em> contain this field.  The <tt>sdesc</tt> field is required
for correct operation of setup.exe.

<p><tt>sdesc</tt> is a one line description of the package.  This is the
information that will be displayed when installing packages via
setup.exe.</p>

<p><tt>ldesc</tt> is a more descriptive, multi-line description of the
package, intended for future use in setup.exe.</p>

Please note that the package name should <em>not</em> be part of the
description, e.g. this is incorrect:

<pre>
<tt>sdesc:      "boffo: A whackamole simulation in ASCII art"</tt>
</pre>

This is correct:

<pre>
<tt>sdesc:      "A whackamole simulation in ASCII art"</tt>
</pre>

<p>Quote text that takes up several lines e.g.:</p>
<pre>
ldesc: "A whackamole simulation in ASCII art.
Intended for use on VT100 terminals at BAUD rates 1200 and
above.  Uses arrow keys for positioning over moles.  Space
bar whacks the mole.

No actual moles will be harmed during execution of this game."
</pre>

<p>The <tt>category</tt> line indicates the categories that this package belongs
to.  One package can belong to multiple categories.  Multiple categories
are separated by spaces.</p>
<p>Do not enclose multiple category names within quotation marks.</p>

<p>Please do not invent a new category without checking with the cygwin-apps
mailing list first.  As of this writing, the current categories are:</p>
<table width="50%" align=center>
<tr>
<td>Admin</td>
<td>Archive</td>
<td>Base</td>
<td>Comm</td>
<td>Database</td>
</tr>
<tr>
<td>Devel</td>
<td>Doc</td>
<td>Editors</td>
<td>Games</td>
<td>Gnome</td>
</tr>
<tr>
<td>Graphics</td>
<td>Interpreters</td>
<td>Libs</td>
<td>Mail</td>
<td>Math</td>
</tr>
<tr>
<td>Mingw</td>
<td>Net</td>
<td>Publishing</td>
<td>Science</td>
<td>Shells</td>
</tr>
<td>Sound</td>
<td>System</td>
<td>Text</td>
<td>Utils</td>
<td>Web</td>
<td>X11</td>
</tr>
</table>

<p>As you can see, currently, all categories consist of only a single
word.  We don't anticipate that this will change anytime soon.  However,
with the use of quotes, setup.exe will understand category names which
contain spaces, for example:</p><pre><tt>category: "ASCII Games"</tt></pre></p>

<p>The above would place a package in a single category called "ASCII Games"
rather than two categories "ASCII" and "Games".</p>

<p>The <tt>requires</tt> line indicates the packages that this package
relies on.  If your package is dependent on a file provided by another
package that other package should be included here.  The requires
field may be missing or empty if your package truly does not require any
other package.</p>

<p>A package will probably require the <tt>cygwin</tt> package if it
contain any DLLs or executable files since the <tt>cygwin</tt> package
contains <tt>cygwin1.dll</tt>, which is required for most programs.
However, the <tt>cygwin</tt> package would not be a required dependency
for a package which contained only text files, as is the case with, for
example, packages that consist entirely of man pages.</p>

<p>A package can rely on multiple other packages.  Hierarchical
dependencies should work correctly, however, it is best to always
include specific dependencies, i.e. don't drop '<tt>bar</tt>' from your
dependency list if your package requires it, even if you are including
'<tt>foo</tt>' which relies on '<tt>bar</tt>'.</p>

<p>Conversely, do not include package dependencies of <em>dependent</em>
packages in your dependency list.  If you think that another package has
an incorrect dependency list, send email to cygwin-apps noting that
fact.</p>

<p>Multiple packages are separated by spaces.  Do not enclose multiple
package names within quotation marks.</p>

<p>Here's an example of a complete <i>release/boffo/setup.hint</i>:</p>
<pre>
<tt>
    category: Games Text
    requires: libncurses6 cygwin
    sdesc:    "A whackamole simulation in ASCII art"
    ldesc:    "A whackamole simulation in ASCII art.
    Intended for use on VT100 terminals at BAUD rates 1200 and
    above.  Uses arrow keys for positioning over moles.  Space
    bar whacks the mole.

    No actual moles will be harmed during execution of this game."
</tt>
</pre>

<p>Notice that we didn't use the <tt>prev</tt>, <tt>curr</tt>,
<tt>test</tt>, or <tt>@</tt> options.  Instead, we relied on the
automatic setup.ini generator to do as much as possible for us.</p>

<h3><a id="advanced_setup.hint" name="advanced_setup.hint"><tt>setup.hint (Advanced Options)</tt></a></h3>


<p>The <tt>external-source</tt> line is used when multiple installation 
packages are generated from a single -src package.  For example, suppose
the <tt>boffo</tt> package contains the executables and documentation for 
boffo, but there is also a shared library <tt>cygboffo-7.dll</tt> that 
might be used by other packages; say, the <tt>fobbo</tt> program.  It 
would be nice to separate that <tt>cygboffo-7.dll</tt> shared library 
into a second installation package, so that users of the <tt>fobbo</tt>
program can install <em>just</em> the library, and not the entire 
<tt>boffo</tt> package.  However, all of the <tt>boffo</tt> executables 
and the DLL are generated from the same source.  To support this usage,
the <tt>boffo</tt> maintainer would create three packages:</p>

<UL>
<LI><tt>boffo-2.4.1-2.tar.bz2</tt>: an installable package that contains
all of the normal contents of <tt>boffo</tt> -- except for the shared library.
<LI><tt>libboffo7-2.4.1-2.tar.bz2</tt>: an installable package that contains
only the shared library from <tt>boffo</tt>
<LI><tt>boffo-2.4.1-2-src.tar.bz2</tt>: the -src tarball for boffo.
</UL>

<p><tt>boffo-2.4.1-2.tar.bz2</tt>, <tt>boffo-2.4.1-2-src.tar.bz2</tt>,
and the boffo <tt>setup.hint</tt> 
would go into the <tt>release/boffo/</tt> subdirectory on the cygwin 
server.  <tt>libboffo7-2.4.1-2.tar.bz2</tt> would go into a separate 
subdirectory, such as <tt>release/boffo/libboffo7/</tt>, along with
a separate libboffo7 <tt>setup.hint</tt>.  The two <tt>setup.hint</tt>
files would look something like this:</p>

<center>
<table border=2 >
<tr>
<td><center><tt>boffo</tt> setup.hint</center></td>
<td><center><tt>libboffo7</tt> setup.hint</center></td>
</tr>
<tr>
<td>
<tt>category: Games Text</tt><br>
<tt>requires: libboffo7 libncurses6 cygwin</tt><br> 
<tt>sdesc: "A whackamole simulation in ASCII art"</tt><br>
<tt>ldesc: "A whackamole simulation in ASCII art.
<tt>Intended for use on VT100 terminals at BAUD rates 1200 and
<tt>above.  Uses arrow keys for positioning over moles.  Space
<tt>bar whacks the mole.<br><br>
<tt>No actual moles will be harmed during execution of this game."</tt><br>
</td>
<td>
<tt>category: Games Text</tt><br>
<tt>requires: cygwin</tt><br>
<tt><b>external-source: boffo</b></tt><br>
<tt>sdesc: "Runtime library for a whackamole simulation in ASCII art"</tt><br>
<tt>ldesc: "A whackamole simulation in ASCII art.
<tt>Intended for use on VT100 terminals at BAUD rates 1200 and
<tt>above.  Uses arrow keys for positioning over moles.  Space
<tt>bar whacks the mole.<br><br>
<tt>No actual moles will be harmed during execution of this game."</tt><br>
</td>
</tr>
</table>
</center>

<p>The setup.ini generated from these setup.hint files will include these lines
(only relevant lines shown):</p>
<pre></tt>
@ boffo
requires: libboffo7 libncurses6 cygwin
version: 2.4.1-2
install: release/boffo/boffo-2.4.1-2.tar.bz2
source: release/boffo/boffo-2.4.1-2-src.tar.bz2

@ libboffo7
requires: cygwin
version: 2.4.1-2
install: release/boffo/libboffo7/libboffo7-2.4.1-2.tar.bz2
source: release/boffo/boffo-2.4.1-2-src.tar.bz2
</tt>
</pre>

<p>Note that both packages point to the same -src tarball.  Also, it is required
that the version strings match (libboffo7-5.2 won't point to boffo-1.4-src).  The
same logic is used to "match up" prev: and test: versions.</p>

<h2><a id="package_contents" name="package_contents">Making Packages</a></h2>
<p>The files paths within both the -src and the binary package files are
quite important.  Since setup.exe extracts into a predetermined
directory, you must structure your package contents accordingly.</p>
<p>The following requirements avoid problems that have occured in the past with packages. Thus only skip them if you *know* your package will not recreate that prior problem.</p>
<ul>
  <li>Binary packages are extracted in /, include all file paths from
  the root in your archive, e.g.:<pre><tt>  usr/bin/boffo.exe
  usr/share/boffo/boffo.dat
  etc...</tt></pre></li>
  <li>The package is configured using (at a minimum) the following paths:
  <pre>  --prefix=/usr
  --sysconfdir=/etc
  --libexecdir=/usr/sbin
  --localstatedir=/var
  --datadir=/usr/share
  --mandir=/usr/share/man
  --infodir=/usr/share/info</pre></li>
  <li><p>All executables in your binary package are stripped (run 'strip' on them). Some makefiles have a install-strip command you can use to do this automatically when you setup your 'installed' tree.</p></li>
  <li><p>Source packages are extracted in /usr/src.  See the <a href="#srcpackage_contents">Package Source</a> section for more information.
  <li><p>In your binary package, include a file /usr/share/doc/Cygwin/foo-vendor-suffix.README containing (at a minimum) the information needed for an end user to recreate the package. This includes CFLAGS settings, configure parameters, etc.</p></li>
  <li><p>In your binary package include a directory /usr/share/doc/foo-vendor/ that includes any binary-relevant vendor documentation, such as ChangeLog's, copyright licence's, README's etc.</p></li>
  <li><p>If you are not creating your package from an installed virtual root, be sure to check that the file permissions are appropriate.</p></li>
  <li><p>If you have any 'info' documention in your package, run install-info as part of your post-install script</p></li>
  <li><p>If the package has any global settings (ie in files in /etc) that are not overrideable on a per user basis (sshd, as a daemon, is an example of this) do not include the relevant config files in your package. Instead include in your post-install script to install the settings files. Be sure that if you would overwrite an already present file that the user is offered the choice of keeping their own or overwriting with your defaults.</p></li>
  <li><p>Ensure that your package handles binary only systems, textmode only systems, and hybrid systems correctly.</p></li>
</ul>

<h2><a id="srcpackage_contents" name="srcpackage_contents">Package Source</a></h2>
<p>There are two accepted ways to package the source code for cygwin packages.
<h3>Method One</h3>

<ul>
  <li><p>Source packages are extracted underneath /usr/src (so your -src tarball
  should not include /usr/src). On extraction, the tar file should put the sources in a directory with
  the same name as the package tar ball minus the -src.tar.bz2 part:
<pre><tt>  boffo-1.0-1/Makefile.in
  boffo-1.0-1/README
  boffo-1.0-1/configure
  boffo-1.0-1/configure.in
  etc...
</tt></pre></li>
  <li><p>In your source package include the same foo-vendor-suffix.README
  as used in the binary package.</p></li>
  <li><p>Your source package already be patched with any necessary cygwin
  specific changes.  The user should be able to just ./configure; make; and go.</p></li>
  <li><p>Include a single file foo-vendor-release.patch in your source package,
  that when applied (in reverse: 'patch -R') will remove all the patches
  you've applied to the package, leaving it as the vendor distributes it.
  This file should extract as : <tt>/usr/src/foo-vendor-release.patch</tt>
  (that is, since setup.exe extracts everything into <tt>/usr/src</tt>,
  the patch should be a &quot;top level&quot; member of the -src tarball.)<p>
  <p>Optionally, this patch could also unpack inside the source tree:
<pre><tt>  boffo-1.0-1/README
  boffo-1.0-1/configure
  boffo-1.0-1/CYGWIN-PATCHES/boffo-1.0-1.patch
  etc...
</tt></pre>
  However, that tends to complicate actually <b>creating</b> the patch itself.
  Unless one enjoys recursion, one must move the .patch file OUT of the source
  tree, regenerate the patch to incorporate any new changes, and then copy
  the new patch back into .../CYGWIN-PATCHES/.  This option is documented
  because some existing packages do it this way, but it is not recommended
  for new packages.  Make boffo-1.0-1.patch a top-level member of the -src
  tarball instead:
<pre><tt>  boffo-1.0-1.patch
  boffo-1.0-1/README
  boffo-1.0-1/configure
  etc...
</tt></pre>
  To create the patch file described above, you might run
  <pre><tt>  diff -Nrup vendor-src-dir patched-src-dir &gt; foo-vendor-release.patch</tt></pre>
  To apply the generated patch (in reverse; that is, to remove the cygwin
  specific changes from the unpacked -src tarball) the user would run (from
  within the source tree)
  <pre><tt>  patch -R -p1 &lt; ../foo-vendor-release.patch</tt></pre></p></li>
  <li><p>In general, any cygwin-specific &quot;packaging&quot; files -- such as
  cygwin-specific READMEs, a copy of the setup.hint file for your package,
  etc. -- should unpack within a /CYGWIN-PATCHES/ subdirectory in your
  sources.  Naturally, applying the patch (in reverse, as described above) would
  remove these files from the source tree.
  <li><p>So, returning to the boffo example, boffo-1.0-1-src.tar.bz2 would contain:
<pre><tt>  boffo-1.0-1.patch
  boffo-1.0-1/README
  boffo-1.0-1/configure
  boffo-1.0-1/configure.in
  boffo-1.0-1/Makefile.am
  boffo-1.0-1/Makefile.in
  boffo-1.0-1/boffo.c
  ...
  boffo-1.0-1/CYGWIN-PATCHES/boffo.README (cygwin-specific)
  boffo-1.0-1/CYGWIN-PATCHES/setup.hint
  ...
</tt></pre>
</ul>

<h3>Method Two</h3>
<ul>
  <li><p>In a packaging technique inspired by rpms and debs, you may create a
  -src tarball which simply contains:
  <ol>
    <li><p><tt>foo-vendor.tar.[gz|bz2]</tt>:  The original source tarball,
    exactly as downloaded from the original vendor.
    <li><p><tt>foo-vendor-release.patch</tt>:  the patch file as described in
    Method One, above.</p>
    <li><p><tt>foo-vendor-release.sh</tt>:  A build script that drives the
    entire unpacking, configuration, build, and packaging (binary and -src)
    process.</p>
  </ol>
  <li><p>You can adapt 
  <a href="http://sourceware.org/cgi-bin/cvsweb.cgi/~checkout~/packaging/templates/generic-readme?content-type=text/plain&cvsroot=cygwin-apps">this</a>
  generic readme file for script-driven -src packages.</p>
  <li><p><a href="http://sourceware.org/cgi-bin/cvsweb.cgi/~checkout~/packaging/templates/generic-build-script?content-type=text/plain&cvsroot=cygwin-apps">Here</a>
  is an example build script
  which can be adapted for your package.  By carefully modifying the details of
  this script, it can create the binary and -src packages for you, once you've
  finished porting your package.  How?  See the
  <b><i>Initial packaging procedure</i></b> below.  But first, a few facts:</p>
  <ul>
    <li><p>The buildscript will autodetect the package name, vendor version,
    and release number from its own filename.</p>
    <li><p>When the buildscript is used to compile the package, all building
    occurs within a hidden subdirectory inside the source tree:
    <tt>boffo-1.0/.build/</tt></p>
    <li><p>To create the binary package, the script redirects 'make install'
    into a hidden subdirectory <tt>boffo-1.0/.inst/</tt>, creating
    a faux tree <tt>boffo-1.0/.inst/usr/bin</tt>, etc.  This faux tree is
    tar'ed up into the new binary package.</p>
    <li><p>To create the -src package, the script generates a patch file, and
    copies the original tarball, the patch, and the script into yet another
    hidden subdirectory <tt>boffo-1.0/.sinst/</tt>.  The contents of this
    subdirectory are tar'ed up into the new -src package.</p>
    <li><p>Sometimes, you will find that a package cannot build outside of
    its source directory.  In this case, the script must recreate the
    source tree within the <tt>.build</tt> subdirectory.  The jbigkit -src
    package uses GNU shtool's mkshadow to do this.</p>
    <li><p><tt>generic-build-script</tt> is <b>not</b> a one-size-fits-all
    solution.  It <b>must</b> be customized for your package.</p>
  </ul>
  <li><p><b><i>Initial packaging procedure, script-based</i></b></p>
  <ul>
    <li><p>Suppose you've got your boffo package ported to cygwin.  It took
    some work, but it now builds and runs.  Further, suppose that the
    <tt>boffo-1.0.tar.bz2</tt> file that you downloaded from the boffo homepage
    unpacks into <tt>boffo-1.0/</tt>, so you've been doing all of your work
    in <tt>~/sources/boffo-1.0/</tt>.  That's good.</p>
    <li><p>Place a copy of <tt>boffo-1.0.tar.bz2</tt> in <tt>~/sources</tt>
    <li>copy <a href="http://sourceware.org/cgi-bin/cvsweb.cgi/~checkout~/packaging/templates/generic-build-script?content-type=text/plain&cvsroot=cygwin-apps"><tt>generic-build-script</tt></a>
    into <tt>~/sources/</tt> and rename it <tt>boffo-1.0-1.sh</tt>.  Carefully
    adapt this script for your purposes.  However, it should auto detect
    most of what it needs to know: the package name, vendor version, release
    number, etc.</p>
    <li><p>Clean up inside your <tt>~/sources/boffo-1.0/</tt> directory -- make sure
    that no files which are generated during the build process are lying around.
    Usually, a '<tt>make distclean</tt>' will do the trick, but not always.</p>
    <li><p>Ensure that you've put any cygwin-specific readme files, setup.hint files,
    etc, into <tt>~/sources/boffo-1.0/CYGWIN-PATCHES/</tt>.  You can adapt
    <a href="http://sourceware.org/cgi-bin/cvsweb.cgi/~checkout~/packaging/templates/generic-readme?content-type=text/plain&cvsroot=cygwin-apps"><tt>this generic readme file</tt></a>
    for this purpose.  The build script
    expects that the cygwin-specific README file will be named
    <tt>.../CYGWIN-PATCHES/&lt;package&gt;.README</tt>.  In this example, it would
    be stored as <tt>~/sources/boffo-1.0/CYGWIN-PATCHES/boffo.README</tt>.  The
    build script will ensure that it gets installed as
    <tt>/usr/share/doc/Cygwin/boffo-1.0.README</tt>
    <li>Prepare the staging location for the -src package (yes, do the -src
    package first): From the directory above your boffo-1.0 tree (e.g.
    <tt>~/sources/</tt> in our example) execute '<tt>./boffo-1.0-1.sh mkdirs</tt>'</p>
    <li><p>Create the -src package: '<tt>./boffo-1.0-1.sh spkg</tt>'</p>
    <li><p>Now, let's go somewhere else and unpack this new -src package:
    <pre><tt>  cd /tmp
  tar xvjf ~/sources/boffo-1.0-1-src.tar.bz2</tt></pre></p>
    <li><p>Finally, rebuild the whole thing (you're still in /tmp):
    <pre><tt>  ./boffo-1.0-1.sh all</tt></pre>
    (Or, you may want to do each step in 'all'
    manually: prep, conf, build, (check), install, strip, pkg, spkg, finish.</p>
  </ul>
</ul>

<h2><a id="postinstall" name="postinstall">Creating a package postinstall script</a></h2>

<p>If your package requires certain commands to be executed after the
files in the package are installed, include them in a file in the
package called /etc/postinstall/<var>package</var>.sh or
/etc/postinstall/<var>package</var>.bat.</p>

<p>If the file's name ends in ".sh", it is executed with the Cygwin
shell; if it ends in ".bat", it is executed with the DOS command
interpreter.  If it doesn't end with either of these suffixes, it is
ignored.</p>

<p>After the script has been run it is renamed by appending the suffix
".done" to its previous name, to prevent it from being run again the
next time the user runs the setup program.</p>

<p>Note that the setup program runs all the postinstall scripts after
all desired packages have been installed, that is, it does not run
each package's postinstall script immediately after installing that
package.  Note, furthermore, that the order in which the scripts are
run is not guaranteed.  Therefore, if your package depends on others
which have their own postinstall scripts, you cannot assume in your
script that the other packages' scripts have already been run.</p>

<h2><a id="submitting" name="submitting">Submitting a package</a></h2>
<p>So you've got a package you want to submit. Follow the following checklist before emailing cygwin-apps@cygwin.com and you'll almost certainly save time.</p>
<ol>
  <li><p>Propose on cygwin-apps@cygwin.com that you are interested in becoming a package maintainer for package foo. Some packages cannot be distributed via cygwin's setup due to vendor licence limitations. Other packages may not be appropriate for cygwin. This step will save time if, for some reason we cannot accept the package.</p></li>
  <li>If this is a new package, <b>post a complete <tt>setup.hint</tt> file as part of your proposal</b>.  Include this file in the text of your message so that it can be commented on.  Do not submit it as an attachment.</li>
<li><p>Do you have the time to maintain the package?  Packages without
active maintainers are pulled from the distribution.  Generally speaking
the time commitment is relatively low, simply subscribe to cygwin at
cygwin dot com.  We'd prefer if you read the non-digest mode since
prompt response to packaging issues is a plus.  When a <i>bug</i> in
your package is reported in the cygwin mailing list, address the bug (if
it's a cygwin-only bug) or pass back to the vendor.  When a solution
exists, create an updated package with the fix in it, and send a
notification that you need the package uploaded to cygwin-apps.  Note
that you are not expected to be a helpdesk for the package - the users
should be pointed to the vendors lists if you've determined that the
bug is not a cygwin-related bug.</p></li>
  <li><p>Look in the debian package list and identify the section that your package is present in there - if it's available via debian. If it's not, have a look and take a sensible guess.</p></li>
  <li><p>Create setup.hint file following the documentation on this web page.  Opinion on whether to mark your initial version as a <tt>Test</tt> version is currently mixed. If you have doubts about the stability of your initial offering you may decide to mark it as <tt>Test</tt>.  Then, once the package has no major bug reports from users, a current package may be introduced.  Otherwise, it is perfectly acceptable to forgo the <tt>Test</tt> designation in your first release.</p></li>
  <li><p>If possible, place the package files in a web accessible http/ftp site somewhere.</p></li>
  <li><p>Announce on cygwin-apps@cygwin.com that you have the package ready for uploading.  Add the URLs to all package files to your mail or, if you can't provide it on a web page, someone with upload privileges will contact you to get access to the package files to upload them to sourceware.org for you.</p></li>
  <li><p>Delete your temporary copy once they have been uploaded to sourceware.org.</p></li>
  <li><p>Announce via cygwin-announce@cygwin.com that the new package, is available. Use a recent cygwin-announce message from one of the core maintainers as a template for your announcement.</p><p>Once sent, your message will be reviewed by one of the cygwin-announce moderators and, once approved, will be automatically forwarded to the cygwin mailing list with an [ANNOUNCEMENT] prepended to the subject.</p></li>
</ol>
<p>NOTE: On any major version upgrade, you may want to mark the release as <tt>Test</tt>.
<!--#include virtual="cygwin-footer.html"-->
