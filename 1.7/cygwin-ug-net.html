<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Cygwin User's Guide</title><link rel="stylesheet" href="docbook.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="cygwin-ug-net"></a>Cygwin User's Guide</h1></div><div><div class="legalnotice"><a name="legal"></a><p>Copyright © 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009 Red Hat, Inc.</p></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#overview">1. Cygwin Overview</a></span></dt><dd><dl><dt><span class="sect1"><a href="#what-is-it">What is it?</a></span></dt><dt><span class="sect1"><a href="#ov-ex-win">Quick Start Guide for those more experienced with Windows</a></span></dt><dt><span class="sect1"><a href="#ov-ex-unix">Quick Start Guide for those more experienced with UNIX</a></span></dt><dt><span class="sect1"><a href="#are-free">Are the Cygwin tools free software?</a></span></dt><dt><span class="sect1"><a href="#brief-history">A brief history of the Cygwin project</a></span></dt><dt><span class="sect1"><a href="#highlights">Highlights of Cygwin Functionality</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ov-hi-intro">Introduction</a></span></dt><dt><span class="sect2"><a href="#ov-hi-perm">Permissions and Security</a></span></dt><dt><span class="sect2"><a href="#ov-hi-files">File Access</a></span></dt><dt><span class="sect2"><a href="#ov-hi-textvsbinary">Text Mode vs. Binary Mode</a></span></dt><dt><span class="sect2"><a href="#ov-hi-ansiclib">ANSI C Library</a></span></dt><dt><span class="sect2"><a href="#ov-hi-process">Process Creation</a></span></dt><dt><span class="sect2"><a href="#ov-hi-signals">Signals</a></span></dt><dt><span class="sect2"><a href="#ov-hi-sockets">Sockets</a></span></dt><dt><span class="sect2"><a href="#ov-hi-select">Select</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ov-new1.7">What's new and what changed in Cygwin 1.7</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ov-new1.7-os">OS related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-file">File Access related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-net">Network related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-device">Device related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-posix">Other POSIX related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-sec">Security related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-misc">Miscellaneous</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#setup-net">2. Setting Up Cygwin</a></span></dt><dd><dl><dt><span class="sect1"><a href="#internet-setup">Internet Setup</a></span></dt><dd><dl><dt><span class="sect2"><a href="#setup-download">Download Source</a></span></dt><dt><span class="sect2"><a href="#setup-dir">Selecting an Install Directory</a></span></dt><dt><span class="sect2"><a href="#setup-localdir">Local Package Directory</a></span></dt><dt><span class="sect2"><a href="#setup-connection">Connection Method</a></span></dt><dt><span class="sect2"><a href="#setup-mirror">Choosing Mirrors</a></span></dt><dt><span class="sect2"><a href="#setup-packages">Choosing Packages</a></span></dt><dt><span class="sect2"><a href="#setup-progress">Download and Installation Progress</a></span></dt><dt><span class="sect2"><a href="#setup-icons">Icons</a></span></dt><dt><span class="sect2"><a href="#setup-postinstall">Post-Install Scripts</a></span></dt><dt><span class="sect2"><a href="#setup-troubleshooting">Troubleshooting</a></span></dt></dl></dd><dt><span class="sect1"><a href="#setup-env">Environment Variables</a></span></dt><dt><span class="sect1"><a href="#setup-maxmem">Changing Cygwin's Maximum Memory</a></span></dt><dt><span class="sect1"><a href="#setup-locale">Internationalization</a></span></dt><dd><dl><dt><span class="sect2"><a href="#setup-locale-ov">Overview</a></span></dt><dt><span class="sect2"><a href="#setup-locale-how">How to set the locale</a></span></dt><dt><span class="sect2"><a href="#setup-locale-problems">Potential Problems when using Locales</a></span></dt><dt><span class="sect2"><a href="#setup-locale-missing">What does not work?</a></span></dt><dt><span class="sect2"><a href="#setup-locale-charsetlist">List of supported character sets</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ntsec">Using Windows security in Cygwin</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ntsec-common">Overview</a></span></dt><dt><span class="sect2"><a href="#ntsec-files">File permissions</a></span></dt><dt><span class="sect2"><a href="#ntsec-ids">Special values of user and group ids</a></span></dt><dt><span class="sect2"><a href="#ntsec-mapping">The POSIX permission mapping leak</a></span></dt><dt><span class="sect2"><a href="#ntsec-setuid-overview">Switching the user context</a></span></dt><dt><span class="sect2"><a href="#ntsec-logonuser">Switching the user context with password authentication</a></span></dt><dt><span class="sect2"><a href="#ntsec-nopasswd1">Switching the user context without password, Method 1: Create a token from scratch</a></span></dt><dt><span class="sect2"><a href="#ntsec-nopasswd2">Switching the user context without password, Method 2: LSA authentication package</a></span></dt><dt><span class="sect2"><a href="#ntsec-nopasswd3">Switching the user context without password, Method 3: With password</a></span></dt><dt><span class="sect2"><a href="#ntsec-setuid-impl">Switching the user context, how does it all fit together?</a></span></dt></dl></dd><dt><span class="sect1"><a href="#setup-files">Customizing bash</a></span></dt></dl></dd><dt><span class="chapter"><a href="#using">3. Using Cygwin</a></span></dt><dd><dl><dt><span class="sect1"><a href="#using-pathnames">Mapping path names</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pathnames-intro">Introduction</a></span></dt><dt><span class="sect2"><a href="#mount-table">The Cygwin Mount Table</a></span></dt><dt><span class="sect2"><a href="#cygdrive">The cygdrive path prefix</a></span></dt><dt><span class="sect2"><a href="#pathnames-additional">Additional Path-related Information</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-textbinary">Text and Binary modes</a></span></dt><dd><dl><dt><span class="sect2"><a href="#textbin-issue">The Issue</a></span></dt><dt><span class="sect2"><a href="#textbin-default">The default Cygwin behavior</a></span></dt><dt><span class="sect2"><a href="#textbin-example">Example</a></span></dt><dt><span class="sect2"><a href="#textbin-question">Binary or text?</a></span></dt><dt><span class="sect2"><a href="#textbin-devel">Programming</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-filemodes">File permissions</a></span></dt><dt><span class="sect1"><a href="#using-specialnames">Special filenames</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pathnames-etc">Special files in /etc</a></span></dt><dt><span class="sect2"><a href="#pathnames-dosdevices">Invalid filenames</a></span></dt><dt><span class="sect2"><a href="#pathnames-specialchars">Forbidden characters in filenames</a></span></dt><dt><span class="sect2"><a href="#pathnames-unusual">Filenames with unusual (foreign) characters</a></span></dt><dt><span class="sect2"><a href="#pathnames-casesensitive">Case sensitive filenames</a></span></dt><dt><span class="sect2"><a href="#pathnames-posixdevices">POSIX devices</a></span></dt><dt><span class="sect2"><a href="#pathnames-exe">The .exe extension</a></span></dt><dt><span class="sect2"><a href="#pathnames-proc">The /proc filesystem</a></span></dt><dt><span class="sect2"><a href="#pathnames-proc-registry">The /proc/registry filesystem</a></span></dt><dt><span class="sect2"><a href="#pathnames-at">The @pathnames</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-cygwinenv">The CYGWIN environment
variable</a></span></dt><dd><dl><dt><span class="sect2"><a href="#cygwinenv-implemented-options">Implemented options</a></span></dt><dt><span class="sect2"><a href="#cygwinenv-removed-options">Obsolete options</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-cygserver">Cygserver</a></span></dt><dd><dl><dt><span class="sect2"><a href="#what-is-cygserver">What is Cygserver?</a></span></dt><dt><span class="sect2"><a href="#cygserver-command-line">Cygserver command line options</a></span></dt><dt><span class="sect2"><a href="#start-cygserver">How to start Cygserver</a></span></dt><dt><span class="sect2"><a href="#cygserver-config">The Cygserver configuration file</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-utils">Cygwin Utilities</a></span></dt><dd><dl><dt><span class="sect2"><a href="#cygcheck">cygcheck</a></span></dt><dt><span class="sect2"><a href="#cygpath">cygpath</a></span></dt><dt><span class="sect2"><a href="#dumper">dumper</a></span></dt><dt><span class="sect2"><a href="#getfacl">getfacl</a></span></dt><dt><span class="sect2"><a href="#kill">kill</a></span></dt><dt><span class="sect2"><a href="#mkgroup">mkgroup</a></span></dt><dt><span class="sect2"><a href="#mkpasswd">mkpasswd</a></span></dt><dt><span class="sect2"><a href="#mount">mount</a></span></dt><dt><span class="sect2"><a href="#passwd">passwd</a></span></dt><dt><span class="sect2"><a href="#ps">ps</a></span></dt><dt><span class="sect2"><a href="#regtool">regtool</a></span></dt><dt><span class="sect2"><a href="#setfacl">setfacl</a></span></dt><dt><span class="sect2"><a href="#ssp">ssp</a></span></dt><dt><span class="sect2"><a href="#strace">strace</a></span></dt><dt><span class="sect2"><a href="#umount">umount</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-effectively">Using Cygwin effectively with Windows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#using-pathnames-effectively">Pathnames</a></span></dt><dt><span class="sect2"><a href="#using-console">Console Programs</a></span></dt><dt><span class="sect2"><a href="#using-net">Cygwin and Windows Networking</a></span></dt><dt><span class="sect2"><a href="#using-cygutils">The cygutils package</a></span></dt><dt><span class="sect2"><a href="#using-shortcuts">Creating shortcuts with cygutils</a></span></dt><dt><span class="sect2"><a href="#using-printing">Printing with cygutils</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#programming">4. Programming with Cygwin</a></span></dt><dd><dl><dt><span class="sect1"><a href="#gcc">Using GCC with Cygwin</a></span></dt><dd><dl><dt><span class="sect2"><a href="#gcc-cons">Console Mode Applications</a></span></dt><dt><span class="sect2"><a href="#gcc-gui">GUI Mode Applications</a></span></dt></dl></dd><dt><span class="sect1"><a href="#gdb">Debugging Cygwin Programs</a></span></dt><dt><span class="sect1"><a href="#dll">Building and Using DLLs</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dll-build">Building DLLs</a></span></dt><dt><span class="sect2"><a href="#dll-link">Linking Against DLLs</a></span></dt></dl></dd><dt><span class="sect1"><a href="#windres">Defining Windows Resources</a></span></dt></dl></dd></dl></div><div class="list-of-examples"><p><b>List of Examples</b></p><dl><dt>2.1. <a href="#ntsec-passwd">/etc/passwd:</a></dt><dt>2.2. <a href="#ntsec-passwd-tweaked">/etc/passwd, tweaked:</a></dt><dt>2.3. <a href="#ntsec-group-tweaked">/etc/group, tweaked:</a></dt><dt>3.1. <a href="#pathnames-mount-ex">Displaying the current set of mount points</a></dt><dt>3.2. <a href="#pathnames-at-ex"> Using @pathname</a></dt><dt>3.3. <a href="#utils-cygcheck-ex">Example cygcheck usage</a></dt><dt>3.4. <a href="#utils-search-ex">Searching all packages for a file</a></dt><dt>3.5. <a href="#utils-cygpath-ex">Example cygpath usage</a></dt><dt>3.6. <a href="#utils-kill-ex">Using the kill command</a></dt><dt>3.7. <a href="#utils-mkgroup-ex">Setting up group entry for current user with different domain/group separator</a></dt><dt>3.8. <a href="#utils-althome-ex">Using an alternate home root</a></dt><dt>3.9. <a href="#utils-mount-ex">Displaying the current set of mount points</a></dt><dt>3.10. <a href="#utils-mount-add-ex">Adding mount points</a></dt><dt>3.11. <a href="#utils-cygdrive-ex">Changing the default prefix</a></dt><dt>3.12. <a href="#utils-cygdrive-ex2">Changing the default prefix with specific mount options</a></dt><dt>4.1. <a href="#gcc-hello-world">Building Hello World with GCC</a></dt><dt>4.2. <a href="#gdb-g">Compiling with -g</a></dt><dt>4.3. <a href="#gdb-break">"break" in gdb</a></dt><dt>4.4. <a href="#gdb-cliargs">Debugging with command line arguments</a></dt></dl></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="overview"></a>Chapter 1. Cygwin Overview</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#what-is-it">What is it?</a></span></dt><dt><span class="sect1"><a href="#ov-ex-win">Quick Start Guide for those more experienced with Windows</a></span></dt><dt><span class="sect1"><a href="#ov-ex-unix">Quick Start Guide for those more experienced with UNIX</a></span></dt><dt><span class="sect1"><a href="#are-free">Are the Cygwin tools free software?</a></span></dt><dt><span class="sect1"><a href="#brief-history">A brief history of the Cygwin project</a></span></dt><dt><span class="sect1"><a href="#highlights">Highlights of Cygwin Functionality</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ov-hi-intro">Introduction</a></span></dt><dt><span class="sect2"><a href="#ov-hi-perm">Permissions and Security</a></span></dt><dt><span class="sect2"><a href="#ov-hi-files">File Access</a></span></dt><dt><span class="sect2"><a href="#ov-hi-textvsbinary">Text Mode vs. Binary Mode</a></span></dt><dt><span class="sect2"><a href="#ov-hi-ansiclib">ANSI C Library</a></span></dt><dt><span class="sect2"><a href="#ov-hi-process">Process Creation</a></span></dt><dt><span class="sect2"><a href="#ov-hi-signals">Signals</a></span></dt><dt><span class="sect2"><a href="#ov-hi-sockets">Sockets</a></span></dt><dt><span class="sect2"><a href="#ov-hi-select">Select</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ov-new1.7">What's new and what changed in Cygwin 1.7</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ov-new1.7-os">OS related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-file">File Access related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-net">Network related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-device">Device related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-posix">Other POSIX related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-sec">Security related changes</a></span></dt><dt><span class="sect2"><a href="#ov-new1.7-misc">Miscellaneous</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="what-is-it"></a>What is it?</h2></div></div></div><p>
Cygwin is a Linux-like environment for Windows. It consists of a DLL
(<code class="filename">cygwin1.dll</code>), which acts as an emulation layer
providing substantial <a class="ulink" href="http://www.pasc.org/#POSIX" target="_top">POSIX</a>
(Portable Operating System Interface) system call functionality, and a
collection of tools, which provide a Linux look and feel. The Cygwin DLL
works with all x86 and AMD64 versions of Windows NT since Windows NT 4.
The API follows the
<a class="ulink" href="http://www.opengroup.org/onlinepubs/009695399/nfindex.html" target="_top">Single
Unix Specification</a> as much as possible, and then Linux practice.
The major differences between Cygwin and Linux is the C library
(<code class="literal">newlib</code> instead of <code class="literal">glibc</code>).
</p><p>
With Cygwin installed, users have access to many standard UNIX
utilities.  They can be used from one of the provided shells such
as <span class="command"><strong>bash</strong></span> or from the Windows Command Prompt.
Additionally, programmers may write Win32 console or GUI applications
that make use of the standard Microsoft Win32 API and/or the Cygwin API.
As a result, it is possible to easily port many significant UNIX
programs without the need for extensive changes to the source code.
This includes configuring and building most of the available GNU
software (including the development tools included with the Cygwin
distribution). 
</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ov-ex-win"></a>Quick Start Guide for those more experienced with Windows</h2></div></div></div><p>
If you are new to the world of UNIX, you may find it difficult to
understand at first. This guide is not meant to be comprehensive,
so we recommend that you use the many available Internet resources
to become acquainted with UNIX basics (search for "UNIX basics" or
"UNIX tutorial"). 
</p><p>
To install a basic Cygwin environment, run the
<span class="command"><strong>setup.exe</strong></span> program and click <code class="literal">Next</code>
at each page.  The default settings are correct for most users. If you
want to know more about what each option means, see 
<a class="xref" href="#internet-setup" title="Internet Setup">the section called &#8220;Internet Setup&#8221;</a>. Use <span class="command"><strong>setup.exe</strong></span>
any time you want to update or install a Cygwin package.  If you are
installing Cygwin for a specific purpose, use it to install the tools
that you need. For example, if you want to compile C++ programs, you 
need the <code class="systemitem">gcc-g++</code> package and probably a text
editor like <code class="systemitem">nano</code>.  When running
<span class="command"><strong>setup.exe</strong></span>, clicking on categories and packages in the
package installation screen will provide you with the ability to control
what is installed or updated. 
</p><p>
Another option is to install everything by clicking on the
<code class="literal">Default</code> field next to the <code class="literal">All</code>
category. However, be advised that this will download and install
several hundreds of megabytes of software to your computer. The best
plan is probably to click on individual categories and install either
entire categories or packages from the categories themselves.
After installation, you can find Cygwin-specific documentation in
the <code class="literal">/usr/share/doc/Cygwin/</code> directory.
</p><p>
Developers coming from a Windows background will be able to write 
console or GUI executables that rely on the Microsoft Win32 API instead
of Cygwin using the -mno-cygwin option to GCC.  The <span class="command"><strong>-shared</strong></span>
option allows to write Windows Dynamically Linked Libraries (DLLs).  The
resource compiler <span class="command"><strong>windres</strong></span> is also provided.
</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ov-ex-unix"></a>Quick Start Guide for those more experienced with UNIX</h2></div></div></div><p>
If you are an experienced UNIX user who misses a powerful command-line
environment, you will enjoy Cygwin.
Developers coming from a UNIX background will find a set of utilities
they are already comfortable using, including a working UNIX shell.  The
compiler tools are the standard GNU compilers most people will have previously
used under UNIX, only ported to the Windows host.  Programmers wishing to port
UNIX software to Windows NT will find that the Cygwin library provides
an easy way to port many UNIX packages, with only minimal source code
changes.
</p><p>
Note that there are some workarounds
that cause Cygwin to behave differently than most UNIX-like operating
systems; these are described in more detail in 
<a class="xref" href="#using-effectively" title="Using Cygwin effectively with Windows">the section called &#8220;Using Cygwin effectively with Windows&#8221;</a>.
</p><p>
Use the graphical command <span class="command"><strong>setup.exe</strong></span> any time you want
to update or install a Cygwin package.  This program must be run
manually every time you want to check for updated packages since Cygwin
does not currently include a mechanism for automatically detecting
package updates.
</p><p>
By default, <span class="command"><strong>setup.exe</strong></span> only installs a minimal subset of
packages.  Add any other packages by clicking on the <code class="literal">+</code>
next to the Category name and selecting the package from the displayed
list.  You may search for specfic tools by using the
<a class="ulink" href="http://cygwin.com/packages/" target="_top">Setup Package Search</a>
at the Cygwin web site.
</p><p>
Another option is to install everything by clicking on the
<code class="literal">Default</code> field next to the <code class="literal">All</code>
category. However, be advised that this will download and install
several hundreds of megabytes of software to your computer. The best
plan is probably to click on individual categories and install either
entire categories or packages from the categories themselves.
After installation, you can find Cygwin-specific documentation in
the <code class="literal">/usr/share/doc/Cygwin/</code> directory.
</p><p>
For more information about what each option in
<span class="command"><strong>setup.exe</strong></span> means, see <a class="xref" href="#internet-setup" title="Internet Setup">the section called &#8220;Internet Setup&#8221;</a>.
</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="are-free"></a>Are the Cygwin tools free software?</h2></div></div></div><p>Yes. Parts are <a class="ulink" href="http://www.gnu.org/" target="_top">GNU</a> software 
(<span class="command"><strong>gcc</strong></span>, <span class="command"><strong>gas</strong></span>, <span class="command"><strong>ld</strong></span>, etc.),
parts are covered by the standard 
<a class="ulink" href="http://www.x.org/Downloads_terms.html" target="_top">X11 license</a>, 
some of it is public domain, some of it was written by Red Hat and placed under
the <a class="ulink" href="http://www.gnu.org/licenses/gpl.html" target="_top">GNU General Public 
License</a> (GPL). None of it is shareware. You don't have to pay anyone to
use it but you should be sure to read the copyright section of the FAQ for more
information on how the GNU GPL may affect your use of these
tools. If you intend to port a proprietary application using the Cygwin
library, you may want the Cygwin proprietary-use license.
For more information about the proprietary-use license, please go to
<a class="ulink" href="http://www.redhat.com/software/tools/cygwin/" target="_top">http://www.redhat.com/software/tools/cygwin/</a>. 
Customers of the native Win32 GNUPro should feel free to submit bug
reports and ask questions through the normal channels.  All other
questions should be sent to the project mailing list
<code class="email">&lt;<a class="email" href="mailto:cygwin@cygwin.com">cygwin@cygwin.com</a>&gt;</code>.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="brief-history"></a>A brief history of the Cygwin project</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
A historical look into the first years of Cygwin development is
Geoffrey J. Noer's 1998 paper, "Cygwin32: A Free Win32 Porting Layer for
UNIX® Applications" which can be found at the <a class="ulink" href="http://www.usenix.org/publications/library/proceedings/usenix-nt98/technical.html" target="_top">
2nd USENIX Windows NT Symposium Online Proceedings</a>.
</p></div><p>
Cygwin began development in 1995 at Cygnus Solutions (now part of Red Hat,
Inc.).  The first thing done was to enhance the development tools 
(<span class="command"><strong>gcc</strong></span>, <span class="command"><strong>gdb</strong></span>, <span class="command"><strong>gas</strong></span>, 
etc.) so that they could generate and interpret Win32 native
object files.
The next task was to port the tools to Win NT/9x. We could have
done this by rewriting large portions of the source to work within the
context of the Win32 API. But this would have meant spending a huge
amount of time on each and every tool. Instead, we took a
substantially different approach by writing a shared library
(the Cygwin DLL) that adds the necessary UNIX-like functionality
missing from the Win32 API (<code class="function">fork</code>,
<code class="function">spawn</code>, <code class="function">signals</code>,
<code class="function">select</code>, <code class="function">sockets</code>, etc.).  We call this
new interface the Cygwin API. Once written, it was possible to build working
Win32 tools using UNIX-hosted cross-compilers, linking against this
library.</p><p>From this point, we pursued the goal of producing native tools
capable of rebuilding themselves under Windows 9x and NT (this is
often called self-hosting). Since neither OS ships with standard UNIX
user tools (fileutils, textutils, bash, etc...), we had to get the GNU
equivalents working with the Cygwin API. Most of these tools were
previously only built natively so we had to modify their configure
scripts to be compatible with cross-compilation. Other than the
configuration changes, very few source-level changes had to be
made. Running bash with the development tools and user tools in place,
Windows 9x and NT look like a flavor of UNIX from the perspective of
the GNU configure mechanism. Self hosting was achieved as of the beta
17.1 release in October 1996.</p><p>
The entire Cygwin toolset was available as a monolithic install. In
April 2000, the project announced a
<a class="ulink" href="http://www.cygwin.com/ml/cygwin/2000-04/msg00269.html" target="_top">
New Cygwin Net Release</a> which provided the native Win32 program
<span class="command"><strong>setup.exe</strong></span> to install and upgrade each package
separately. Since then, the Cygwin DLL and <span class="command"><strong>setup.exe</strong></span> 
have seen continuous development.
</p><p>
The latest major improvement in this development is the 1.7 release in
2009, which dropped Windows 95/98/Me support in favor of using Windows
NT features more extensively.  It adds a lot of new features like
case-sensitive filenames, NFS interoperability, IPv6 support and much
more.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="highlights"></a>Highlights of Cygwin Functionality</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-hi-intro"></a>Introduction</h3></div></div></div><p>When a binary linked
against the library is executed, the Cygwin DLL is loaded into the
application's text segment.  Because we are trying to emulate a UNIX kernel
which needs access to all processes running under it, the first Cygwin DLL to
run creates shared memory areas and global synchronization objects that other
processes using separate instances of the DLL can access.  This is used to keep track of open file descriptors and to assist fork and exec, among other
purposes.  Every process also has a per_process structure that contains
information such as process id, user id, signal masks, and other similar
process-specific information.</p><p>The DLL is implemented as a standard DLL in the Win32 subsystem.  Under
the hood it's using the Win32 API, as well as the native NT API, where
appropriate.</p><p>Because processes run under the standard Win32 subsystem, they
can access both the UNIX compatibility calls provided by Cygwin as well as
any of the Win32 API calls.  This gives the programmer complete flexibility in
designing the structure of their program in terms of the APIs used.  For
example, they could write a Win32-specific GUI using Win32 API calls on top of
a UNIX back-end that uses Cygwin.</p><p>The native NT API is used mainly for speed, as well as to access
NT capabilities which are useful to implement certain POSIX features, but
are hidden to the Win32 API.
</p><p>Due to some restrictions in Windows, it's not always possible
to strictly adhere to existing UNIX standards like POSIX.1.  Fortunately
these are mostely border cases.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-hi-perm"></a>Permissions and Security</h3></div></div></div><p>Windows NT includes a sophisticated security model based on Access
Control Lists (ACLs).  Cygwin maps Win32 file ownership and permissions to
ACLs by default, on file systems supporting them (usually NTFS).  Solaris
style ACLs and accompanying function calls are also supported.
The chmod call maps UNIX-style permissions back to the Win32 equivalents. 
Because many programs expect to be able to find the
<code class="filename">/etc/passwd</code> and
<code class="filename">/etc/group</code> files, we provide <a class="ulink" href="http://cygwin.com/cygwin-ug-net/using-utils.html" target="_top">utilities</a>
that can be used to construct them from the user and group information
provided by the operating system.</p><p>Users with Administrator rights are permitted to chown files.
With version 1.1.3 Cygwin introduced a mechanism for setting real and
effective UIDs. This is described in <a class="xref" href="#ntsec" title="Using Windows security in Cygwin">the section called &#8220;Using Windows security in Cygwin&#8221;</a>.  As
of version 1.5.13, the Cygwin developers are not aware of any feature in
the Cygwin DLL that would allow users to gain privileges or to access
objects to which they have no rights under Windows.  However there is no
guarantee that Cygwin is as secure as the Windows it runs on. Cygwin
processes share some variables and are thus easier targets of denial of
service type of attacks.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-hi-files"></a>File Access</h3></div></div></div><p>Cygwin supports
both POSIX- and Win32-style paths, using either forward or back slashes as the
directory delimiter.  Paths coming into the DLL are translated from POSIX to
native NT as needed.  From the application perspective, the file system is
a POSIX-compliant one.  The implementation details are safely hidden in the
Cygwin DLL.  UNC pathnames (starting with two slashes) are supported for
network paths.</p><p>Since version 1.7.0, the layout of this POSIX view of the Windows file
system space is stored in the <code class="filename">/etc/fstab</code> file.  Actually,
there is a system-wide <code class="filename">/etc/fstab</code> file as well as a
user-specific fstab file <code class="filename">/etc/fstab.d/${USER}</code>.</p><p>At startup the DLL has to find out where it can find the
<code class="filename">/etc/fstab</code> file.  The mechanism used for this is simple.
First it retrieves it's own path, for instance
<code class="filename">C:\Cygwin\bin\cygwin1.dll</code>.  From there it deduces
that the root path is <code class="filename">C:\Cygwin</code>.  So it looks for the
<code class="filename">fstab</code> file in <code class="filename">C:\Cygwin\etc\fstab</code>. 
The layout of this file is very similar to the layout of the
<code class="filename">fstab</code> file on Linux.  Just instead of block devices,
the mount points point to Win32 paths.  An installation with
<span class="command"><strong>setup.exe</strong></span> installs a <code class="filename">fstab</code> file by
default, which can easily be changed using the editor of your choice.</p><p>In addition to selecting the root partition, the
<code class="filename">fstab</code> file allows mounting arbitrary Win32 paths into
the POSIX file system space.  A special case is the so-called cygdrive prefix.
It's the path under which every available drive in the system is mounted
under its drive letter.  The default value is <code class="filename">/cygdrive</code>,
so you can access the drives as <code class="filename">/cygdrive/c</code>,
<code class="filename">/cygdrive/d</code>, etc...  The cygdrive prefix can be set to
some other value (<code class="filename">/mnt</code> for instance) in the
<code class="filename">fstab</code> file(s).</p><p>The library exports several Cygwin-specific functions that can be used
by external programs to convert a path or path list from Win32 to POSIX or vice
versa.  Shell scripts and Makefiles cannot call these functions directly.
Instead, they can do the same path translations by executing the
<span class="command"><strong>cygpath</strong></span> utility program that we provide with Cygwin.</p><p>Win32 applications handle filenames in a case preserving, but case
insensitive manner.  Cygwin supports case sensitivity on file systems
supporting that.  Since Windows XP, the OS only supports case
sensitivity when a specific registry value is changed.  Therefore, case
sensitivity is not usually the default.</p><p>Symbolic links are not present and supported on Windows up to and
including Windows Server 2003 R2.  Native symlinks are available starting
with Windows Vista.  Due to their strange implementation, however,
they are not useful in a POSIX emulation layer.  Cygwin recognizes
native symlinks, but does not create them.</p><p>Symbolic links are potentially created in two different ways.
The file style symlinks are files containing a magic cookie followed by
the path to which the link points.  They are marked with the System DOS
attribute so that only files with that attribute have to be read to
determine whether or not the file is a symbolic link.  The shortcut style
symlinks are Windows shortcut files with a special header and the
Readonly DOS attribute set.  The advantage of file symlinks is speed,
the advantage of shortcut symlinks is the fact that they can be utilized
by non-Cygwin Win32 tools as well.</p><p>Starting with Cygwin 1.7, symbolic links are using UTF-16 to encode
the filename of the target file, to better support internationalization.
Symlinks created by older Cygwin releases can be read just fine.  However,
you could run into problems with them if you're now using another character
set than the one you used when creating these symlinks
(see <a class="xref" href="#setup-locale-problems" title="Potential Problems when using Locales">the section called &#8220;Potential Problems when using Locales&#8221;</a>.  Please note that this
new UTF-16 style of symlinks is not compatible with older Cygwin release,
which can't read the target filename correctly.</p><p>Hard links are fully supported on NTFS and NFS file systems.  On FAT
and some other file systems, the call falls back to simply copying the file,
a strategy that works in many cases.</p><p>On file systems which don't support unique persistent file IDs (FAT,
older Samba shares) the inode number for a file is calculated by hashing its
full Win32 path.  The inode number generated by the stat call always matches
the one returned in <code class="literal">d_ino</code> of the <code class="literal">dirent</code>
structure.  It is worth noting that the number produced by this method is not
guaranteed to be unique.  However, we have not found this to be a significant
problem because of the low probability of generating a duplicate inode number.
</p><p><code class="function">chroot(2)</code> is supported since Cygwin 1.1.3.
However, chroot is not a concept known by Windows.  This implies some
restrictions.  First of all, the <code class="function">chroot</code> call isn't a
privileged call.  Any user may call it.  Second, the chroot environment
isn't safe against native windows processes.  If you want to use a
chroot environment to, for example, allow anonymous ftp with restricted
access, you must make sure care that only native Cygwin applications
are accessible inside of the chroot environment.  Since those applications
are only using the Cygwin POSIX API to access the file system their access
can be restricted as it is intended.  This includes not only POSIX paths but
Win32 paths containing drive letter and/or backslashes as well as UNC paths
(<code class="filename">//server/share</code> or <code class="filename">\\server\share</code>).
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-hi-textvsbinary"></a>Text Mode vs. Binary Mode</h3></div></div></div><p>It is often important that files created by native Windows
applications be interoperable with Cygwin applications.  For example, a
file created by a native Windows text editor should be readable by a
Cygwin application, and vice versa.</p><p>Unfortunately, UNIX and Win32 have different end-of-line
conventions in text files.  A UNIX text file will have a single newline
character (LF) whereas a Win32 text file will instead use a two
character sequence (CR+LF).  Consequently, the two character sequence
must be translated on the fly by Cygwin into a single character newline
when reading in text mode.</p><p>This solution addresses the newline interoperability concern at
the expense of violating the POSIX requirement that text and binary mode
be identical.  Consequently, processes that attempt to lseek through
text files can no longer rely on the number of bytes read to be an
accurate indicator of position within the file.  For this reason, Cygwin
allows you to choose the mode in which a file is read in several ways.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-hi-ansiclib"></a>ANSI C Library</h3></div></div></div><p>We chose to include Red Hat's own existing ANSI C library
"newlib" as part of the library, rather than write all of the lib C
and math calls from scratch.  Newlib is a BSD-derived ANSI C library,
previously only used by cross-compilers for embedded systems
development.  Other functions, which are not supported by newlib have
been added to the Cygwin sources using BSD implementations as much as
possible.</p><p>The reuse of existing free implementations of such things
as the glob, regexp, and getopt libraries saved us considerable
effort.  In addition, Cygwin uses Doug Lea's free malloc
implementation that successfully balances speed and compactness.  The
library accesses the malloc calls via an exported function pointer.
This makes it possible for a Cygwin process to provide its own
malloc if it so desires.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-hi-process"></a>Process Creation</h3></div></div></div><p>The <code class="function">fork</code> call in Cygwin is particularly interesting
because it does not map well on top of the Win32 API.  This makes it very
difficult to implement correctly.  Currently, the Cygwin fork is a
non-copy-on-write implementation similar to what was present in early
flavors of UNIX.</p><p>The first thing that happens when a parent process
forks a child process is that the parent initializes a space in the
Cygwin process table for the child.  It then creates a suspended
child process using the Win32 CreateProcess call.  Next, the parent
process calls setjmp to save its own context and sets a pointer to
this in a Cygwin shared memory area (shared among all Cygwin
tasks).  It then fills in the child's .data and .bss sections by
copying from its own address space into the suspended child's address
space.  After the child's address space is initialized, the child is
run while the parent waits on a mutex.  The child discovers it has
been forked and longjumps using the saved jump buffer.  The child then
sets the mutex the parent is waiting on and blocks on another mutex.
This is the signal for the parent to copy its stack and heap into the
child, after which it releases the mutex the child is waiting on and
returns from the fork call.  Finally, the child wakes from blocking on
the last mutex, recreates any memory-mapped areas passed to it via the
shared area, and returns from fork itself.</p><p>While we have some
ideas as to how to speed up our fork implementation by reducing the
number of context switches between the parent and child process, fork
will almost certainly always be inefficient under Win32.  Fortunately,
in most circumstances the spawn family of calls provided by Cygwin
can be substituted for a fork/exec pair with only a little effort.
These calls map cleanly on top of the Win32 API.  As a result, they
are much more efficient.  Changing the compiler's driver program to
call spawn instead of fork was a trivial change and increased
compilation speeds by twenty to thirty percent in our
tests.</p><p>However, spawn and exec present their own set of
difficulties.  Because there is no way to do an actual exec under
Win32, Cygwin has to invent its own Process IDs (PIDs).  As a
result, when a process performs multiple exec calls, there will be
multiple Windows PIDs associated with a single Cygwin PID.  In some
cases, stubs of each of these Win32 processes may linger, waiting for
their exec'd Cygwin process to exit.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-hi-signals"></a>Signals</h3></div></div></div><p>When
a Cygwin process starts, the library starts a secondary thread for
use in signal handling.  This thread waits for Windows events used to
pass signals to the process.  When a process notices it has a signal,
it scans its signal bitmask and handles the signal in the appropriate
fashion.</p><p>Several complications in the implementation arise from the
fact that the signal handler operates in the same address space as the
executing program.  The immediate consequence is that Cygwin system
functions are interruptible unless special care is taken to avoid
this.   We go to some lengths to prevent the sig_send function that
sends signals from being interrupted.  In the case of a process
sending a signal to another process, we place a mutex around sig_send
such that sig_send will not be interrupted until it has completely
finished sending the signal.</p><p>In the case of a process sending
itself a signal, we use a separate semaphore/event pair instead of the
mutex.  sig_send starts by resetting the event and incrementing the
semaphore that flags the signal handler to process the signal.  After
the signal is processed, the signal handler signals the event that it
is done.  This process keeps intraprocess signals synchronous, as
required by POSIX.</p><p>Most standard UNIX signals are provided.  Job
control works as expected in shells that support
it.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-hi-sockets"></a>Sockets</h3></div></div></div><p>Socket-related calls in Cygwin basically call the functions by the
same name in Winsock, Microsoft's implementation of Berkeley sockets, but
with lots of tweaks.  All sockets are non-blocking under the hood to allow
to interrupt blocking calls by POSIX signals.  Additional bookkeeping is
necessary to implement correct socket sharing POSIX semantics and especially
for the select call.  Some socket-related functions are not implemented at
all in Winsock, as, for example, socketpair.  Starting with Windows Vista,
Microsoft removed the legacy calls <code class="function">rcmd(3)</code>,
<code class="function">rexec(3)</code> and <code class="function">rresvport(3)</code>.
Recent versions of Cygwin now implement all these calls internally.</p><p>An especially troublesome feature of Winsock is that it must be
initialized before the first socket function is called.  As a result, Cygwin
has to perform this initialization on the fly, as soon as the first
socket-related function is called by the application.  In order to support
sockets across fork calls, child processes initialize Winsock if any
inherited file descriptor is a socket.</p><p>AF_UNIX (AF_LOCAL) sockets are not available in Winsock.  They are
implemented in Cygwin by using local AF_INET sockets instead.  This is
completely transparent to the application.  Cygwin's implementation also
supports the getpeereid BSD extension.  However, Cygwin does not yet support
descriptor passing.</p><p>IPv6 is supported beginning with Cygwin release 1.7.0.  This
support is dependent, however, on the availability of the Windows IPv6
stack.  The IPv6 stack was "experimental", i.e. not feature complete in
Windows 2003 and earlier.  Full IPv6 support became available starting
with Windows Vista and Windows Server 2008.  Cygwin does not depend on
the underlying OS for the (newly implemented) <code class="function">getaddrinfo</code>
and <code class="function">getnameinfo</code> functions.  Cygwin 1.7.0 adds
replacement functions which implement the full functionality for IPv4.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-hi-select"></a>Select</h3></div></div></div><p>The UNIX <code class="function">select</code> function is another
call that does not map cleanly on top of the Win32 API.  Much to our
dismay, we discovered that the Win32 select in Winsock only worked on
socket handles.  Our implementation allows select to function normally
when given different types of file descriptors (sockets, pipes,
handles, and a custom /dev/windows Windows messages
pseudo-device).</p><p>Upon entry into the select function, the first
operation is to sort the file descriptors into the different types.
There are then two cases to consider.  The simple case is when at
least one file descriptor is a type that is always known to be ready
(such as a disk file).  In that case, select returns immediately as
soon as it has polled each of the other types to see if they are
ready.  The more complex case involves waiting for socket or pipe file
descriptors to be ready.  This is accomplished by the main thread
suspending itself, after starting one thread for each type of file
descriptor present.  Each thread polls the file descriptors of its
respective type with the appropriate Win32 API call.  As soon as a
thread identifies a ready descriptor, that thread signals the main
thread to wake up.  This case is now the same as the first one since
we know at least one descriptor is ready.  So select returns, after
polling all of the file descriptors one last time.</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ov-new1.7"></a>What's new and what changed in Cygwin 1.7</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-new1.7-os"></a>OS related changes</h3></div></div></div><pre class="screen">
- Windows 95, 98 and Me are not supported anymore.  The new Cygwin 1.7 DLL
  will not run on any of these systems.
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-new1.7-file"></a>File Access related changes</h3></div></div></div><pre class="screen">
- Mount points are no longer stored in the registry.  Use /etc/fstab
  and /etc/fstab.d/$USER instead.  Mount points created with mount(1)
  are only local to the current session and disappear when the last
  Cygwin process in the session exits.

- Cygwin creates the mount points for /, /usr/bin, and /usr/lib automatically
  from it's own position on the disk.  They don't have to be specified in
  /etc/fstab. 

- If a filename cannot be represented in the current character set,
  the character will be converted to a sequence Ctrl-N + UTF-8 representation
  of the character.  This allows to access all files, even those not
  having a valid representation of their filename in the current character
  set (codepage).  To always have a valid string, use the UTF-8 charset
  by setting the environment variable $LANG, $LC_ALL, or $LC_CTYPE to a
  valid POSIX value, for instance in Cygwin.bat like this:

    set LC_CTYPE=en_US.UTF-8

- PATH_MAX is now 4096.  Internally, path names can be as long as the
  underlying OS can handle (32K).

- struct dirent now supports d_type, filled out with DT_REG or DT_DIR.
  All other file types return as DT_UNKNOWN for performance reasons.

- The CYGWIN environment variable options "ntsec" and "smbntsec" have
  been replaced by the per-mount option "acl"/"noacl".

- The CYGWIN environment variable option "ntea" has been removed without
  substitute.

- The CYGWIN environment variable option "check_case" has been removed
  in favor of real case-sensitivity on file systems supporting it.

- Creating filenames with special DOS characters '"', '*', ':', '&lt;',
  '&gt;', '|' is supported.

- Creating files with special DOS device filename components ("aux",
  "nul", "prn") is supported.

- File names are case sensitive if the OS and the underlying file system
  supports it.  Works on NTFS and NFS.  Does not work on FAT and Samba
  shares.  Requires to change a registry key (see the user's guide).
  Can be switched off on a per-mount base.

- Due to the above changes, managed mounts have been removed. 

- Incoming DOS paths are always handled case-insensitive and get no POSIX
  permission, as if they are mounted with noacl,posix=0 mount flags.

- unlink(2) and rmdir(2) try very hard to remove files/directories even
  if they are currently accessed or locked.  This is done by utilizing
  the hidden recycle bin directories and marking the files for deletion.

- rename(2) rewritten to be more POSIX conformant.

- Add st_birthtim member to struct stat.

- File locking is now advisory, not mandatory anymore.  The fcntl(2) and
  the new lockf(2) APIs create and maintain locks with POSIX semantics,
  the flock(2) API creates and maintains locks with BSD semantics.
  POSIX and BSD locks are independent of each other.

- Implement atomic O_APPEND mode.

- New open(2) flags O_DIRECTORY, O_EXEC and O_SEARCH.

- Make the "plain file with SYSTEM attribute set" style symlink
  default again when creating symlinks.  Only create Windows shortcut
  style symlinks if CYGWIN=winsymlinks is set in the environment.

- Symlinks now use UTF-16 encoding for the target filename for
  better internationalization support.  Cygwin 1.7 can read all old style
  symlinks, but the new style is not compatible with older Cygwin releases.

- Handle NTFS native symlinks available since Vista/2008 as symlinks
  (but don't create Vista/2008 symlinks due to unfortunate OS restrictions).

- Recognize NFS shares and handle them using native mechanisms.
  Recognize and create real symlinks on NFS shares.  Get correct
  stat(2) information and set real mode bits on open(2), mkdir(2)
  and chmod(2).

- Recognize Netapp DataOnTap drives and fix inode number handling.

- Recognize Samba version beginning with Samba 3.0.28a using the new
  extended version information negotiated with the Samba developers.

- List servers of all accessible domains and workgroups in // instead of
  just the servers in the own domain/workgroup.

- Support Linux-like extended attributes ([fl]getxattr, [fl]listxattr,
  [fl]setxattr, [fl]removexattr).

- New file conversion API for conversion from Win32 to POSIX path and
  vice versa (cygwin_conv_path, cygwin_create_path, cygwin_conv_path_list).

- New openat family of functions: openat, faccessat, fchmodat, fchownat,
  fstatat, futimesat, linkat, mkdirat, mkfifoat, mknodat, readlinkat, renameat,
  symlinkat, unlinkat.

- Other new APIs: posix_fadvise, posix_fallocate, funopen, fopencookie,
  open_memstream, open_wmemstream, fmemopen, fdopendir.
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-new1.7-net"></a>Network related changes</h3></div></div></div><pre class="screen">
- New implementation for blocking sockets and select on sockets which
  is supposed to allow POSIX-compatible sharing of sockets between
  threads and processes.

- send/sendto/sendmsg now send data in 64K chunks to circumvent an
  internal buffer problem in WinSock (KB 201213).

- New send/recv option MSG_DONTWAIT.

- IPv6 support.  New API getaddrinfo, getnameinfo, freeaddrinfo,
  gai_strerror, in6addr_any, in6addr_loopback.  On IPv6-less systems,
  replacement functions are available for IPv4.  On systems with IPv6
  enabled, the underlying WinSock functions are used.  While I tried
  hard to get the functionality as POSIXy as possible, keep in mind that
  a *fully* conformant implementation of getaddrinfo and other stuff is
  only available starting with Windows Vista/2008.

- Resolver functions (res_init, res_query, res_search, res_querydomain,
  res_mkquery, res_send, dn_comp, dn_expand) are now part of Cygwin.
  Applications don't have to link against minires anymore.  Actually,
  this *is* the former libminires.a.

- rcmd is now implemented inside of Cygwin, instead of calling the
  WinSock function.  This allows rsh(1) usage on Vista/2008, which
  dropped this function from WinSock.

- Define multicast structures in netinet/in.h.  Note that fully
  conformant multicast support is only available beginning with Vista/2008.

- Improve get_ifconf.  Redefine struct ifreq and subsequent datastructures
  to be able to keep more information.  Support SIOCGIFINDEX, SIOCGIFDSTADDR
  and the Cygwin specific SIOCGIFFRNDLYNAM.  Support real interface flags
  on systems supporting them.

- Other new APIs: bindresvport, bindresvport_sa, gethostbyname2, iruserok_sa,
  rcmd_af, rresvport_af.  getifaddrs, freeifaddrs, if_nametoindex,
  if_indextoname, if_nameindex, if_freenameindex.

- Add /proc/net/if_inet6.
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-new1.7-device"></a>Device related changes</h3></div></div></div><pre class="screen">
- Reworked pipe implementation which uses overlapped IO to create
  more reliable interruptible pipes and fifos.

- The CYGWIN environment variable option "binmode" has been removed.

- Improved fifo handling by using native Windows named pipes.

- Detect when a stdin/stdout which looks like a pipe is really a tty.
  Among other things, this allows a debugged application to recognize that
  it is using the same tty as the debugger.

- Support UTF-8 in console window.

- In the console window the backspace key now emits DEL (0x7f) instead
  of BS (0x08), Alt-Backspace emits ESC-DEL (0x1b,0x7f) instead of DEL
  (0x7f), same as the Linux console and xterm.
  Control-Space now emits an ASCII NUL (0x0) character.

- Support up to 64 serial interfaces using /dev/ttyS0 - /dev/ttyS63.

- Support up to 128 raw disk drives /dev/sda - /dev/sddx.

- New API: cfmakeraw, posix_openpt.
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-new1.7-posix"></a>Other POSIX related changes</h3></div></div></div><pre class="screen">
- A lot of character sets are supported now via a call to setlocale().
  The setting of the environment variables $LANG, $LC_ALL or $LC_CTYPE will
  be used.  For instance, setting $LANG to "de_DE.ISO-8859-15" before
  starting a Cygwin session will use the ISO-8859-15 character set in
  the entire session.  UTF-8 is supported as well, as in "en_US.UTF-8".

  The full list of supported character sets: "ASCII", "ISO-8859-x" with x
  in 1-16, except 12, "UTF-8", Windows codepages "CPxxx", with xxx in
  (437, 720, 737, 775, 850, 852, 855, 857, 858, 862, 866, 874, 1125,
  1250, 1251, 1252, 1253, 1254, 1255, 1256, 1257, 1258), "SJIS",
  "GBK", "eucJP", "eucKR", and "Big5".  The leading language and territory
  part (en_US, for instance) is not used by Cygwin yet, but is required
  for POSIX compatibility.

- Allow multiple concurrent read locks per thread for pthread_rwlock_t.

- Implement pthread_kill(thread, 0) as per POSIX.

- New API for POSIX IPC:
  Named semaphores: sem_open, sem_close, sem_unlink.
  Message queues: mq_open, mq_getattr, mq_setattr, mq_notify, mq_send,
  mq_timedsend, mq_receive, mq_timedreceive, mq_close, mq_unlink.
  Shared memory: shm_open, shm_unlink.

- Only declare expected functions in &lt;strings.h&gt;, don't include
  &lt;string.h&gt; from here.

- New APIs: _Exit, confstr, insque, remque, sys_sigabbrev,
  posix_madvise, posix_memalign, reallocf,
  exp10, exp10f, pow10, pow10f, lrint, lrintf, rint, rintf, llrint, llrintf,
  llrintl, lrintl, rintl,
  mbsnrtowcs, strcasestr, stpcpy, stpncpy, wcpcpy, wcpncpy, wcsnlen,
  wcsnrtombs, wcsftime, wcstod, wcstof, wcstoimax, wcstok, wcstol, wcstoll,
  wcstoul, wcstoull, wcstoumax, wcsxfrm, wcscasecmp, wcsncasecmp,
  fgetwc, fgetws, fputwc, fputws, fwide, getwc, getwchar, putwc, putwchar,
  ungetwc, asnprintf, dprintf, vasnprintf, vdprintf,
  wprintf, fwprintf, swprintf, vwprintf, vfwprintf, vswprintf,
  wscanf, fwscanf, swscanf, vwscanf, vfwscanf, vswscanf.
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-new1.7-sec"></a>Security related changes</h3></div></div></div><pre class="screen">
- Getting a domain user's groups is hopefully more bulletproof now.

- Cygwin now comes with a real LSA authentication package.  This must
  be manually installed by a privileged user using the /bin/cyglsa-config
  script.  The advantages and disadvantages are noted in
  http://cygwin.com/ml/cygwin-developers/2006-11/msg00000.html

- Cygwin now allows storage and use of user passwords in a hidden area of
  the registry.  This is tried first when Cygwin is called by privileged
  processes to switch the user context.  This allows, for instance,
  ssh public key sessions with full network credentials to access shares
  on other machines.

- New options have been added to the mkpasswd and mkgroup tools to
  ease use in multi-machine and multi-domain environments.  The existing
  options have a slightly changed behaviour.
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ov-new1.7-misc"></a>Miscellaneous</h3></div></div></div><pre class="screen">
- New ldd utility, similar to Linux.

- Fallout from the long path names: If the current working directory is
  longer than 260 bytes, or if the current working directory is a virtual
  path (like /proc, /cygdrive, //server), don't call native Win32 programs
  since they don't understand these paths.

- On the first usage of a DOS path (C:\foo, \\foo\bar), the Cygwin DLL
  emits a scary warning that DOS paths shouldn't be used.  This warning
  may be disabled via the new CYGWIN=nodosfilewarning setting.

- The CYGWIN environment variable option "server" has been removed.
  Cygwin automatically uses cygserver if it's available.

- Allow environment of arbitrary size instead of a maximum of 32K.

- Don't force uppercase environment when started from a non-Cygwin process.
  Except for certain Windows and POSIX variables which are always uppercased,
  preserve environment case.  Switch back to old behaviour with the new
  CYGWIN=upcaseenv setting.

- Detect and report a missing DLL on process startup.

- Add /proc/registry32 and /proc/registry64 paths to access 32 bit and
  64 bit registry on 64 bit systems.

- Add the ability to distinguish registry keys and registry values with the
  same name in the same registry subtree.  The key is called "foo" and the
  value will be called "foo%val" in this case.

- Align /proc/cpuinfo more closly to Linux content.

- Add /proc/$PID/mounts entries and a symlink /proc/mounts pointing to
  /proc/self/mounts as on Linux.

- Optimized strstr and memmem implementation.

- Remove backwards compatibility with old signal masks.  (Some *very* old
  programs which use signal masks may no longer work correctly).

</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="setup-net"></a>Chapter 2. Setting Up Cygwin</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#internet-setup">Internet Setup</a></span></dt><dd><dl><dt><span class="sect2"><a href="#setup-download">Download Source</a></span></dt><dt><span class="sect2"><a href="#setup-dir">Selecting an Install Directory</a></span></dt><dt><span class="sect2"><a href="#setup-localdir">Local Package Directory</a></span></dt><dt><span class="sect2"><a href="#setup-connection">Connection Method</a></span></dt><dt><span class="sect2"><a href="#setup-mirror">Choosing Mirrors</a></span></dt><dt><span class="sect2"><a href="#setup-packages">Choosing Packages</a></span></dt><dt><span class="sect2"><a href="#setup-progress">Download and Installation Progress</a></span></dt><dt><span class="sect2"><a href="#setup-icons">Icons</a></span></dt><dt><span class="sect2"><a href="#setup-postinstall">Post-Install Scripts</a></span></dt><dt><span class="sect2"><a href="#setup-troubleshooting">Troubleshooting</a></span></dt></dl></dd><dt><span class="sect1"><a href="#setup-env">Environment Variables</a></span></dt><dt><span class="sect1"><a href="#setup-maxmem">Changing Cygwin's Maximum Memory</a></span></dt><dt><span class="sect1"><a href="#setup-locale">Internationalization</a></span></dt><dd><dl><dt><span class="sect2"><a href="#setup-locale-ov">Overview</a></span></dt><dt><span class="sect2"><a href="#setup-locale-how">How to set the locale</a></span></dt><dt><span class="sect2"><a href="#setup-locale-problems">Potential Problems when using Locales</a></span></dt><dt><span class="sect2"><a href="#setup-locale-missing">What does not work?</a></span></dt><dt><span class="sect2"><a href="#setup-locale-charsetlist">List of supported character sets</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ntsec">Using Windows security in Cygwin</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ntsec-common">Overview</a></span></dt><dt><span class="sect2"><a href="#ntsec-files">File permissions</a></span></dt><dt><span class="sect2"><a href="#ntsec-ids">Special values of user and group ids</a></span></dt><dt><span class="sect2"><a href="#ntsec-mapping">The POSIX permission mapping leak</a></span></dt><dt><span class="sect2"><a href="#ntsec-setuid-overview">Switching the user context</a></span></dt><dt><span class="sect2"><a href="#ntsec-logonuser">Switching the user context with password authentication</a></span></dt><dt><span class="sect2"><a href="#ntsec-nopasswd1">Switching the user context without password, Method 1: Create a token from scratch</a></span></dt><dt><span class="sect2"><a href="#ntsec-nopasswd2">Switching the user context without password, Method 2: LSA authentication package</a></span></dt><dt><span class="sect2"><a href="#ntsec-nopasswd3">Switching the user context without password, Method 3: With password</a></span></dt><dt><span class="sect2"><a href="#ntsec-setuid-impl">Switching the user context, how does it all fit together?</a></span></dt></dl></dd><dt><span class="sect1"><a href="#setup-files">Customizing bash</a></span></dt></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="internet-setup"></a>Internet Setup</h2></div></div></div><p>To install the Cygwin net release, go to <a class="ulink" href="http://cygwin.com/" target="_top">http://cygwin.com/</a> and click on <a class="ulink" href="http://cygwin.com/setup.exe" target="_top">"Install Cygwin Now!"</a>.  This will
download a GUI installer called <span class="command"><strong>setup.exe</strong></span> which can
be run to download a complete cygwin installation via the internet.
Follow the instructions on each screen to install Cygwin.
</p><p>
The <span class="command"><strong>setup.exe</strong></span> installer is designed to be easy
for new users to understand while remaining flexible for the 
experienced. The volunteer development team is constantly working
on <span class="command"><strong>setup.exe</strong></span>; before requesting a new feature,
check the wishlist in the <a class="ulink" href="http://sources.redhat.com/cgi-bin/cvsweb.cgi/setup/README?cvsroot=cygwin-apps&amp;rev=2" target="_top">CVS <code class="literal">README</code>
</a>. It may already be present in the CVS version!
</p><p>
Since the default value for each option is the logical choice for
most installations, you can get a working minimal Cygwin environment
installed by simply clicking the <code class="literal">Next</code> button
at each page. The only exception to this is choosing a Cygwin mirror,
which you can choose by experimenting with those listed at
<a class="ulink" href="http://cygwin.com/mirrors.html" target="_top">
http://cygwin.com/mirrors.html
</a>. For more details about each of page of the 
<span class="command"><strong>setup.exe</strong></span> installation, read on below.
Please note that this guide assumes that you have a basic understanding
of Unix (or a Unix-like OS). If you are new to Unix, you will also want 
to make use of <a class="ulink" href="http://www.google.com/search?q=new+to+unix" target="_top">
other resources</a>.
</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-download"></a>Download Source</h3></div></div></div><p>
Cygwin uses packages to manage installing various software. When
the default <code class="literal">Install from Internet</code> option is chosen,
<span class="command"><strong>setup.exe</strong></span> creates a local directory to store
the packages before actually installing the contents. 
<code class="literal">Download from Internet</code> performs only the first
part (storing the packages locally), while 
<code class="literal">Install from Local Directory</code> performs only the 
second (installing the contents of the packages). 
</p><p>
The <code class="literal">Download from Internet</code> option is mainly
for creating a base Cygwin package tree on one computer for 
installation on several machines with 
<code class="literal">Install from Local Directory</code>; copy the
entire local package tree to another machine with the directory
tree intact. For example, you might create a <code class="literal">C:\cache\</code>
directory and place <span class="command"><strong>setup.exe</strong></span> in it. Run 
<span class="command"><strong>setup.exe</strong></span> to <code class="literal">Install from Internet</code>
or <code class="literal">Download from Internet</code>, then copy the whole
<code class="literal">C:\cache\</code> to each machine and instead choose
<code class="literal">Install from Local Directory</code>. Unfortunately
<span class="command"><strong>setup.exe</strong></span> does not yet support unattended installs.
</p><p>
Though this provides some basic mirroring functionality, if you
are managing a large Cygwin installation, to keep up to date we recommend 
using a mirroring tool such as <span class="command"><strong>wget</strong></span>. A helpful user on 
the Cygwin mailing list created a simple demonstration script to accomplish
this; search the list for <span class="command"><strong>mkcygwget</strong></span> for ideas.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-dir"></a>Selecting an Install Directory</h3></div></div></div><p>
The <code class="literal">Root Directory</code> for Cygwin (default
<code class="literal">C:\cygwin</code>) will become <code class="literal">/</code> 
within your Cygwin installation. You must have write access to
the parent directory, and any ACLs on the parent directory will
determine access to installed files.
</p><p>
The <code class="literal">Install For</code> options of <code class="literal">All Users</code> 
or <code class="literal">Just Me</code> should always be left on the default
<code class="literal">All Users</code>, unless you do not have write access to 
<code class="literal">HKEY_LOCAL_MACHINE</code> in the registry or the All Users 
Start Menu. This is true  even if you are the only user planning to use Cygwin 
on the machine.  Selecting <code class="literal">Just Me</code> will cause problems 
for programs such as <span class="command"><strong>crond</strong></span> and <span class="command"><strong>sshd</strong></span>.
If you do not have the necessary permissions, but still want to use these
programs, consult the Cygwin mailing list archives about others' experiences.

</p><p>
The <code class="literal">Default Text File Type</code> should be left on
<code class="literal">Unix</code> (that is, <code class="literal">\n</code>) unless you
have a very good reason to switch it to 
<code class="literal">DOS</code> (that is, <code class="literal">\r\n</code>).
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-localdir"></a>Local Package Directory</h3></div></div></div><p>
The <code class="literal">Local Package Directory</code> is the cache where 
<span class="command"><strong>setup.exe</strong></span> stores the packages before they are
installed. The cache must not be the same folder as the Cygwin
root. Within the cache, a separate directory is created for each
Cygwin mirror, which allows <span class="command"><strong>setup.exe</strong></span> to use 
multiple mirrors and custom packages. After installing Cygwin,
the cache is no longer necessary, but you may want to retain the
packages as backups, for installing Cygwin to another system,
or in case you need to reinstall a package.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-connection"></a>Connection Method</h3></div></div></div><p>
The <code class="literal">Direct Connection</code> method of downloading will 
directly download the packages, while the IE5 method will leverage your 
IE5 cache for performance. If your organisation uses a proxy server or
auto-configuration scripts, the IE5 method also uses these settings.
If you have a proxy server, you can manually type it into 
the <code class="literal">Use Proxy</code> section. Unfortunately, 
<span class="command"><strong>setup.exe</strong></span> does not currently support password
authorization for proxy servers.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-mirror"></a>Choosing Mirrors</h3></div></div></div><p>
Since there is no way of knowing from where you will be downloading
Cygwin, you need to choose at least one mirror site.  Cygwin mirrors 
are geographically distributed around the world; check the list at <a class="ulink" href="http://cygwin.com/mirrors.html" target="_top">http://cygwin.com/mirrors.html</a>
to find one near you. You can select multiple mirrors by holding down
<code class="literal">CTRL</code> and clicking on each one. If you have the URL of 
an unlisted mirror (for example, if your organization has an internal Cygwin 
mirror) you can add it.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-packages"></a>Choosing Packages</h3></div></div></div><p>
For each selected mirror site, <span class="command"><strong>setup.exe</strong></span> downloads a 
small text file called <code class="literal">setup.bz2</code> that contains a list
of packages available from that site along with some basic information about
each package which <span class="command"><strong>setup.exe</strong></span> parses and uses to create the 
chooser window. For details about the format of this file, see 
the <a class="ulink" href="http://sources.redhat.com/cygwin-apps/setup.html" target="_top">
setup.exe homepage</a>.
</p><p>
The chooser is the most complex part of <span class="command"><strong>setup.exe</strong></span>. 
Packages are grouped into categories, and one package may belong to multiple 
categories (assigned by the volunteer package maintainer). Each package
can be found under any of those categories in the heirarchial chooser view.
By default, <span class="command"><strong>setup.exe</strong></span>
will install only the packages in the <code class="literal">Base</code> category
and their dependencies, resulting in a minimal Cygwin installation.
However, this will not include many commonly used tools such as 
<span class="command"><strong>gcc</strong></span> (which you will find in the <code class="literal">Devel</code> 
category).  Since <span class="command"><strong>setup.exe</strong></span> automatically selects
dependencies, be careful not to unselect any required packages. In 
particular, everything in the <code class="literal">Base</code> category is
required.
</p><p>
You can change <span class="command"><strong>setup.exe</strong></span>'s view style, which is helpful
if you know the name of a package you want to install but not which 
category it is in. 
Click on the <code class="literal">View</code> button and it will rotate between 
<code class="literal">Category</code> (the default), <code class="literal">Full</code> (all 
packages), and <code class="literal">Partial</code> (only packages to be upgraded).
If you are familiar with Unix, you will probably want to at least glance 
through the <code class="literal">Full</code> listing for your favorite tools.
</p><p>
Once you have an existing Cygwin installation, the <span class="command"><strong>setup.exe</strong></span>
chooser is also used to manage your Cygwin installation. 
Information on installed packages is kept in the
<code class="literal">/etc/setup/</code> directory of your Cygwin installation; if 
<span class="command"><strong>setup.exe</strong></span> cannot find this directory it will act as if
you have no Cygwin installation.  If <span class="command"><strong>setup.exe</strong></span>
finds a newer version of an installed package available, it will automatically 
mark it to be upgraded. 
To <code class="literal">Uninstall</code>, <code class="literal">Reinstall</code>, or get the
<code class="literal">Source</code> for an existing package, click on 
<code class="literal">Keep</code> to toggle it. 
Also, to avoid the need to reboot after upgrading, make sure
to close all Cygwin windows and stop all Cygwin processes before 
<span class="command"><strong>setup.exe</strong></span> begins to install the upgraded package.
</p><p>
The final feature of the <span class="command"><strong>setup.exe</strong></span> chooser is for
<code class="literal">Previous</code> and <code class="literal">Experimental</code> packages.
By default the chooser shows only the current version of each package,
though mirrors have at least one previous version and occasionally there
is a testing or beta version of a package available. To see these package,
click on the <code class="literal">Prev</code> or <code class="literal">Exp</code> radio button.
Be warned, however, that the next time you run <span class="command"><strong>setup.exe</strong></span> 
it will try to replace old or experimental versions with the current
stable version. 
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-progress"></a>Download and Installation Progress</h3></div></div></div><p>
First, <span class="command"><strong>setup.exe</strong></span> will download all selected packages
to the local directory chosen earlier. Before installing, 
<span class="command"><strong>setup.exe</strong></span> performs a checksum on each package. If the
local directory is a slow medium (such as a network drive) this can take
a long time. During the download and installation, <span class="command"><strong>setup.exe</strong></span>
shows progress bars for the current task and total remaining disk space.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-icons"></a>Icons</h3></div></div></div><p>
You may choose to install shortcuts on the Desktop and/or Start Menu
to start a <code class="literal">bash</code> shell. If you prefer to use a different
shell or the native Windows version of <code class="literal">rxvt</code>, you can
use these shortcuts as a guide to creating your own. 
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-postinstall"></a>Post-Install Scripts</h3></div></div></div><p>
Last of all, <span class="command"><strong>setup.exe</strong></span> will run any post-install
scripts to finish correctly setting up installed packages. Since each
script is run separately, several windows may pop up. If you are 
interested in what is being done, see the Cygwin Package Contributor's
Guide at <a class="ulink" href="http://cygwin.com/setup.html" target="_top">http://cygwin.com/setup.html</a>
When the last post-install script is completed, <span class="command"><strong>setup.exe</strong></span> 
will display a box announcing the completion. A few packages, such as
the OpenSSH server, require some manual site-specific configuration. 
Relevant documentation can be found in the <code class="literal">/usr/doc/Cygwin/</code> 
or <code class="literal">/usr/share/doc/Cygwin/</code> directory.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-troubleshooting"></a>Troubleshooting</h3></div></div></div><p>
Unfortunately, the complex setup process means that odd problems can
occur. If you're having trouble downloading packages, it may be network
congestion, so try a different mirror and/or a different protocol (i.e.,
HTTP instead of FTP).  If you notice something is not working after
running setup, you can check the <span class="command"><strong>setup.exe</strong></span> log file
at <code class="literal">/var/log/setup.log.full</code>. Make a backup of this
file before running <span class="command"><strong>setup.exe</strong></span> again, and follow the
steps for <a class="ulink" href="http://cygwin.com/problems.html" target="_top">Reporting
Problems with Cygwin</a>.
</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-env"></a>Environment Variables</h2></div></div></div><p>
You may wish to specify settings of several important environment
variables that affect Cygwin's operation.  Some of these settings need
to be in effect prior to launching the initial Cygwin session (before
starting your bash shell, for instance), and are, consequentially, best
placed in a .bat file.  An initial file is named Cygwin.bat and is created
in the Cygwin root directory that you specified during setup.  Note that
the "Cygwin" option of the Start Menu points to Cygwin.bat.  Edit
Cygwin.bat to your liking or create your own .bat files to start
Cygwin processes.</p><p>
The <code class="envar">CYGWIN</code> variable is used to configure many global
settings for the Cygwin runtime system.  Initially you can leave
<code class="envar">CYGWIN</code> unset or set it to <code class="literal">tty</code> (e.g.
to support job control with ^Z etc...) using a syntax like this in the
DOS shell, before launching bash.</p><pre class="screen">
<code class="prompt">C:\&gt;</code> <strong class="userinput"><code>set CYGWIN=tty notitle glob</code></strong>
</pre><p>
Locale support is controlled by the <code class="envar">LANG</code> and
<code class="envar">LC_xxx</code> environment variables.  You can set all of them
but Cygwin itself only honors the variables <code class="envar">LC_ALL</code>,
<code class="envar">LC_CTYPE</code>, and <code class="envar">LANG</code>, in this order, according
to the POSIX standard.  The first one found rules.  For a more detailed
description see <a class="xref" href="#setup-locale" title="Internationalization">the section called &#8220;Internationalization&#8221;</a>.
</p><p>
The <code class="envar">PATH</code> environment variable is used by Cygwin
applications as a list of directories to search for executable files
to run.  This environment variable is converted from Windows format
(e.g. <code class="filename">C:\Windows\system32;C:\Windows</code>) to UNIX format
(e.g., <code class="filename">/cygdrive/c/Windows/system32:/cygdrive/c/Windows</code>)
when a Cygwin process first starts.
Set it so that it contains at least the <code class="filename">x:\cygwin\bin</code>
directory where "<code class="filename">x:\cygwin</code> is the "root" of your
cygwin installation if you wish to use cygwin tools outside of bash.
This is usually done by the batch file you're starting your shell with.
</p><p> 
The <code class="envar">HOME</code> environment variable is used by many programs to
determine the location of your home directory and we recommend that it be
defined.  This environment variable is also converted from Windows format
when a Cygwin process first starts.  It's usually set in the shell
profile scripts in the /etc directory.
</p><p>
The <code class="envar">TERM</code> environment variable specifies your terminal
type.  It is automatically set to <code class="literal">cygwin</code> if you have
not set it to something else.
</p><p>The <code class="envar">LD_LIBRARY_PATH</code> environment variable is used by
the Cygwin function <code class="function">dlopen ()</code> as a list of
directories to search for .dll files to load.  This environment variable
is converted from Windows format to UNIX format when a Cygwin process
first starts.  Most Cygwin applications do not make use of the
<code class="function">dlopen ()</code> call and do not need this variable.
</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-maxmem"></a>Changing Cygwin's Maximum Memory</h2></div></div></div><p>
Cygwin's heap is extensible.  However, it does start out at a fixed size
and attempts to extend it may run into memory which has been previously
allocated by Windows.  In some cases, this problem can be solved by
adding an entry in the either the <code class="literal">HKEY_LOCAL_MACHINE</code>
(to change the limit for all users) or
<code class="literal">HKEY_CURRENT_USER</code> (for just the current user) section
of the registry.  </p><p>
Add the <code class="literal">DWORD</code> value <code class="literal">heap_chunk_in_mb</code> 
and set it to the desired memory limit in decimal MB. It is preferred to do 
this in Cygwin using the <span class="command"><strong>regtool</strong></span> program included in the 
Cygwin package.
(For more information about <span class="command"><strong>regtool</strong></span> or the other Cygwin 
utilities, see <a class="xref" href="#using-utils" title="Cygwin Utilities">the section called &#8220;Cygwin Utilities&#8221;</a> or use the
<code class="literal">--help</code> option of each util.)  You should always be careful 
when using <span class="command"><strong>regtool</strong></span> since damaging your system registry can 
result in an unusable system.  This example sets memory limit to 1024 MB:

</p><pre class="screen">
regtool -i set /HKLM/Software/Cygwin/heap_chunk_in_mb 1024
regtool -v list /HKLM/Software/Cygwin
</pre><p>
</p><p>
Exit all running Cygwin processes and restart them. Memory can be allocated up 
to the size of the system swap space minus any the size of any running 
processes. The system swap should be at least as large as the physically 
installed RAM and can be modified under the System category of the 
Control Panel.  
</p><p>
Here is a small program written by DJ Delorie that tests the 
memory allocation limit on your system:

</p><pre class="screen">
main()
{
  unsigned int bit=0x40000000, sum=0;
  char *x;
  
  while (bit &gt; 4096) 
  {
    x = malloc(bit);
    if (x)
    sum += bit;
    bit &gt;&gt;= 1;
  }
  printf("%08x bytes (%.1fMb)\n", sum, sum/1024.0/1024.0);
  return 0;
}
</pre><p>

You can compile this program using:
</p><pre class="screen">
gcc max_memory.c -o max_memory.exe
</pre><p>

Run the program and it will output the maximum amount of allocatable memory.
</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-locale"></a>Internationalization</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-locale-ov"></a>Overview</h3></div></div></div><p>
Internationalization support is controlled by the <code class="envar">LANG</code> and
<code class="envar">LC_xxx</code> environment variables.  You can set all of them
but Cygwin itself only honors the variables <code class="envar">LC_ALL</code>,
<code class="envar">LC_CTYPE</code>, and <code class="envar">LANG</code>, in this order, according
to the POSIX standard.  The content of these variables should follow the
POSIX standard for a locale specifier.  The correct form of a locale
specifier is</p><pre class="screen">
  language[[_TERRITORY][.charset][@modifier]]
</pre><p>"language" is a lowercase two character string per ISO 639-1,
"TERRITORY" is an uppercase two character string per ISO 3166, charset is
one of a list of supported character sets, and the modifier doesn't matter
here (though it might for some applications).  If you're interested in the
exact description, you can find it in the online publication of the POSIX
manual pages on the homepage of the
<a class="ulink" href="http://www.opengroup.org/" target="_top">Open Group</a>.</p><p>Typical locale specifiers are</p><pre class="screen">
  "de_CH"	   language = German, territory = Switzerland, default charset
  "fr_FR.UTF-8"    language = french, territory = France, charset = UTF-8
  "ko_KR.eucKR"    language = korean, territory = South Korea, charset = eucKR
</pre><p>
And let's not forget the default locale called "C" or "POSIX"
which basically only supports plain ASCII code.  If the aforementioned
environment variables are not set, or set to "C" or "POSIX", you get the
default ASCII-only behaviour.
</p><p>
Right now the language and territory content is not evaluated by Cygwin any
further.  The only important part so far is the character set.  How does that
work?
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-locale-how"></a>How to set the locale</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
The default locale is the "C" or "POSIX" locale.  In this locale, basically
only ASCII characters are supported.  Even if one of the aforementioned
environment variables are set to something else, it's the application's
responsibility to call the function <code class="function">setlocale</code>,
typically like this</p><pre class="screen">
  setlocale (LC_ALL, "");
</pre><p>to switch to another locale according to the settings of the
internationalization environment variables.
</p></li><li style="list-style-type: disc"><p>
Assume that you've set one of the aforementioned environment variables to some
valid POSIX locale value, other than "C" and "POSIX", and assume that you
call an application which calls <code class="function">setlocale</code> as above.</p><p>Assume further that you're living in Japan.  You might want to use
the language code "ja" and the territory "JP", thus setting, say,
<code class="envar">LANG</code> to "ja_JP".  You didn't set a character set, so
what will Cygwin use now?  Easy!  It will use the default Windows ANSI
codepage of your system, if it's supported by Cygwin.  Hopefully Cygwin
supports all relevant default ANSI codepages...</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For a list of supported character sets, see
<a class="xref" href="#setup-locale-charsetlist" title="List of supported character sets">the section called &#8220;List of supported character sets&#8221;</a>
</p></div></li><li style="list-style-type: disc"><p>
You don't want to use the default Windows codepage as character set?
In that case you have to specify the charset explicitly.  For instance,
assume you're from Italy and don't want to use the default Windows codepage
1252, but the more portable ISO-8859-15 character set.  What you can do is
to set the <code class="envar">LANG</code> variable in the
<code class="filename">C:\cygwin\Cygwin.bat</code> file which is the batch file
to start a Cygwin session from the "Cygwin" desktop shortcut.</p><pre class="screen">
  @echo off

  C:
  chdir C:\cygwin\bin
  set LANG=it_IT.ISO-8859-15
  bash --login -i
</pre></li><li style="list-style-type: disc"><p>
Most singlebyte or doublebyte charsets have a disadvantage.  Windows
filesystems use the Unicode character set in the UTF-16 encoding to store filename information.  Not all characters
from the Unicode character set are available in a singlebyte or doublebyte
charset.  While Cygwin has a workaround to access files with unusual
characters (see <a class="xref" href="#pathnames-unusual" title="Filenames with unusual (foreign) characters">the section called &#8220;Filenames with unusual (foreign) characters&#8221;</a>), a better
workaround is to use always the UTF-8 character set.  UTF-8 is the only
multibyte character set which can represent <span class="emphasis"><em>every</em></span>
Unicode character.</p><pre class="screen">
  set LANG=es_MX.UTF-8
</pre><p>For a description of the Unicode standard, see the homepage of the
<a class="ulink" href="http://www.unicode.org/" target="_top">Unicode Consortium</a>.
</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-locale-problems"></a>Potential Problems when using Locales</h3></div></div></div><p>
You can set the above internationalization variables not only in
<code class="filename">Cygwin.bat</code> or in the Windows environment, but also
in your Cygwin shell on the fly, even switch to yet another character
set, and yet another.  In bash for instance:</p><pre class="screen">
  <code class="prompt">bash$</code> export LC_CTYPE="nl_BE.UTF-8"
</pre><p>However, here's a problem.  At the start of the first Cygwin process
in a session, the Windows environment has to be converted from UTF-16 to
some singlebyte or multibyte charset.  If the internationalization environment
variable hasn't been set <span class="emphasis"><em>before</em></span> starting this process,
Cygwin has to make an educated guess which charset to use to convert
the environment itself.  The only reproducible way to do that in the absence
of <code class="envar">LC_ALL</code>, <code class="envar">LC_CTYPE</code>, or <code class="envar">LANG</code>,
is to use the "C" locale.  The default conversion in the "C" locale
used by Cygwin internally is UTF-8.  So, in the absence of any
internationalization environment variable, the environment will be converted
to UTF-8.</p><p>As long as the environment only contains ASCII characters, this is
no problem at all.  But if it contains native characters, and you're planning
to use, say, GBK, the environment will result in invalid characters in
the GBK charset.  This would be especially a problem in variables like
<code class="envar">PATH</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Per POSIX, the name of an environment variable should only
consist of valid ASCII characters, and only of uppercase letters, digits, and
the underscore for maximum portablilty.</p></div><p>Symbolic links, too, may pose a problem when switching charsets on
the fly.  A symbolic link contains the filename of the target file the
symlink points to.  When a symlink had been created with older versions
of Cygwin, the current ANSI or OEM character set had been used to store
the target filename, dependent on the old <code class="envar">CYGWIN</code>
environment variable setting <code class="envar">codepage</code> (see <a class="xref" href="#cygwinenv-removed-options" title="Obsolete options">the section called &#8220;Obsolete options&#8221;</a>.  If the target filename
contains non-ASCII characters and you use another character set than
your default ANSI/OEM charset, the target filename of the symlink is now
potentially an invalid character sequence in the new character set.
This behaviour is not different from the behaviour in other Operating
Systems.  So, if you suddenly can't access a symlink anymore which
worked all these years before, maybe it's because you switched to
another character set.  This doesn't occur with symlinks created with
Cygwin 1.7 or later.  </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-locale-missing"></a>What does not work?</h3></div></div></div><p>
Except for <code class="envar">LC_ALL</code>, <code class="envar">LC_CTYPE</code>,
and <code class="envar">LANG</code>, all other LC_xxx environment variables,
<code class="envar">LC_COLLATE</code>, <code class="envar">LC_MESSAGES</code>,
<code class="envar">LC_MONETARY</code>, <code class="envar">LC_NUMERIC</code>,
and <code class="envar">LC_TIME</code>, are ignored right now.  This means, while Cygwin
supports different character sets, it does <span class="emphasis"><em>not</em></span> support
real localization so far.  There's no support for locale-specific monetary
symbols, for a decimalpoint other than '.', no support for native time
formats, and no support for native language sorting orders.
</p><p>Cygwin's internationalization support is work in progress and we would
be glad for coding help in this area.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-locale-charsetlist"></a>List of supported character sets</h3></div></div></div><p>Last but not least, here's the list of currently supported character
sets.  The left-hand expression is the name of the charset, as you would use
it in the internationalization environment variables as outlined above.
</p><p>The right-hand side is the number of the equivalent Windows
codepage as well as the Windows name of the codepage.  They are only
noted here for reference.  Don't try to use the bare codepage number or
the Windows name of the codepage as charset in locale specifiers, unless
they happen to be identical with the left-hand side.  Especially in case
oif the "CPxxx" style charsets, always use them with the trailing "CP".</p><p>This works:</p><pre class="screen">
  set LC_ALL=en_US.CP437
</pre><p>This does <span class="emphasis"><em>not</em></span> work:</p><pre class="screen">
  set LC_ALL=en_US.437
</pre><p>You can find a full list of Windows codepages on the Microsoft MSDN page
<a class="ulink" href="http://msdn.microsoft.com/en-us/library/dd317756(VS.85).aspx" target="_top">Code Page Identifiers</a>.</p><pre class="screen">
    Charset               Codepage

    CP437                   437 (OEM United States)
    CP720                   720 (DOS Arabic)
    CP737                   737 (OEM Greek)
    CP775                   775 (OEM Baltic)
    CP850                   850 (OEM Latin 1, Western European)
    CP852                   852 (OEM Latin 2, Central European)
    CP855                   855 (OEM Cyrillic)
    CP857                   857 (OEM Turkish)
    CP858                   858 (OEM Latin 1 + Euro Symbol)
    CP862                   862 (OEM Hebrew)
    CP866                   866 (OEM Russian)
    CP874                   874 (ANSI/OEM Thai)
    CP1125                 1125 (OEM Ukraine)
    CP1250                 1250 (ANSI Central European)
    CP1251                 1251 (ANSI Cyrillic)
    CP1252                 1252 (ANSI Latin 1, Western European)
    CP1253                 1253 (ANSI Greek)
    CP1254                 1254 (ANSI Turkish)
    CP1255                 1255 (ANSI Hebrew)
    CP1256                 1256 (ANSI Arabic)
    CP1257                 1257 (ANSI Baltic)
    CP1258                 1258 (ANSI/OEM Vietnamese)

    ISO-8859-1            28591 (ISO-8859-1)
    ISO-8859-2            28592 (ISO-8859-2)
    ISO-8859-3            28593 (ISO-8859-3)
    ISO-8859-4            28594 (ISO-8859-4)
    ISO-8859-5            28595 (ISO-8859-5)
    ISO-8859-6            28596 (ISO-8859-6)
    ISO-8859-7            28597 (ISO-8859-7)
    ISO-8859-8            28598 (ISO-8859-8)
    ISO-8859-9            28599 (ISO-8859-9)
    ISO-8859-10             -   (not available)
    ISO-8859-11             -   (not available)
    ISO-8859-13           28563 (ISO-8859-13)
    ISO-8859-14             -   (not available)
    ISO-8859-15           28565 (ISO-8859-15)
    ISO-8859-16             -   (not available)

    SJIS                    932 (ANSI/OEM Japanese)
    GBK                     936 (ANSI/OEM Simplified Chinese)
    Big5                    950 (ANSI/OEM Traditional Chinese)
    eucJP                 20932 (EUC Japanese)
    eucKR                   949 (EUC Korean)

    UTF-8                 65001 (UTF-8)
</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ntsec"></a>Using Windows security in Cygwin</h2></div></div></div><p>This section discusses how the Windows security model is
utilized in Cygwin to implement POSIX-like permissions, as well as how
the Windows authentication model is used to allow cygwin applications
to switch users in a POSIX-like fashion.</p><p>The setting of POSIX-like file and directory permissions is
controlled by the <a class="link" href="#mount-table" title="The Cygwin Mount Table">mount</a> option
<code class="literal">(no)acl</code> which is set to <code class="literal">acl</code> by
default.</p><p>We start with a short overview.  Note that this overview must
be necessarily short.  If you want to learn more about the Windows security
model, see the <a class="ulink" href="http://msdn.microsoft.com/en-us/library/aa374860(VS.85).aspx" target="_top">Access Control</a> article in MSDN documentation.</p><p>POSIX concepts and specificially the POSIX security model are not
discussed here, but assumed to be understood by the reader.  If you
don't know the POSIX security model, search the web for beginner
documentation.</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ntsec-common"></a>Overview</h3></div></div></div><p>In the Windows security model, almost any "object" is securable.
"Objects" are files, processes, threads, semaphores, etc.</p><p>Every object has a data structure attached, called a "security
descriptor" (SD).  The SD contains all information necessary to control
who can access an object, and to determine what they are allowed to do
to or with it.  The SD of an object consists of five parts:</p><div class="itemizedlist"><ul type="disc" compact><li><p>Flags which control several aspects of this SD. This is
not discussed here.</p></li><li><p>The SID of the object owner.</p></li><li><p>The SID of the object owner group.</p></li><li><p>A list of "Access Control Entries" (ACE), called the
"Discretionary Access Control List" (DACL).</p></li><li><p>Another list of ACEs, called the "Security Access Control List"
(SACL), which doesn't matter for our purpose.  We ignore it here.</p></li></ul></div><p>Every ACE contains a so-called "Security IDentifier" (SID) and
other stuff which is explained a bit later.  Let's talk about the SID first.
</p><p>A SID is a unique identifier for users, groups, computers and
Active Directory (AD) domains.  SIDs are basically comparable to POSIX
user ids (UIDs) and group ids (GIDs), but are more complicated because
they are unique across multiple machines or domains.  A SID is a
structure of multiple numerical values.  There's a convenient convention
to type SIDs, as a string of numerical fields separated by hyphen
characters.  Here's an example:</p><p>SID of a machine "foo":</p><pre class="screen">
  S-1-5-21-165875785-1005667432-441284377
</pre><p>SID of a user "johndoe" of the system "foo":</p><pre class="screen">
  S-1-5-21-165875785-1005667432-441284377-1023
</pre><p>The first field is always "S", which is just a notational convention
to show that this is a SID.  The second field is the version number of
the SID structure, So far there exists only one version of SIDs, so this
field is always 1.  The third and fourth fields represent the "authority"
which can be thought of as a type or category of SIDs.  There are a
couple of builtin accounts and accounts with very special meaning which
have certain well known values in these third and fourth fields.
However, computer and domain SIDs always start with "S-1-5-21".  The
next three fields, all 32 bit values, represent the unique 96 bit
identifier of the computer system.  This is a hopefully unique value all
over the world, but in practice it's sufficient if the computer SIDs are
unique within a single Windows network.</p><p>As you can see in the above example, SIDs of users (and groups)
are identical to the computer SID, except for an additional part, the
so-called "relative identifier" (RID).  So the SID of a user is always 
uniquely attached to the system on which the account has been generated.</p><p>It's a bit different in domains.  The domain has its own SID, and
that SID is identical to the SID of the first domain controller, on
which the domain is created.  Domain user SIDs look exactly like the
computer user SIDs, the leading part is just the domain SID and the RID
is created when the user is created.</p><p>Ok, consider you created a new domain "bar" on some new domain
controller and you would like to create a domain account "johndoe":</p><p>SID of a domain "bar.local":</p><pre class="screen">
  S-1-5-21-186985262-1144665072-740312968
</pre><p>SID of a user "johndoe" in the domain "bar.local":</p><pre class="screen">
  S-1-5-21-186985262-1144665072-740312968-1207
</pre><p>So you now have two accounts called johndoe, one account
created on the machine "foo", one created in the domain "bar.local".
Both have different SIDs and not even the RID is the same.  How do
the systems know it's the same account?  After all, the name is
the same, right?  The answer is, these accounts are <span class="bold"><strong>not</strong></span> identical.  All machines on the network will
treat these SIDs as identifying two separate accounts.  One is
"FOO\johndoe", the other one is "BAR\johndoe" or "johndoe@bar.local".
Different SID, different account.  Full stop.  </p><p>The last part of the SID, the so called "Relative IDentifier" (RID),
is by default used as UID and/or GID under Cygwin when you create the
<code class="filename">/etc/passwd</code> and <code class="filename">/etc/group</code>
files using the <span class="command"><strong><a class="link" href="#mkpasswd" title="mkpasswd">mkpasswd</a></strong></span> and <span class="command"><strong><a class="link" href="#mkgroup" title="mkgroup">mkgroup</a></strong></span>
tools.  Domain account UIDs and GIDs are offset by 10000 by default
which might be a bit low for very big organizations.  Fortunately there's
an option in both tools to change the offset...</p><p>Do you still remember the SIDs with special meaning?  In offical
notation they are called "well-known SIDs".  For example, POSIX has no GID
for the group of "all users" or "world" or "others".  The last three rwx
bits in a unix-style permission value just represent the permissions for
"everyone who is not the owner or is member of the owning group".
Windows has a SID for these poor souls, the "Everyone" SID.  Other
well-known SIDs represent circumstances under which a process is
running, rather than actual users or groups.  Here are a few examples
for well-known SIDs:</p><pre class="screen">
Everyone                        S-1-1-0    Simply everyone...
Batch                           S-1-5-3    Processes started via the task
					   scheduler are member of this group.
Interactive			S-1-5-4    Only processes of users which are
					   logged in via an interactive
					   session are members here.
Authenticated Users             S-1-5-11   Users which have gone through
                                           the authentication process and
					   survived.  Anonymously accessing
					   users are not incuded here.
SYSTEM                          S-1-5-18   A special account which has all
					   kinds of dangerous rights, sort of
					   an uber-root account.
</pre><p>For a full list please refer to the MSDN document <a class="ulink" href="http://msdn.microsoft.com/en-us/library/aa379649.aspx" target="_top">Well-known
SIDs</a>.  The Cygwin package called "csih" provides a tool,
/usr/lib/csih/getAccountName.exe, which can be used to print the
(possibly localized) name for the various well-known SIDS.</p><p>Naturally, well-known SIDs are the same on each machine, so they are
not unique to a machine or domain.  They have the same meaning across
the Windows network.</p><p>Additionally, there are a couple of well-known builtin groups,
which have the same SID on every machine and which have certain user
rights by default:</p><pre class="screen">
administrators                  S-1-5-32-544
users                           S-1-5-32-545
guests                          S-1-5-32-546
...
</pre><p>For instance, every account is usually member in the "Users"
group.  All administrator accounts are member of the "Administrators"
group.  That's all about it as far as single machines are involved.  In
a domain environment it's a bit more tricky.  Since these SIDs are not
unique to a machine, every domain user and every domain group can be a
member of these well known groups.  Consider the domain group "Domain
Admins".  This group is by default in the "Administrators" group.  Let's
assume the above computer called "foo" is a member machine of the domain
"bar.local".  If you stick the user "BAR\johndoe" into the group "Domain
Admins", this guy will automatically be a member of the administrators
group on "foo" when logging on to "foo".  Neat, isn't it?</p><p>Back to ACE and ACL.  POSIX is able to create three different
permissions, the permissions for the owner, for the group and for the
world.  In contrast the Windows ACL has a potentially infinite number of
members... as long as they fit into 64K.  Every member is an ACE.
ACE consist of three parts:</p><div class="itemizedlist"><ul type="disc" compact><li><p>The type of the ACE (allow ACE or deny ACE).</p></li><li><p>Permission bits, 32 of them.</p></li><li><p>The SID for which the permissions are allowed or denied.</p></li></ul></div><p>The two (for us) important types of ACEs are the "access allowed
ACE" and the "access denied ACE".  As the names imply, the allow ACE
tells the system to allow the given permissions to the SID, the deny ACE
results in denying the specific permission bits.</p><p>The possible permissions on objects are more detailed than in
POSIX.  For example, the permission to delete an object is different
from the permission to change object data, and even changing object data
can be separated into different permission bits for different kind of
data.  But there's a problem with the definition of a "correct" ACL
which disallows mapping of certain POSIX permissions cleanly.  See
<a class="xref" href="#ntsec-mapping" title="The POSIX permission mapping leak">the section called &#8220;The POSIX permission mapping leak&#8221;</a>.</p><p>POSIX is able to create only three different permissions?  Not quite.
Newer operating systems and file systems on POSIX systems also provide
access control lists.  Two different APIs exist for accessing these
ACLs, the Solaris API and the POSIX API.  Cygwin implements the Solaris
API to access Windows ACLs in a Unixy way.  At the time of writing this
document, the Cygwin implementation of the Solaris API isn't quite up
to speed.  For instance, it doesn't handle access denied ACEs gracefully.
So, use with care.  Online man pages for the Solaris ACL API can be
found on <a class="ulink" href="http://docs.sun.com" target="_top">http://docs.sun.com</a>.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ntsec-files"></a>File permissions</h3></div></div></div><p>On NTFS and if the <code class="literal">noacl</code> mount option is not
specified for a mount point, Cygwin sets file permissions as in POSIX.
Basically this is done by defining a SD with the matching owner and group
SIDs, and a DACL which contains ACEs for the owner, the group and for
"Everyone", which represents what POSIX calls "others".</p><p>To use Windows security correctly, Cygwin depends on the files
<code class="filename">/etc/passwd</code> and <code class="filename">/etc/group</code>.
These files define the translation between the Cygwin uid/gid and the
Windows SID.  The SID is stored in the pw_gecos field in
<code class="filename">/etc/passwd</code>, and in the gr_passwd field in
<code class="filename">/etc/group</code>. Since the pw_gecos field can contain
more information than just a SID, there are some rules for the layout.
It's required that the SID is the last entry of the pw_gecos field,
assuming that the entries in pw_gecos are comma-separated.  The
commands <span class="command"><strong>mkpasswd</strong></span> and <span class="command"><strong>mkgroup</strong></span>
usually do this for you.</p><p>Another interesting entry in the pw_gecos field (which is also
usually created by running <span class="command"><strong>mkpasswd</strong></span>) is the Windows user
name entry.  It takes the form "U-domain\username" and is sometimes used
by services to authenticate a user.  Logging in through
<span class="command"><strong>telnet</strong></span> is a common scenario.</p><p>A typical snippet from <code class="filename">/etc/passwd</code>:</p><div class="example"><a name="ntsec-passwd"></a><p class="title"><b>Example 2.1. /etc/passwd:</b></p><div class="example-contents"><pre class="screen">
SYSTEM:*:18:544:,S-1-5-18::
Administrators:*:544:544:,S-1-5-32-544::
Administrator:unused:500:513:U-FOO\Administrator,S-1-5-21-790525478-115176313-839522115-500:/home/Administrator:/bin/bash
corinna:unused:11001:11125:U-BAR\corinna,S-1-5-21-2913048732-1697188782-3448811101-1001:/home/corinna:/bin/tcsh
</pre></div></div><br class="example-break"><p>The SYSTEM entry is usually needed by services.  The Administrators
entry (Huh?  A group in /etc/passwd?) is only here to allow
<span class="command"><strong>ls</strong></span> and similar commands to print some file ownerships
correctly.  Windows doesn't care if the owner of a file is a user or a
group.  In older versions of Windows NT the default ownership for files
created by an administrator account was set to the group Administrators
instead of to the creating user account.  This has changed, but you can
still switch to this setting on newer systems.  So it's convenient to
have the Administrators group in
<code class="filename">/etc/passwd</code>.</p><p>The really interesting entries are the next two.  The Administrator
entry is for the local administrator, the corinna entry matches the corinna
account in the domain BAR.  The information given in the pw_gecos field
are all we need to exactly identify an account, and to have a two way
translation, from Windows account name/SID to Cygwin account name uid and
vice versa.  Having this complete information allows us to choose a Cygwin
user name and uid which doesn't have to match the Windows account at all.  As
long as the pw_gecos information is available, we're on the safe side:</p><div class="example"><a name="ntsec-passwd-tweaked"></a><p class="title"><b>Example 2.2. /etc/passwd, tweaked:</b></p><div class="example-contents"><pre class="screen">
root:unused:0:513:U-FOO\Administrator,S-1-5-21-790525478-115176313-839522115-500:/home/Administrator:/bin/bash
thursday_next:unused:11001:11125:U-BAR\corinna,S-1-5-21-2913048732-1697188782-3448811101-1001:/home/corinna:/bin/tcsh
</pre></div></div><br class="example-break"><p>  The above <code class="filename">/etc/passwd</code> will still work fine.
You can now login via <span class="command"><strong>ssh</strong></span> as the user "root", and
Cygwin dutifully translates "root" into the Windows user
"FOO\Administrator" and files owned by FOO\Administrator are shown to
have the uid 0 when calling <span class="command"><strong>ls -ln</strong></span>.  All you do you're
actually doing as Administrator.  Files created as root will be owned by
FOO\Administrator.  And the domain user BAR\corinna can now happily
pretend to be Thursday Next, but will wake up sooner or later finding
out she's still actually the domain user BAR\corinna...</p><p>Do I have to mention that you can also rename groups in
<code class="filename">/etc/group</code>?  As long as the SID is present and correct,
all is well.  This allows you to, for instance, rename the "Administrators"
group to "root" as well:</p><div class="example"><a name="ntsec-group-tweaked"></a><p class="title"><b>Example 2.3. /etc/group, tweaked:</b></p><div class="example-contents"><pre class="screen">
root:S-1-5-32-544:544:
</pre></div></div><br class="example-break"><p>Last but not least, you can also change the primary group of a user
in <code class="filename">/etc/passwd</code>.  The only requirement is that the user
is actually a member of the new primary group in Windows.  For instance,
normal users in a domain environment are members in the group "Domain Users",
which in turn belongs to the well-known group "Users".  So, if it's
more convenient in your environment for the user's primary group to be
"Users", just set the user's primary group in <code class="filename">/etc/passwd</code>
to the Cygwin uid of "Users" (see in <code class="filename">/etc/group</code>,
default 545) and let the user create files with a default group ownership
of "Users".</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
If you wish to make these kind of changes to /etc/passwd and /etc/group,
do so only if you feel comfortable with the concepts.  Otherwise, do not
be surprised if things break in either subtle or surprising ways!  If you
do screw things up, revert to copies of <code class="filename">/etc/passwd</code>
and <code class="filename">/etc/group</code> files created by
<span class="command"><strong>mkpasswd</strong></span> and <span class="command"><strong>mkgroup</strong></span>.  (Make
backup copies of these files before modifying them.)  Especially, don't
change the UID or the name of the user SYSTEM.  It may mostly work, but
some Cygwin applications running as a local service under that account
could suddenly start behaving strangely.
</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ntsec-ids"></a>Special values of user and group ids</h3></div></div></div><p>If the current user is not present in
<code class="filename">/etc/passwd</code>, that user's uid is set to a
special value of 400.  The user name for the current user will always be
shown correctly.  If another user (or a Windows group, treated as a
user) is not present in <code class="filename">/etc/passwd</code>, the uid of
that user will have a special value of -1 (which would be shown by
<span class="command"><strong>ls</strong></span> as 65535).  The user name shown in this case will
be '????????'.</p><p>If the current user is not present in
<code class="filename">/etc/passwd</code>, that user's login gid is set to a
special value of 401.  The gid 401 is shown as 'mkpasswd',
indicating the command that should be run to alleviate the
situation.</p><p>If another user is not present in
<code class="filename">/etc/passwd</code>, that user's login gid is set to a
special value of -1.  If the user is present in
<code class="filename">/etc/passwd</code>, but that user's group is not in
<code class="filename">/etc/group</code> and is not the login group of that user,
the gid is set to a special value of -1.  The name of this group
(id -1) will be shown as '????????'.</p><p>If the current user is present in
<code class="filename">/etc/passwd</code>, but that user's login group is not
present in <code class="filename">/etc/group</code>, the group name will be shown
as 'mkgroup', again indicating the appropriate command.</p><p>A special case is if the current user's primary group SID is noted
in the user's <code class="filename">/etc/passwd</code> entry using another group
id than the group entry of the same group SID in
<code class="filename">/etc/group</code>.  This should be noted and corrected.
The group name printed in this case is
'passwd/group_GID_clash(PPP/GGG)', with PPP being the gid as noted
in <code class="filename">/etc/passwd</code> and GGG the gid as noted in
<code class="filename">/etc/group</code>.</p><p>To summarize:</p><div class="itemizedlist"><ul type="disc" compact><li><p>If the current user doesn't show up in
<code class="filename">/etc/passwd</code>, it's <span class="emphasis"><em>group</em></span> will
be named 'mkpasswd'.</p></li><li><p>Otherwise, if the login group of the current user isn't
in <code class="filename">/etc/group</code>, it will be named 'mkgroup'.</p></li><li><p>Otherwise a group not in <code class="filename">/etc/group</code>
will be shown as '????????' and a user not in
<code class="filename">/etc/passwd</code> will be shown as "????????".</p></li><li><p>If different group ids are used for a group with the same
SID, the group name is shown as 'passwd/group_GID_clash(PPP/GGG)' with
PPP and GGG being the different group ids.</p></li></ul></div><p>
Note that, since the special user and group names are just indicators,
nothing prevents you from actually having a user named `mkpasswd' in
<code class="filename">/etc/passwd</code> (or a group named `mkgroup' in
<code class="filename">/etc/group</code>).  If you do that, however, be aware of
the possible confusion.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ntsec-mapping"></a>The POSIX permission mapping leak</h3></div></div></div><p>As promised earlier, here's the problem when trying to map the
POSIX permission model onto the Windows permission model.</p><p>There's a leak in the definition of a "correct" ACL which
disallows a certain POSIX permission setting.  The official
documentation explains in short the following:</p><div class="itemizedlist"><ul type="disc" compact><li><p>The requested permissions are checked against all
ACEs of the user as well as all groups the user is member of.  The
permissions given in these user and groups access allowed ACEs are
accumulated and the resulting set is the set of permissions of that
user given for that object.</p></li><li><p>The order of ACEs is important. The system reads them in
sequence until either any single requested permission is denied or all
requested permissions are granted.  Reading stops when this condition is
met.  Later ACEs are not taken into account.</p></li><li><p>All access denied ACEs <span class="bold"><strong>should</strong></span> precede any access allowed ACE.  ACLs
following this rule are called "canonical"</p></li></ul></div><p>Note that the last rule is a preference or a definition of
correctness.  It's not an absolute requirement.  All Windows kernels
will correctly deal with the ACL regardless of the order of allow and
deny ACEs.  The second rule is not modified to get the ACEs in the
preferred order.</p><p>Unfortunately the security tab in the file properties dialog of
the Windows NT4 explorer is completely unable to deal with access denied ACEs
while the Windows 2000 and later properties dialog rearranges the order of the
ACEs to canonical order before you can read them. Thank God, the sort
order remains unchanged if one presses the Cancel button.  But don't
even <span class="bold"><strong>think</strong></span> of pressing OK...</p><p>Canonical ACLs are unable to reflect each possible combination
of POSIX permissions. Example:</p><pre class="screen">
rw-r-xrw-
</pre><p>Ok, so here's the first try to create a matching ACL, assuming
the Windows permissions only have three bits, as their POSIX counterpart:
</p><pre class="screen">
UserAllow:   110
GroupAllow:  101
OthersAllow: 110
</pre><p>Hmm, because of the accumulation of allow rights the user may
execute because the group may execute.</p><p>Second try:</p><pre class="screen">
UserDeny:    001
GroupAllow:  101
OthersAllow: 110
</pre><p>Now the user may read and write but not execute. Better? No!
Unfortunately the group may write now because others may write.</p><p>Third try:</p><pre class="screen">
UserDeny:    001
GroupDeny:   010
GroupAllow:  001
OthersAllow: 110
</pre><p>Now the group may not write as intended but unfortunately the user may
not write anymore, either. How should this problem be solved? According to
the canonical order a UserAllow has to follow the GroupDeny but it's
easy to see that this can never be solved that way.</p><p>The only chance:</p><pre class="screen">
UserDeny:    001
UserAllow:   010
GroupDeny:   010
GroupAllow:  001
OthersAllow: 110
</pre><p>Again: This works on all existing versions of Windows NT, at the
time of writing from at least NT4 up to Server 2008.  Only the GUIs
aren't able (or willing) to deal with that order.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ntsec-setuid-overview"></a>Switching the user context</h3></div></div></div><p>Since Windows XP, Windows users have been accustomed to the
"Switch User" feature, which switches the entire desktop to another user
while leaving the original user's desktop "suspended".  Another Windows
feature (since Windows 2000) is the "Run as..." context menu entry,
which allows you to start an application using another user account when
right-clicking on applications and shortcuts.</p><p>On POSIX systems, this operation can be performed by processes
running under the privileged user accounts (usually the "root" user
account) on a per-process basis.  This is called "switching the user
context" for that process, and is performed using the POSIX
<span class="command"><strong>setuid</strong></span> and <span class="command"><strong>seteuid</strong></span> system
calls.</p><p>While this sort of feature is available on Windows as well,
Windows does not support the concept of these calls in a simple fashion.
Switching the user context in Windows is generally a tricky process with
lots of "behind the scenes" magic involved.</p><p>Windows uses so-called `access tokens' to identify a user and its
permissions.  Usually the access token is created at logon time and then
it's attached to the starting process.  Every new process within a session
inherits the access token from its parent process.  Every thread can
get its own access token, which allows, for instance, to define threads
with restricted permissions.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ntsec-logonuser"></a>Switching the user context with password authentication</h3></div></div></div><p>To switch the user context, the process has to request such an access
token for the new user.  This is typically done by calling the Win32 API
function <span class="command"><strong>LogonUser</strong></span> with the user name and the user's
cleartext password as arguments.  If the user exists and the password was
specified correctly, the access token is returned and either used in
<span class="command"><strong>ImpersonateLoggedOnUser</strong></span> to change the user context of
the current thread, or in <span class="command"><strong>CreateProcessAsUser</strong></span> to
change the user context of a spawned child process.</p><p>Later versions of Windows define new functions in this context and
there are also functions to manipulate existing access tokens (usually
only to restrict them).  Windows Vista also adds subtokens which are
attached to other access tokens which plays an important role in the UAC
(User Access Control) facility of Vista and later.  However, none of
these extensions to the original concept are important for this
documentation.</p><p>Back to this logon with password, how can this be used to
implement <span class="command"><strong>set(e)uid</strong></span>?  Well, it requires modification
of the calling application.  Two Cygwin functions have been introduced
to support porting <span class="command"><strong>setuid</strong></span> applications which only
require login with passwords.  You only give Cygwin the right access
token and then you can call <span class="command"><strong>seteuid</strong></span> or
<span class="command"><strong>setuid</strong></span> as usual in POSIX applications.  Porting such
a <span class="command"><strong>setuid</strong></span> application is illustrated by a short
example:</p><pre class="screen">

/* First include all needed cygwin stuff. */
#ifdef __CYGWIN__
#include &lt;windows.h&gt;
#include &lt;sys/cygwin.h&gt;
#endif

[...]

  struct passwd *user_pwd_entry = getpwnam (username);
  char *cleartext_password = getpass ("Password:");

[...]

#ifdef __CYGWIN__
  /* Patch the typical password test. */
  {
    HANDLE token;

    /* Try to get the access token from Windows. */
    token = cygwin_logon_user (user_pwd_entry, cleartext_password);
    if (token == INVALID_HANDLE_VALUE)
       error_exit;
    /* Inform Cygwin about the new impersonation token. */
    cygwin_set_impersonation_token (token);
    /* Cygwin is now able, to switch to that user context by setuid or seteuid calls. */
  }
#else
    /* Use standard method on non-Cygwin systems. */
    hashed_password = crypt (cleartext_password, salt);
    if (!user_pwd_entry ||
        strcmp (hashed_password, user_pwd_entry-&gt;pw_password))
      error_exit;
#endif /* CYGWIN */

[...]

  /* Everything else remains the same! */

  setegid (user_pwd_entry-&gt;pw_gid);
  seteuid (user_pwd_entry-&gt;pw_uid);
  execl ("/bin/sh", ...);


</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ntsec-nopasswd1"></a>Switching the user context without password, Method 1: Create a token from scratch</h3></div></div></div><p>An unfortunate aspect of the implementation of
<span class="command"><strong>set(e)uid</strong></span> is the fact that the calling process
requires the password of the user to which to switch.  Applications such as
<span class="command"><strong>sshd</strong></span> wishing to switch the user context after a
successful public key authentication, or the <span class="command"><strong>cron</strong></span>
application which, again, wants to switch the user without any authentication
are stuck here.  But there are other ways to get new user tokens.</p><p>One way is just to create a user token from scratch.  This is
accomplished by using an (officially undocumented) function on the NT
function level.  The NT function level is used to implement the Win32
level, and, as such is closer to the kernel than the Win32 level.  The
function of interest, <span class="command"><strong>NtCreateToken</strong></span>, allows you to
specify user, groups, permissions and almost everything you need to
create a user token, without the need to specify the user password.  The
only restriction for using this function is that the calling process
needs the "Create a token object" user right, which only the SYSTEM user
account has by default, and which is considered the most dangerous right
a user can have on Windows systems.</p><p>That sounds good.  We just start the servers which have to switch
the user context (<span class="command"><strong>sshd</strong></span>, <span class="command"><strong>inetd</strong></span>,
<span class="command"><strong>cron</strong></span>, ...) as Windows services under the SYSTEM
(or LocalSystem in the GUI) account and everything just works.
Unfortunately that's too simple.  Using <span class="command"><strong>NtCreateToken</strong></span>
has a few drawbacks.</p><p>First of all, beginning with Windows Server 2003,
the permission "Create a token object" gets explicitly removed from
the SYSTEM user's access token, when starting services under that
account.  That requires us to create a new account with this specific
permission just to run this kind of services.  But that's a minor
problem.</p><p>A more important problem is that using <span class="command"><strong>NtCreateToken</strong></span>
is not sufficient to create a new logon session for the new user.  What
does that mean?  Every logon usually creates a new logon session.
A logon session has a couple of attributes which are unique to the
session.  One of these attributes is the fact, that Windows functions
identify the user domain and user name not by the SID of the access
token owner, but only by the logon session the process is running under.</p><p>This has the following unfortunate consequence.  Consider a
service started under the SYSTEM account (up to Windows XP) switches the
user context to DOMAIN\my_user using a token created directly by calling
the <span class="command"><strong>NtCreateToken</strong></span> function.  A process running under
this new access token might want to know under which user account it's
running.  The corresponding SID is returned correctly, for instance
S-1-5-21-1234-5678-9012-77777.  However, if the same process asks the OS
for the user name of this SID something wierd happens.  For instance,
the <span class="command"><strong>LookupAccountSid</strong></span> function will not return
"DOMAIN\my_user", but "NT AUTHORITY\SYSTEM" as the user name.</p><p>You might ask "So what?"  After all, this only <span class="bold"><strong>looks</strong></span> bad, but functionality and permission-wise
everything should be ok.  And Cygwin knows about this shortcoming so it
will return the correct Cygwin username when asked.  Unfortunately this
is more complicated.  Some native, non-Cygwin Windows applications will
misbehave badly in this situation.  A well-known example are certain versions
of Visual-C++.</p><p>Last but not least, you don't have the usual comfortable access
to network shares.  The reason is that the token has been created
without knowing the password.  The password are your credentials
necessary for network access.  Thus, if you logon with a password, the
password is stored hidden as "token credentials" within the access token
and used as default logon to access network resources.  Since these
credentials are missing from the token created with
<span class="command"><strong>NtCreateToken</strong></span>, you only can access network shares
from the new user's process tree by using explicit authentication, on
the command line for instance:</p><pre class="screen">
bash$ net use '\\server\share' /user:DOMAIN\my_user my_users_password
</pre><p>Note that, on some systems, you can't even define a drive letter
to access the share, and under some circumstances the drive letter you
choose collides with a drive letter already used in another session.
Therefore it's better to get used to accessing these shares using the UNC
path as in</p><pre class="screen">
bash$ grep foo //server/share/foofile
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ntsec-nopasswd2"></a>Switching the user context without password, Method 2: LSA authentication package</h3></div></div></div><p>Caveat: The method described in this chapter only works starting
with Windows 2000.  Windows NT4 users have to use one of the other
methods described in this document.</p><p>We're looking for another way to switch the user context without
having to provide the password.  Another technique is to create an
LSA authentication package.  LSA is an acronym for "Local Security Authority"
which is a protected part of the operating system which only allows changes
to become active when rebooting the system after the change.  Also, as soon as
the LSA encounters serious problems (for instance, one of the protected
LSA processes died), it triggers a system reboot.  LSA is the part of
the OS which cares for the user logons and which also creates logon
sessions.</p><p>An LSA authentication package is a DLL which has to be installed
as part of the LSA.  This is done by tweaking a special registry key.
Cygwin provides such an authentication package.  It has to be installed
and the machine has to be rebooted to activate it.  This is the job of the
shell script <code class="filename">/usr/bin/cyglsa-config</code> which is part of
the Cygwin package.</p><p>After running <code class="filename">/usr/bin/cyglsa-config</code> and
rebooting the system, the LSA authentication package is used by Cygwin
when <span class="command"><strong>set(e)uid</strong></span> is called by an application.  The
created access token using this method has its own logon session.</p><p>This method has two advantages over the <span class="command"><strong>NtCreateToken</strong></span>
method.</p><p>The very special and very dangerous "Create a token object" user
right is not required by a user using this method.  Other privileged
user rights are still necessary, especially the "Act as part of the
operating system" right, but that's just business as usual.</p><p>The user is correctly identified, even by delicate native applications
which choke on that using the <span class="command"><strong>NtCreateToken</strong></span> method.</p><p>Disadvantages?  Yes, sure, this is Windows.  The access token
created using LSA authentication still lacks the credentials for network
access.  After all, there still hasn't been any password authentication
involved.  The requirement to reboot after every installation or
deinstallation of the cygwin LSA authentication DLL is just a minor
inconvenience compared to that...</p><p>Nevertheless, this is already a lot better than what we get by
using <span class="command"><strong>NtCreateToken</strong></span>, isn't it?</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ntsec-nopasswd3"></a>Switching the user context without password, Method 3: With password</h3></div></div></div><p>Ok, so we have solved almost any problem, except for the network
access problem.  Not being able to access network shares without
having to specify a cleartext password on the command line or in a 
script is a harsh problem for automated logons for testing purposes
and similar stuff.</p><p>Fortunately there is a solution, but it has its own drawbacks.
But, first things first, how does it work?  The title of this section
says it all.  Instead of trying to logon without password, we just logon
with password.  The password gets stored two-way encrypted in a hidden,
obfuscated area of the registry, the LSA private registry area.  This
part of the registry contains, for instance, the passwords of the Windows
services which run under some non-default user account.</p><p>So what we do is to utilize this registry area for the purpose of
<span class="command"><strong>set(e)uid</strong></span>.  The Cygwin command <span class="command"><strong><a class="link" href="#passwd" title="passwd">passwd</a> -R</strong></span> allows a user to specify
his/her password for storage in this registry area.  When this user
tries to login using ssh with public key authentication, Cygwin's
<span class="command"><strong>set(e)uid</strong></span> examines the LSA private registry area and
searches for a Cygwin specific key which contains the password.  If it
finds it, it calls <span class="command"><strong>LogonUser</strong></span> under the hood, using
this password.  If that works, <span class="command"><strong>LogonUser</strong></span> returns an
access token with all credentials necessary for network access.</p><p>For good measure, and since this way to implement
<span class="command"><strong>set(e)uid</strong></span> is not only used by Cygwin but also by
Microsoft's SFU (Services for Unix), we also look for a key stored by
SFU (using the SFU command <span class="command"><strong>regpwd</strong></span>) and use that if it's
available.</p><p>We got it.  A full access token with its own logon session, with
all network credentials.  Hmm, that's heaven...</p><p>Back on earth, what about the drawbacks?</p><p>First, adding a password to the LSA private registry area
requires administrative access.  So calling <span class="command"><strong>passwd -R</strong></span>
as a normal user will fail!  Cygwin provides a workaround for
this.  If <span class="command"><strong>cygserver</strong></span> is started as a service running
under the SYSTEM account (which is the default way to run
<span class="command"><strong>cygserver</strong></span>) you can use <span class="command"><strong>passwd -R</strong></span>
as normal, non-privileged user as well.</p><p>Second, as aforementioned, the password is two-way encrypted in a
hidden, obfuscated registry area.  Only SYSTEM has access to this area
for listing purposes, so, even as an administrator, you can't examine
this area with regedit.  Right?  No.  Every administrator can start
regedit as SYSTEM user:</p><pre class="screen">
bash$ date
Tue Dec  2 16:28:03 CET 2008
bash$ at 16:29 /interactive regedit.exe
</pre><p>Additionally, if an administrator knows under which name
the private key is stored (which is well-known since the algorithms
used to create the Cygwin and SFU keys are no secret), every administrator
can access the password of all keys stored this way in the registry.</p><p>Conclusion: If your system is used exclusively by you, and if
you're also the only administrator of your system, and if your system is
adequately locked down to prevent malicious access, you can safely use
this method.  If your machine is part of a network which has
dedicated administrators, and you're not one of these administrators,
but you (think you) can trust your administrators, you can probably
safely use this method.</p><p>In all other cases, don't use this method.  You have been warned.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ntsec-setuid-impl"></a>Switching the user context, how does it all fit together?</h3></div></div></div><p>Now we learned about four different ways to switch the user
context using the <span class="command"><strong>set(e)uid</strong></span> system call, but
how does <span class="command"><strong>set(e)uid</strong></span> really work?  Which method does it
use now?</p><p>The answer is, all four of them.  So here's a brief overview
what <span class="command"><strong>set(e)uid</strong></span> does under the hood:</p><div class="itemizedlist"><ul type="disc"><li><p>When <span class="command"><strong>set(e)uid</strong></span> is called, it tests if the
user context had been switched by an earlier call already, and if the
new user account is the privileged user account under which the process
had been started originally.  If so, it just switches to the original
access token of the process it had been started with.</p></li><li><p>
Next, it tests if an access token has been stored by an earlier call
to <span class="command"><strong>cygwin_set_impersonation_token</strong></span>.  If so, it tests
if that token matches the requested user account.  If so, the stored
token is used for the user context switch.</p><p>
If not, there's no predefined token which can just be used for
the user context switch, so we have to create a new token.  The order
is as follows.</p></li><li><p>Check if the user has stored the logon password in the LSA
private registry area, either under a Cygwin key, or under a SFU key.
If so, use this to call <span class="command"><strong>LogonUser</strong></span>.  If this
succeeds, we use the resulting token for the user context switch.</p></li><li><p>Otherwise, check if the Cygwin-specifc LSA authentication package
has been installed and is functional.  If so, use the appropriate LSA
calls to communicate with the Cygwin LSA authentication package and
use the returned token.</p></li><li><p>Last chance, try to use the <span class="command"><strong>NtCreateToken</strong></span> call
to create a token.  If that works, use this token.</p></li><li><p>If all of the above fails, our process has insufficient privileges
to switch the user context at all, so <span class="command"><strong>set(e)uid</strong></span>
fails and returns -1, setting errno to EPERM.</p></li></ul></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-files"></a>Customizing bash</h2></div></div></div><p>
To set up bash so that cut and paste work properly, click on the
"Properties" button of the window, then on the "Misc" tab.  Make sure
that "QuickEdit mode" and "Insert mode" are checked.  These settings
will be remembered next time you run bash from that shortcut. Similarly
you can set the working directory inside the "Program" tab. The entry
"%HOME%" is valid, but requires that you set <code class="envar">HOME</code> in
the Windows environment.
</p><p>
Your home directory should contain three initialization files
that control the behavior of bash.  They are
<code class="filename">.profile</code>, <code class="filename">.bashrc</code> and
<code class="filename">.inputrc</code>.  The Cygwin base installation creates
stub files when you start bash for the first time.</p><p>
<code class="filename">.profile</code> (other names are also valid, see the bash man
page) contains bash commands.  It is executed when bash is started as login
shell, e.g. from the command <span class="command"><strong>bash --login</strong></span>.
This is a useful place to define and
export environment variables and bash functions that will be used by bash
and the programs invoked by bash.  It is a good place to redefine
<code class="envar">PATH</code> if needed.  We recommend adding a ":." to the end of
<code class="envar">PATH</code> to also search the current working directory (contrary
to DOS, the local directory is not searched by default).  Also to avoid
delays you should either <span class="command"><strong>unset</strong></span> <code class="envar">MAILCHECK</code> 
or define <code class="envar">MAILPATH</code> to point to your existing mail inbox.
</p><p>
<code class="filename">.bashrc</code> is similar to
<code class="filename">.profile</code> but is executed each time an interactive
bash shell is launched.  It serves to define elements that are not
inherited through the environment, such as aliases. If you do not use
login shells, you may want to put the contents of
<code class="filename">.profile</code> as discussed above in this file
instead.
</p><p>
</p><pre class="screen">
shopt -s nocaseglob
</pre><p>
will allow bash to glob filenames in a case-insensitive manner.
Note that <code class="filename">.bashrc</code> is not called automatically for login 
shells. You can source it from <code class="filename">.profile</code>.
</p><p>
<code class="filename">.inputrc</code> controls how programs using the readline
library (including <span class="command"><strong>bash</strong></span>) behave.  It is loaded
automatically.  For full details see the <code class="literal">Function and Variable
Index</code> section of the GNU <code class="systemitem">readline</code> manual.
Consider the following settings:
</p><pre class="screen">
# Ignore case while completing
set completion-ignore-case on
# Make Bash 8bit clean
set meta-flag on
set convert-meta off
set output-meta on
</pre><p>
The first command makes filename completion case insensitive, which can
be convenient in a Windows environment.  The next three commands allow
<span class="command"><strong>bash</strong></span> to display 8-bit characters, useful for
languages with accented characters.  Note that tools that do not use
<code class="systemitem">readline</code> for display, such as
<span class="command"><strong>less</strong></span> and <span class="command"><strong>ls</strong></span>, require additional
settings, which could be put in your <code class="filename">.bashrc</code>:
</p><pre class="screen">
alias less='/bin/less -r'
alias ls='/bin/ls -F --color=tty --show-control-chars'
</pre><p>
</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="using"></a>Chapter 3. Using Cygwin</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#using-pathnames">Mapping path names</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pathnames-intro">Introduction</a></span></dt><dt><span class="sect2"><a href="#mount-table">The Cygwin Mount Table</a></span></dt><dt><span class="sect2"><a href="#cygdrive">The cygdrive path prefix</a></span></dt><dt><span class="sect2"><a href="#pathnames-additional">Additional Path-related Information</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-textbinary">Text and Binary modes</a></span></dt><dd><dl><dt><span class="sect2"><a href="#textbin-issue">The Issue</a></span></dt><dt><span class="sect2"><a href="#textbin-default">The default Cygwin behavior</a></span></dt><dt><span class="sect2"><a href="#textbin-example">Example</a></span></dt><dt><span class="sect2"><a href="#textbin-question">Binary or text?</a></span></dt><dt><span class="sect2"><a href="#textbin-devel">Programming</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-filemodes">File permissions</a></span></dt><dt><span class="sect1"><a href="#using-specialnames">Special filenames</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pathnames-etc">Special files in /etc</a></span></dt><dt><span class="sect2"><a href="#pathnames-dosdevices">Invalid filenames</a></span></dt><dt><span class="sect2"><a href="#pathnames-specialchars">Forbidden characters in filenames</a></span></dt><dt><span class="sect2"><a href="#pathnames-unusual">Filenames with unusual (foreign) characters</a></span></dt><dt><span class="sect2"><a href="#pathnames-casesensitive">Case sensitive filenames</a></span></dt><dt><span class="sect2"><a href="#pathnames-posixdevices">POSIX devices</a></span></dt><dt><span class="sect2"><a href="#pathnames-exe">The .exe extension</a></span></dt><dt><span class="sect2"><a href="#pathnames-proc">The /proc filesystem</a></span></dt><dt><span class="sect2"><a href="#pathnames-proc-registry">The /proc/registry filesystem</a></span></dt><dt><span class="sect2"><a href="#pathnames-at">The @pathnames</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-cygwinenv">The CYGWIN environment
variable</a></span></dt><dd><dl><dt><span class="sect2"><a href="#cygwinenv-implemented-options">Implemented options</a></span></dt><dt><span class="sect2"><a href="#cygwinenv-removed-options">Obsolete options</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-cygserver">Cygserver</a></span></dt><dd><dl><dt><span class="sect2"><a href="#what-is-cygserver">What is Cygserver?</a></span></dt><dt><span class="sect2"><a href="#cygserver-command-line">Cygserver command line options</a></span></dt><dt><span class="sect2"><a href="#start-cygserver">How to start Cygserver</a></span></dt><dt><span class="sect2"><a href="#cygserver-config">The Cygserver configuration file</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-utils">Cygwin Utilities</a></span></dt><dd><dl><dt><span class="sect2"><a href="#cygcheck">cygcheck</a></span></dt><dt><span class="sect2"><a href="#cygpath">cygpath</a></span></dt><dt><span class="sect2"><a href="#dumper">dumper</a></span></dt><dt><span class="sect2"><a href="#getfacl">getfacl</a></span></dt><dt><span class="sect2"><a href="#kill">kill</a></span></dt><dt><span class="sect2"><a href="#mkgroup">mkgroup</a></span></dt><dt><span class="sect2"><a href="#mkpasswd">mkpasswd</a></span></dt><dt><span class="sect2"><a href="#mount">mount</a></span></dt><dt><span class="sect2"><a href="#passwd">passwd</a></span></dt><dt><span class="sect2"><a href="#ps">ps</a></span></dt><dt><span class="sect2"><a href="#regtool">regtool</a></span></dt><dt><span class="sect2"><a href="#setfacl">setfacl</a></span></dt><dt><span class="sect2"><a href="#ssp">ssp</a></span></dt><dt><span class="sect2"><a href="#strace">strace</a></span></dt><dt><span class="sect2"><a href="#umount">umount</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-effectively">Using Cygwin effectively with Windows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#using-pathnames-effectively">Pathnames</a></span></dt><dt><span class="sect2"><a href="#using-console">Console Programs</a></span></dt><dt><span class="sect2"><a href="#using-net">Cygwin and Windows Networking</a></span></dt><dt><span class="sect2"><a href="#using-cygutils">The cygutils package</a></span></dt><dt><span class="sect2"><a href="#using-shortcuts">Creating shortcuts with cygutils</a></span></dt><dt><span class="sect2"><a href="#using-printing">Printing with cygutils</a></span></dt></dl></dd></dl></div><p>This chapter explains some key differences between the Cygwin
environment and traditional UNIX systems. It assumes a working
knowledge of standard UNIX commands.</p><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-pathnames"></a>Mapping path names</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-intro"></a>Introduction</h3></div></div></div><p>Cygwin supports both Win32- and POSIX-style paths.  Directory
delimiters may be either forward slashes or backslashes.  Paths using
backslashes are always handled as Win32 paths.  POSIX paths must only
use forward slashes as delimiter, otherwise they are treated as Win32
paths and file access might fail in surprising ways.  Note that the
usage of Win32 paths, though possible, is deprecated, since it
circumvents important internal path handling mechanisms.  UNC pathnames
(starting with two slashes and a network name) are also supported.
</p><p>POSIX operating systems (such as Linux) do not have the concept
of drive letters.  Instead, all absolute paths begin with a
slash (instead of a drive letter such as "c:") and all file systems
appear as subdirectories (for example, you might buy a new disk and
make it be the <code class="filename">/disk2</code> directory).</p><p>Because many programs written to run on UNIX systems assume
the existance of a single unified POSIX file system structure, Cygwin
maintains a special internal POSIX view of the Win32 file system
that allows these programs to successfully run under Windows.  Cygwin
uses this mapping to translate from POSIX to Win32 paths as
necessary.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mount-table"></a>The Cygwin Mount Table</h3></div></div></div><p>The <code class="filename">/etc/fstab</code> file is used to map Win32
drives and network shares into Cygwin's internal POSIX directory tree.
This is a similar concept to the typical UNIX fstab file.  The mount
points stored in <code class="filename">/etc/fstab</code> are globally set for
all users.  Sometimes there's a requirement to have user specific
mount points.  The Cygwin DLL supports user specific fstab files.
These are stored in the directory <code class="filename">/etc/fstab.d</code>
and the name of the file is the Cygwin username of the user, as it's
stored in the <code class="filename">/etc/passwd</code> file.  The content of the
user specifc file is identical to the system-wide
<code class="filename">fstab</code> file.</p><p>The file fstab contains descriptive information about the various file
systems.  fstab is only read by programs, and not written; it is the
duty of the system administrator to properly create and maintain this
file.  Each filesystem is described on a separate line; fields on each
line are separated by tabs or spaces.  Lines starting with '#' are
comments.</p><p>The first field describes the block special device or
remote filesystem to be mounted.  On Cygwin, this is the native Windows
path which the mount point links in.  As path separator you MUST use a
slash.  Usage of a backslash might lead to unexpected results.  UNC
paths (using slashes, not backslashes) are allowed.  If the path
contains spaces these can be escaped as <code class="literal">'\040'</code>.</p><p>The second field describes the mount point for the filesystem. 
If the name of the mount point contains spaces these can be
escaped as '\040'.</p><p>The third field describes the type of the filesystem.
Cygwin supports any string here, since the file system type is usually
not evaluated.  The notable exception is the file system type
cygdrive.  This type is used to set the cygdrive prefix.</p><p>The fourth field describes the mount options associated
with the filesystem.  It is formatted as a comma separated list of
options.  It contains at least the type of mount (binary or text) plus
any additional options appropriate to the filesystem type.  Recognized
options are binary, text, nouser, user, exec, notexec, cygexec, nosuid,
posix=[0|1].  The meaning of the options is as follows.</p><pre class="screen">
  acl       - Cygwin uses the filesystem's access control lists (ACLs) to
              implement real POSIX permissions (default).  This flag only
	      affects filesystems supporting ACLs (NTFS) and is ignored
	      otherwise.
  auto      - Ignored.
  binary    - Files default to binary mode (default).
  cygexec   - Treat all files below mount point as cygwin executables.
  exec      - Treat all files below mount point as executable.
  noacl     - Cygwin ignores filesystem ACLs and only fakes a subset of
	      permission bits based on the DOS readonly attribute.  This
	      behaviour is the default on FAT and FAT32.  The flag is
	      ignored on NFS filesystems.
  nosuid    - No suid files are allowed (currently unimplemented).
  notexec   - Treat all files below mount point as not executable.
  nouser    - Mount is a system-wide mount.
  override  - Force the override of an immutable mount point (currently "/").
  posix=0   - Switch off case sensitivity for paths under this mount point.
  posix=1   - Switch on case sensitivity for paths under this mount point
	      (default).
  text      - Files default to CRLF text mode line endings.
  user      - Mount is a user mount.
</pre><p>While normally the execute permission bits are used to evaluate
executability, this is not possible on filesystems which don't support
permissions at all (like FAT/FAT32), or if ACLs are ignored on filesystems
supporting them (see the aforementioned <code class="literal">acl</code> mount option).
In these cases, the following heuristic is used to evaluate if a file is
executable: Files ending in certain extensions (.exe, .com, .bat, .btm,
.cmd) are assumed to be executable.  Files whose first two characters begin
with '#!' are also considered to be executable.
The <code class="literal">exec</code> option is used to instruct Cygwin that the
mounted file is "executable".  If the <code class="literal">exec</code> option is used
with a directory then all files in the directory are executable.
This option allows other files to be marked as executable and avoids the
overhead of opening each file to check for a '#!'.  The
<code class="literal">cygexec</code> option is very similar to <code class="literal">exec</code>,
but also prevents Cygwin from setting up commands and environment variables
for a normal Windows program, adding another small performance gain.  The
opposite of these options is the <code class="literal">notexec</code> option, which
means that no files should be marked as executable under that mount point.</p><p>A correct root directory is quite essential to the operation of
Cygwin.  A default root directory is evaluated at startup so a
<code class="filename">fstab</code> entry for the root directory is not necessary.
If it's wrong, nothing will work as expected.  Therefore, the root directory
evaluated by Cygwin itself is treated as an immutable mount point and can't
be overridden in /etc/fstab... unless you think you really know what you're
doing.  In this case, use the <code class="literal">override</code> flag in the options
field in the <code class="filename">/etc/fstab</code> file.  Since this is a dangerous
thing to do, do so at your own risk.</p><p><code class="filename">/usr/bin</code> and <code class="filename">/usr/lib</code> are
by default also automatic mount points generated by the Cygwin DLL similar
to the way the root directory is evaluated.  <code class="filename">/usr/bin</code>
points to the directory the Cygwin DLL is installed in,
<code class="filename">/usr/lib</code> is suppsoed to point to the
<code class="filename">/lib</code> directory.  This choice is safe and usually
shouldn't be changed.  An fstab entry for them is not required.</p><p><code class="literal">nouser</code> mount points are not overridable by a later
call to <span class="command"><strong>mount</strong></span>.
Mount points given in <code class="filename">/etc/fstab</code> are by default
<code class="literal">nouser</code> mount points, unless you specify the option
<code class="literal">user</code>.  This allows the administrator to set certain
paths so that they are not overridable by users.  In contrast, all mount
points in the user specific fstab file are <code class="literal">user</code> mount
points.</p><p>The fifth and sixth field are ignored.  They are
so far only specified to keep a Linux-like fstab file layout.</p><p>Note that you don't have to specify an fstab entry for the root dir,
unless you want to have the root dir pointing to somewhere entirely
different (hopefully you know what you're doing), or if you want to
mount the root dir with special options (for instance, as text mount).</p><p>Example entries:</p><div class="itemizedlist"><ul type="disc" compact><li><p>Just a normal mount point:</p><pre class="screen">c:/foo /bar fat32 binary 0 0</pre></li><li><p>A mount point for a textmode mount with case sensitivity switched off:</p><pre class="screen">C:/foo /bar/baz ntfs text,posix=0 0 0</pre></li><li><p>A mount point for a Windows directory with spaces in it:</p><pre class="screen">C:/Documents\040and\040Settings /docs ext3 binary 0 0</pre></li><li><p>A mount point for a remote directory without ACL support:</p><pre class="screen">//server/share/subdir /srv/subdir smbfs binary,noacl 0 0</pre></li><li><p>This is just a comment:</p><pre class="screen"># This is just a comment</pre></li><li><p>Set the cygdrive prefix to /mnt:</p><pre class="screen">none /mnt cygdrive binary 0 0</pre></li></ul></div><p>Whenever Cygwin generates a Win32 path from a POSIX one, it uses
the longest matching prefix in the mount table.  Thus, if
<code class="filename">C:</code> is mounted as <code class="filename">/c</code> and also
as <code class="filename">/</code>, then Cygwin would translate
<code class="filename">C:/foo/bar</code> to <code class="filename">/c/foo/bar</code>.
This translation is normally only used when trying to derive the
POSIX equivalent current directory.  Otherwise, the handling of MS-DOS
filenames bypasses the mount table.
</p><p>If you want to see the current set of mount points valid in your
session, you can invoking the Cygwin tool <span class="command"><strong>mount</strong></span> without
arguments:</p><div class="example"><a name="pathnames-mount-ex"></a><p class="title"><b>Example 3.1. Displaying the current set of mount points</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">bash$</code> <strong class="userinput"><code>mount</code></strong>
f:/cygwin/bin on /usr/bin type system (binary,auto)
f:/cygwin/lib on /usr/lib type system (binary,auto)
f:/cygwin on / type system (binary,auto)
e:/src on /usr/src type system (binary)
c: on /cygdrive/c type user (binary,posix=0,user,noumount,auto)
e: on /cygdrive/e type user (binary,posix=0,user,noumount,auto)
</pre></div></div><br class="example-break"><p>You can also use the <span class="command"><strong>mount</strong></span> command to add
new mount points, and the <span class="command"><strong>umount</strong></span> to delete
them.  However, since they are only noted in memory, these mount
points will disappear as soon as your last Cygwin process ends.
See <a class="xref" href="#mount" title="mount">the section called &#8220;mount&#8221;</a> and <a class="xref" href="#umount" title="umount">the section called &#8220;umount&#8221;</a> for more
information.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
When you upgrade an existing older Cygwin installation to Cygwin 1.7,
your old system mount points (stored in the HKEY_LOCAL_MACHINE branch
of your registry) are read by a script and the <code class="filename">/etc/fstab</code>
file is generated from these entries.  Note that entries for
<code class="filename">/</code>, <code class="filename">/usr/bin</code>, and
<code class="filename">/usr/lib</code> are <span class="emphasis"><em>never</em></span> generated.
</p><p>
The old user mount points in your HKEY_CURRENT_USER branch of the registry
are not used to generate <code class="filename">/etc/fstab</code>.  If you want
to create a user specific <code class="filename">/etc/fstab.d/${USER}</code> file
from your old entries, there's a script available which does exactly
that for you, <code class="filename">bin/copy-user-registry-fstab</code>.  Just
start the script and it will create your user specific fstab file.  Stop
all your Cygwin processes and restart them, and you can simply use your
old user mount points as before.
</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cygdrive"></a>The cygdrive path prefix</h3></div></div></div><p>As already outlined in <a class="xref" href="#ov-hi-files" title="File Access">the section called &#8220;File Access&#8221;</a>, you can
access arbitary drives on your system by using the cygdrive path prefix.
The default value for this prefix is <code class="literal">/cygdrive</code>, and
a path to any drive can be constructed by using the cygdrive prefix and
appending the drive letter as subdirectory, like this:</p><pre class="screen">
  bash$ ls -l /cygdrive/f/somedir
</pre><p>This lists the content of the directory F:\somedir.</p><p>The cygdrive prefix is a virtual directory under which all drives
on a system are subsumed.  The mount options of the cygdrive prefix is
used for all file access through the cygdrive prefixed drives.  For instance,
assuming the cygdrive mount options are <code class="literal">binary,posix=0</code>,
then any file <code class="literal">/cygdrive/x/file</code> will be opened in
binary mode by default (mount option <code class="literal">binary</code>, and the case
of the filename doesn't matter (mount option <code class="literal">posix=0</code>.
</p><p>The cygdrive prefix may be changed in the fstab file as outlined above.
Please note that you must not use the cygdrive prefix for any other mount
point.  For instance this:</p><pre class="screen">
  none /cygdrive cygdrive binary 0 0
  D:   /cygdrive/d somefs text 0 0
</pre><p>will not make file access using the /mnt/d path prefix suddenly using
textmode.  If you want to mount any drive explicitly in another mode than
the cygdrive prefix, use a distinct path prefix:</p><pre class="screen">
  none /cygdrive cygdrive binary 0 0
  D:   /mnt/d somefs text 0 0
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-additional"></a>Additional Path-related Information</h3></div></div></div><p>The <span class="command"><strong>cygpath</strong></span> program provides the ability to
translate between Win32 and POSIX pathnames in shell scripts. See
<a class="xref" href="#cygpath" title="cygpath">the section called &#8220;cygpath&#8221;</a> for the details.</p><p>The <code class="envar">HOME</code>, <code class="envar">PATH</code>, and
<code class="envar">LD_LIBRARY_PATH</code> environment variables are automatically
converted from Win32 format to POSIX format (e.g.  from
<code class="filename">c:/cygwin\bin</code> to <code class="filename">/bin</code>, if
there was a mount from that Win32 path to that POSIX path) when a Cygwin
process first starts.</p><p>Symbolic links can also be used to map Win32 pathnames to POSIX.
For example, the command
<span class="command"><strong>ln -s //pollux/home/joe/data /data</strong></span> would have about
the same effect as creating a mount point from
<code class="filename">//pollux/home/joe/data</code> to <code class="filename">/data</code>
using <span class="command"><strong>mount</strong></span>, except that symbolic links cannot set
the default file access mode.  Other differences are that the mapping is
distributed throughout the file system and proceeds by iteratively
walking the directory tree instead of matching the longest prefix in a
kernel table.  Note that symbolic links will only work on network
drives that are properly configured to support the "system" file
attribute.  Many do not do so by default (the Unix Samba server does
not by default, for example).</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-textbinary"></a>Text and Binary modes</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="textbin-issue"></a>The Issue</h3></div></div></div><p>On a UNIX system, when an application reads from a file it gets
exactly what's in the file on disk and the converse is true for writing.
The situation is different in the DOS/Windows world where a file can
be opened in one of two modes, binary or text.  In the binary mode the
system behaves exactly as in UNIX.  However on writing in text mode, a
NL (\n, ^J) is transformed into the sequence CR (\r, ^M) NL.
</p><p>This can wreak havoc with the seek/fseek calls since the number
of bytes actually in the file may differ from that seen by the
application.</p><p>The mode can be specified explicitly as explained in the Programming
section below.  In an ideal DOS/Windows world, all programs using lines as
records (such as <span class="command"><strong>bash</strong></span>, <span class="command"><strong>make</strong></span>,
<span class="command"><strong>sed</strong></span> ...) would open files (and change the mode of their
standard input and output) as text.  All other programs (such as
<span class="command"><strong>cat</strong></span>, <span class="command"><strong>cmp</strong></span>, <span class="command"><strong>tr</strong></span> ...)
would use binary mode.  In practice with Cygwin, programs that deal
explicitly with object files specify binary mode (this is the case of
<span class="command"><strong>od</strong></span>, which is helpful to diagnose CR problems).  Most
other programs (such as <span class="command"><strong>cat</strong></span>, <span class="command"><strong>cmp</strong></span>,
<span class="command"><strong>tr</strong></span>) use the default mode.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="textbin-default"></a>The default Cygwin behavior</h3></div></div></div><p>The Cygwin system gives us some flexibility in deciding how files 
are to be opened when the mode is not specified explicitly. 
The rules are evolving, this section gives the design goals.</p><div class="orderedlist"><ol type="a"><li><p>If the filename is specified as a POSIX path and it appears to
reside on a file system that is mounted (i.e.  if its pathname starts
with a directory displayed by <span class="command"><strong>mount</strong></span>), then the
default is specified by the mount flag.  If the file is a symbolic link,
the mode of the target file system applies.</p></li><li><p>If the file is specified via a MS-DOS pathname (i.e., it contains a
backslash or a colon), the default is binary.
</p></li><li><p>Pipes, sockets and non-file devices are opened in binary mode.
For pipes opened through the pipe() system call you can use the setmode()
function (see <a class="xref" href="#textbin-devel" title="Programming">the section called &#8220;Programming&#8221;</a> to switch to textmode.
For pipes opened through popen(), you can simply specify text or binary
mode just like in calls to fopen().</p></li><li><p>Sockets and other non-file devices are always opened in binary mode.
</p></li><li><p> When redirecting, the Cygwin shells uses rules (a-d).
Non-Cygwin shells always pipe and redirect with binary mode. With
non-Cygwin shells the commands <span class="command"><strong> cat filename | program </strong></span>
and <span class="command"><strong> program &lt; filename </strong></span> are not equivalent when
<code class="filename">filename</code> is on a text-mounted partition. </p></li></ol></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="textbin-example"></a>Example</h3></div></div></div><p>To illustrate the various rules, we provide scripts to delete CRs
from files by using the <span class="command"><strong>tr</strong></span> program, which can only write
to standard output. 
The script</p><pre class="screen">

#!/bin/sh
# Remove \r from the file given as argument
tr -d '\r' &lt; "$1" &gt; "$1".nocr

</pre><p> will not work on a text mounted systems because the \r will be 
reintroduced on writing. However scripts such as </p><pre class="screen">

#!/bin/sh
# Remove \r from the file given as argument
tr -d '\r' | gzip | gunzip &gt; "$1".nocr

</pre><p>and the .bat file</p><pre class="screen">

REM Remove \r from the file given as argument
@echo off
tr -d \r &lt; %1 &gt; %1.nocr

</pre><p> work fine. In the first case we rely on <span class="command"><strong>gunzip</strong></span> to
set its output to binary mode, possibly overriding the mode used by the shell.
In the second case we rely on the DOS shell to redirect in binary mode.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="textbin-question"></a>Binary or text?</h3></div></div></div><p>UNIX programs that have been written for maximum portability
will know the difference between text and binary files and act
appropriately under Cygwin.  Most programs included in the official
Cygwin distributions should work well in the default mode. </p><p>Binmode is the best choice usually since it's faster and
easier to handle, unless you want to exchange files with native Win32
applications.  It makes most sense to keep the Cygwin distribution
and your Cygwin home directory in binmode and generate text files in
binmode (with UNIX LF lineendings).  Most Windows applications can
handle binmode files just fine.  A notable exception is the mini-editor
<span class="command"><strong>Notepad</strong></span>, which handles UNIX lineendings incorrectly
and only produces output files with DOS CRLF lineendings.</p><p>You can convert files between CRLF and LF lineendings by using
certain tools in the Cygwin distribution like <span class="command"><strong>d2u</strong></span> and
<span class="command"><strong>u2d</strong></span> from the cygutils package.  You can also specify
a directory in the mount table to be mounted in textmode so you can use
that directory for exchange purposes.</p><p>As application programmer you can decide on a file by file base,
or you can specify default open modes depending on the purpose for which
the application open files.  See the next section for a description of
your choices.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="textbin-devel"></a>Programming</h3></div></div></div><p>In the <code class="function">open()</code> function call, binary mode can be
specified with the flag <code class="literal">O_BINARY</code> and text mode with
<code class="literal">O_TEXT</code>. These symbols are defined in
<code class="filename">fcntl.h</code>.</p><p>In the <code class="function">fopen()</code> and <code class="function">popen()</code>
function calls, binary mode can be specified by adding a <code class="literal">b</code>
to the mode string. Text mode is specified by adding a <code class="literal">t</code>
to the mode string.</p><p>The mode of a file can be changed by the call
<code class="function">setmode(fd,mode)</code> where <code class="literal">fd</code> is a file
descriptor (an integer) and <code class="literal">mode</code> is
<code class="literal">O_BINARY</code> or <code class="literal">O_TEXT</code>. The function
returns <code class="literal">O_BINARY</code> or <code class="literal">O_TEXT</code> depending
on the mode before the call, and <code class="literal">EOF</code> on error.</p><p>There's also a convenient way to set the default open modes used
in an application by just linking against various object files provided
by Cygwin.  For instance, if you want to make sure that all files are
always opened in binary mode by an application, regardless of the mode
of the underlying mount point, just add the file
<code class="filename">/lib/binmode.o</code> to the link stage of the application
in your project, like this:</p><pre class="screen">
  $ gcc my_tiny_app.c /lib/binmode.o -o my_tiny_app
</pre><p>This adds code which sets the default open mode for all files
opened by <span class="command"><strong>my_tiny_app</strong></span> to binary for reading and
writing.</p><p>Cygwin provides the following object files to set the default open mode
just by linking an application against them:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><pre class="screen">
/lib/automode.o      -  Open files for reading in textmode
                        Open files for writing in binary mode
</pre></li><li style="list-style-type: disc"><pre class="screen">
/lib/binmode.o       -  Open files for reading and writing in binary mode
</pre></li><li style="list-style-type: disc"><pre class="screen">
/lib/textmode.o      -  Open files for reading and writing in textmode
</pre></li><li style="list-style-type: disc"><pre class="screen">
/lib/textreadmode.o  -  Open files for reading in textmode
                        Keep default behaviour for writing.
</pre></li></ul></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-filemodes"></a>File permissions</h2></div></div></div><p>On FAT or FAT32 filesystems, files are always readable, and Cygwin
uses the DOS read-only attribute to determine if they are writable. Files are
considered to be executable if the filename ends with .bat, .com or .exe, or
if its content starts with #!. Consequently <span class="command"><strong>chmod</strong></span> can
only affect the "w" mode, it silently ignores actions involving the other
modes.  This means that <span class="command"><strong>ls -l</strong></span>
needs to open and read files. It can thus be relatively slow.</p><p>On NTFS, file permissions are evaluated using the Access Control
Lists (ACLs) attached to a file.  This can be switched off by using the
"noacl" option to the respective mount point in the
<code class="filename">/etc/fstab</code> or <code class="filename">/etc/fstab.d/$USER</code>
file.  For more information on file permissions, see



<a class="xref" href="#ntsec" title="Using Windows security in Cygwin">the section called &#8220;Using Windows security in Cygwin&#8221;</a>.
</p><p>On NFS shares, file permissions are exactly the POSIX permissions
transmitted from the server using the NFSv3 protocol, if the NFS client
is the one from Microsoft's "Services For Unix", or the one built into
Windows Vista or later.
</p><p>Only the user and group ownership is not necessarily correct.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-specialnames"></a>Special filenames</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-etc"></a>Special files in /etc</h3></div></div></div><p>Certain files in Cygwin's <code class="filename">/etc</code> directory are
read by Cygwin before the mount table has been established.  The list
of files is</p><pre class="screen">
  /etc/fstab
  /etc/fstab.d/$USER
  /etc/passwd
  /etc/group
</pre><p>These file are read using native Windows NT functions which have
no notion of Cygwin symlinks or POSIX paths.  For that reason
there are a few requirements as far as <code class="filename">/etc</code> is
concerned.</p><p>To access these files, the Cygwin DLL evaluates it's own full
Windows path, strips off the innermost directory component and adds
"\etc".  Let's assume the Cygwin DLL is installed as
<code class="filename">C:\cygwin\bin\cygwin1.dll</code>.  First the DLL name as
well as the innermost directory (<code class="filename">bin</code>) is stripped
off: <code class="filename">C:\cygwin\</code>.  Then "etc" and the filename to
look for is attached: <code class="filename">C:\cygwin\etc\fstab</code>.  So the
/etc directory must be parallel to the directory in which the cygwin1.dll
exists and <code class="filename">/etc</code> must not be a Cygwin symlink
pointing to another directory.  Consequentially none of the files from
the above list, including the directory <code class="filename">/etc/fstab.d</code>
is allowed to be a Cygwin symlink either.</p><p>However, native NTFS symlinks and reparse points are transparent
when accessing the above files so all these files as well as
<code class="filename">/etc</code> itself may be NTFS symlinks or reparse
points.</p><p>Last but not least, make sure that these files are world-readable.
Every process of any user account has to read these files potentially,
so world-readability is essential.  The only exception are the user
specific files <code class="filename">/etc/fstab.d/$USER</code>, which only have
to be readable by the $USER user account itself.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-dosdevices"></a>Invalid filenames</h3></div></div></div><p>Filenames invalid under Win32 are not necessarily invalid
under Cygwin since release 1.7.0.  There are a few rules which
apply to Windows filenames.  Most notably, DOS device names like
<code class="filename">AUX</code>, <code class="filename">COM1</code>,
<code class="filename">LPT1</code> or <code class="filename">PRN</code> (to name a few)
cannot be used as filename or extension in a native Win32 application.
So filenames like <code class="filename">prn.txt</code> or <code class="filename">foo.aux</code>
are invalid filenames for native Win32 applications.</p><p>This restriction doesn't apply to Cygwin applications.  Cygwin
can create and access files with such names just fine.  Just don't try
to use these files with native Win32 applications.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-specialchars"></a>Forbidden characters in filenames</h3></div></div></div><p>Win32 filenames can't contain trailing dots and spaces for backward
compatibility.  When trying to create files with trailing dots or spaces,
all of them are removed before the file is created.  This restriction only
affects native Win32 applications.  Cygwin applications can create and
access files with trailing dots and spaces without problems.</p><p>Some characters are disallowed in filenames on Windows filesystems:</p><pre class="screen">
  "   *   :   &lt;   &gt;   ?   |   \
</pre><p>Cygwin can't fix this, but it has a method to workaround this
restriction.  All of the above characters, except for the backslash,
are converted to special UNICODE characters in the range 0xf000 to 0xf0ff
(the "Private use area") when creating or accessing files.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-unusual"></a>Filenames with unusual (foreign) characters</h3></div></div></div><p> Windows filesystems use the Unicode character set in the UTF-16
encoding to store filename information.  If you don't use the UTF-8
character set (see <a class="xref" href="#setup-locale" title="Internationalization">the section called &#8220;Internationalization&#8221;</a>) then there's a
chance that a filename is using one or more characters which have no
representation in the character set you're using.</p><p>For instance, there are no Chinese characters in the ISO-8859-1
character set.  So, converting a filename containing a Chinese character
to ISO-8859-1 leaves you with a wrongly converted filename, for instance,
containing a question mark '?' as replacement for the unconvertable
character.  When trying to access the file, Cygwin has to convert the
filename back to UTF-16.  However, this doesn't result in the original
filename because the question mark will not translate back to the original
Chinese character, but to a simple question mark instead.  This in turn
results in strange "File not found" messages.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>In the default "C" locale, Cygwin creates filenames using
the UTF-8 charset.  This will always result in some valid filename by
default, but again might impose problems when switching to a non-"C"
or non-"UTF-8" charset.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>To avoid this scenario altogether, always use UTF-8 as the
character set.</p></div><p>If you don't want or can't use UTF-8 as character set for whatever
reason, you will nevertheless be able to access the file.  How does that
work?  When Cygwin converts the filename from UTF-16 to your character
set, it recognizes characters which can't be converted.  If that occurs,
Cygwin replaces the non-convertible character with a special character
sequence.  The sequence starts with an ASCII SO character (hex code
0x0e, equivalent Control-N), followed by the UTF-8 representation of the
character.  The result is a filename containing some ugly looking
characters.  While it doesn't <span class="emphasis"><em>look</em></span> nice, it
<span class="emphasis"><em>is</em></span> nice, because Cygwin knows how to convert this
filename back to UTF-16.  The filename will be converted using your
usual character set.  However, when Cygwin recognizes an ASCII SO
character, it skips over the ASCII SO and handles the following bytes as
a UTF-8 character.  Thus, the filename is symmetrically converted back to
UTF-16 and you can access the file.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Please be aware that this method is not entirely foolproof.
In some character set combinations it might not work for certain native
characters.</p><p>Only by using the UTF-8 charset you can avoid this problem safely.
</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-casesensitive"></a>Case sensitive filenames</h3></div></div></div><p>In the Win32 subsystem filenames are only case-preserved, but not
case-sensitive.  You can't access two files in the same directory which
only differ by case, like <code class="filename">Abc</code> and
<code class="filename">aBc</code>.  While NTFS (and some remote filesystems)
support case-sensitivity, the NT kernel starting with Windows XP does
not support it by default.  Rather, you have to tweak a registry setting
and reboot.  For that reason, case-sensitivity can not be supported by Cygwin,
unless you change that registry value.</p><p>If you really want case-sensitivity in Cygwin, you can switch it
on by setting the registry value</p><pre class="screen">
HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\kernel\obcaseinsensitive
</pre><p>to 0 and reboot the machine.  For least surprise, Cygwin expects
this registry value also on Windows NT4 and Windows 2000, which usually
both don't know this registry key.  If you want case-sensitivity on these
systems, create that registry value and set it to 0.  On these systems
(and <span class="bold"><strong>only</strong></span> on these systems) you don't have to reboot to bring it
into effect, rather stopping all Cygwin processes and then restarting them
is sufficient.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
When installing Microsoft's Services For Unix (SFU), you're asked if
you want to use case-sensitive filenames.  If you answer "yes" at this point,
the installer will change the aforementioned registry value to 0, too.  So, if
you have SFU installed, there's some chance that the registry value is already
set to case sensitivity.
</p></div><p>After you set this registry value to 0, Cygwin will be case-sensitive
by default on NTFS and NFS filesystems.  Be aware that using two filenames
which only differ by case might result in some weird interoperability
issues with native Win32 applications.  You're using case-sensitivity 
at your own risk.  You have been warned!</p><p>Even if you use case-sensitivity, it might be feasible to switch to
case-insensitivity for certain paths for better interoperability with
native Win32 applications (even if it's just Windows Explorer).  You can do
this on a per-mount point base, by using the "posix=0" mount option in
<code class="filename">/etc/fstab</code>, or your <code class="filename">/etc/fstab.d/$USER</code>
file.</p><p><code class="filename">/cygdrive</code> paths are case-insensitive by default.
The reason is that the native Windows %PATH% environment variable is not
always using the correct case for all paths in it.  As a result, if you use
case-sensitivity on the <code class="filename">/cygdrive</code> prefix, your shell
might claim that it can't find Windows commands like <span class="command"><strong>attrib</strong></span>
or <span class="command"><strong>net</strong></span>.  To ease the pain, the <code class="filename">/cygdrive</code>
path is case-insensitive by default and you have to use the "posix=1" setting
explicitly in <code class="filename">/etc/fstab</code> or
<code class="filename">/etc/fstab.d/$USER</code> to switch it to case-sensitivity,
or you have to make sure that the native Win32 %PATH% environment variable
is using the correct case for all paths throughout.</p><p>Note that mount points as well as device names and virtual
paths like /proc are always case-sensitive!  The only exception are
the subdirectories and filenames under /proc/registry, /proc/registry32
and /proc/registry64.  Registry access is always case-insensitive.
Read on for more information.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-posixdevices"></a>POSIX devices</h3></div></div></div><p>There is no need to create a POSIX <code class="filename">/dev</code> 
directory as Cygwin automatically simulates it internally. 
These devices cannot be seen with the command <span class="command"><strong>ls /dev/</strong></span>
although commands such as <span class="command"><strong>ls /dev/tty</strong></span> work fine.
If you want to be able to see all well-known devices in
<code class="filename">/dev/</code>, you can use Igor Pechtchanski's
<a class="ulink" href="http://cygwin.com/ml/cygwin/2004-03/txt00028.txt" target="_top">create_devices.sh</a>
script.  This script does not add the raw disk devices, though.  Again,
it's not necessary to see an existing device in /dev to access it.  The script
is just for the fun of it.
</p><p>
Cygwin supports the following character devices commonly found on POSIX systems:
</p><pre class="screen">
/dev/null
/dev/zero
/dev/full

/dev/console	Pseudo device name for the standard console window created
		by Windows.  Same as the one used for cmd.exe.  Every one
		of them has this name.  It's not quite comparable with the
		console device on UNIX machines.

/dev/tty	The current tty of a session running in a pseudo tty.
/dev/ptmx	Pseudo tty master device.
/dev/ttym

/dev/tty0	Pseudo ttys are numbered from /dev/tty0 upwards as they are
/dev/tty1	requested.
...

/dev/ttyS0	Serial communication devices.  ttyS0 == Win32 COM1,
/dev/ttyS1	ttyS1 == COM2, etc.
...

/dev/pipe
/dev/fifo

/dev/mem	The physical memory of the machine.  Note that access to the
/dev/port	physical memory has been restricted with Windows Server 2003.
/dev/kmem	Since this OS, you can't access physical memory from user space.

/dev/kmsg	Kernel message pipe, for usage with sys logger services.

/dev/random	Random number generator.
/dev/urandom

/dev/dsp	Default sound device of the system.
</pre><p>
Cygwin also has several Windows-specific devices:
</p><pre class="screen">
/dev/com1	The serial ports, starting with COM1 which is the same as ttyS0.
/dev/com2	Please use /dev/ttySx instead.
...

/dev/conin	Same as Windows CONIN$.
/dev/conout	Same as Windows CONOUT$.
/dev/clipboard	The Windows clipboard, text only
/dev/windows	The Windows message queue.
</pre><p>
Block devices are accessible by Cygwin processes using fixed POSIX device
names.  These POSIX device names are generated using a direct conversion
from the POSIX namespace to the internal NT namespace.
E.g. the first harddisk is the NT internal device \device\harddisk0\partition0
or the first partition on the third harddisk is \device\harddisk2\partition1.
The first floppy in the system is \device\floppy0, the first CD-ROM is
\device\cdrom0 and the first tape drive is \device\tape0.</p><p>The mapping from physical device to the name of the device in the
internal NT namespace can be found in various places.  For hard disks and
CD/DVD drives, the Windows "Disk Management" utility (part of the
"Computer Management" console) shows that the mapping of "Disk 0" is
\device\harddisk0.  "CD-ROM 2" is \device\cdrom2.  Another place to find
this mapping is the "Device Management" console.  Disks have a
"Location" number, tapes have a "Tape Symbolic Name", etc.
Unfortunately, the places where this information is found is not very
well-defined.</p><p>
For external disks (USB-drives, CF-cards in a cardreader, etc) you can use
Cygwin to show the mapping.  <code class="filename">/proc/partitions</code>
contains a list of raw drives known to Cygwin.  The <span class="command"><strong>df</strong></span>
command shows a list of drives and their respective sizes.  If you match
the information between <code class="filename">/proc/partitions</code> and the
<span class="command"><strong>df</strong></span> output, you should be able to figure out which
external drive corresponds to which raw disk device name.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Apart from tape devices which are not block devices and are
by default accessed directly, accessing mass storage devices raw
is something you should only do if you know what you're doing and know how to
handle the information.  <span class="bold"><strong>Writing</strong></span> to a raw
mass storage device you should only do if you
<span class="bold"><strong>really</strong></span> know what you're doing and are aware
of the fact that any mistake can destroy important information, for the
device, and for you.  So, please, handle this ability with care.
<span class="bold"><strong>You have been warned.</strong></span></p></div><p>
Last but not least, the mapping from POSIX /dev namespace to internal
NT namespace is as follows:
</p><pre class="screen">
POSIX device name     Internal NT device name

/dev/st0	      \device\tape0, rewind
/dev/nst0	      \device\tape0, no-rewind
/dev/st1	      \device\tape1
/dev/nst1	      \device\tape1
...
/dev/st15
/dev/nst15

/dev/fd0	      \device\floppy0
/dev/fd1	      \device\floppy1
...
/dev/fd15

/dev/sr0	      \device\cdrom0
/dev/sr1	      \device\cdrom1
...
/dev/sr15

/dev/scd0	      \device\cdrom0
/dev/scd1	      \device\cdrom1
...
/dev/scd15

/dev/sda	      \device\harddisk0\partition0	(whole disk)
/dev/sda1	      \device\harddisk0\partition1	(first partition)
...
/dev/sda15	      \device\harddisk0\partition15	(fifteenth partition)

/dev/sdb	      \device\harddisk1\partition0
/dev/sdb1	      \device\harddisk1\partition1

[up to]

/dev/sddx	      \device\harddisk127\partition0
/dev/sddx1	      \device\harddisk127\partition1
...
/dev/sddx15	      \device\harddisk127\partition15
</pre><p>
if you don't like these device names, feel free to create symbolic
links as they are created on Linux systems for convenience:
</p><pre class="screen">
ln -s /dev/sr0 /dev/cdrom
ln -s /dev/nst0 /dev/tape
...
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-exe"></a>The .exe extension</h3></div></div></div><p>Win32 executable filenames end with <code class="filename">.exe</code>
but the <code class="filename">.exe</code> need not be included in the command,
so that traditional UNIX names can be used.  However, for programs that
end in <code class="filename">.bat</code> and <code class="filename">.com</code>, you
cannot omit the extension.  </p><p>As a side effect, the <span class="command"><strong> ls filename</strong></span> gives
information about <code class="filename">filename.exe</code> if
<code class="filename">filename.exe</code> exists and <code class="filename">filename</code>
does not.  In the same situation the function call
<code class="function">stat("filename",..)</code> gives information about
<code class="filename">filename.exe</code>.  The two files can be distinguished
by examining their inodes, as demonstrated below.
</p><pre class="screen">
<code class="prompt">bash$</code> <strong class="userinput"><code>ls * </code></strong>
a      a.exe     b.exe
<code class="prompt">bash$</code> <strong class="userinput"><code>ls -i a a.exe</code></strong>
445885548 a       435996602 a.exe
<code class="prompt">bash$</code> <strong class="userinput"><code>ls -i b b.exe</code></strong>
432961010 b       432961010 b.exe
</pre><p>
If a shell script <code class="filename">myprog</code> and a program
<code class="filename">myprog.exe</code> coexist in a directory, the shell
script has precedence and is selected for execution of
<span class="command"><strong>myprog</strong></span>.  Note that this was quite the reverse up to
Cygwin 1.5.19.  It has been changed for consistency with the rest of Cygwin.
</p><p>The <span class="command"><strong>gcc</strong></span> compiler produces an executable named
<code class="filename">filename.exe</code> when asked to produce
<code class="filename">filename</code>. This allows many makefiles written
for UNIX systems to work well under Cygwin.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-proc"></a>The /proc filesystem</h3></div></div></div><p>
Cygwin, like Linux and other similar operating systems, supports the
<code class="filename">/proc</code> virtual filesystem. The files in this
directory are representations of various aspects of your system,
for example the command <strong class="userinput"><code>cat /proc/cpuinfo</code></strong> 
displays information such as what model and speed processor you have.
</p><p>
One unique aspect of the Cygwin <code class="filename">/proc</code> filesystem
is <code class="filename">/proc/registry</code>, see next section.
</p><p>
The Cygwin <code class="filename">/proc</code> is not as complete as the
one in Linux, but it provides significant capabilities. The
<code class="systemitem">procps</code> package contains several utilities
that use it.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-proc-registry"></a>The /proc/registry filesystem</h3></div></div></div><p>
The <code class="filename">/proc/registry</code> filesystem provides read-only
access to the Windows registry.  It displays each <code class="literal">KEY</code>
as a directory and each <code class="literal">VALUE</code> as a file.  As anytime
you deal with the Windows registry, use caution since changes may result
in an unstable or broken system.  There are additionally subdirectories called
<code class="filename">/proc/registry32</code> and <code class="filename">/proc/registry64</code>.
They are identical to <code class="filename">/proc/registry</code> on 32 bit
host OSes.  On 64 bit host OSes, <code class="filename">/proc/registry32</code>
opens the 32 bit processes view on the registry, while
<code class="filename">/proc/registry64</code> opens the 64 bit processes view.
</p><p>
Reserved characters ('/', '\', ':', and '%') or reserved names
(<code class="filename">.</code> and <code class="filename">..</code>) are converted by
percent-encoding:
</p><pre class="screen">
<code class="prompt">bash$</code> <strong class="userinput"><code>regtool list -v '\HKEY_LOCAL_MACHINE\SYSTEM\MountedDevices'</code></strong>
...
\DosDevices\C: (REG_BINARY) = cf a8 97 e8 00 08 fe f7
...
<code class="prompt">bash$</code> <strong class="userinput"><code>cd /proc/registry/HKEY_LOCAL_MACHINE/SYSTEM</code></strong>
<code class="prompt">bash$</code> <strong class="userinput"><code>ls -l MountedDevices</code></strong>
...
-r--r----- 1 Admin SYSTEM  12 Dec 10 11:20 %5CDosDevices%5CC%3A
...
<code class="prompt">bash$</code> <strong class="userinput"><code>od -t x1 MountedDevices/%5CDosDevices%5CC%3A</code></strong>
0000000 cf a8 97 e8 00 08 fe f7 01 00 00 00
</pre><p>
The unnamed (default) value of a key can be accessed using the filename
<code class="filename">@</code>.
</p><p>
If a registry key contains a subkey and a value with the same name
<code class="filename">foo</code>, Cygwin displays the subkey as
<code class="filename">foo</code> and the value as <code class="filename">foo%val</code>.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pathnames-at"></a>The @pathnames</h3></div></div></div><p>To circumvent the limitations on shell line length in the native
Windows command shells, Cygwin programs expand their arguments
starting with "@" in a special way.  If a file
<code class="filename">pathname</code> exists, the argument
<code class="filename">@pathname</code> expands recursively to the content of
<code class="filename">pathname</code>. Double quotes can be used inside the
file to delimit strings containing blank space. 
Embedded double quotes must be repeated.
In the following example compare the behaviors of the bash built-in
<span class="command"><strong>echo</strong></span> and of the program <span class="command"><strong>/bin/echo</strong></span>.</p><div class="example"><a name="pathnames-at-ex"></a><p class="title"><b>Example 3.2.  Using @pathname</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">bash$</code> <strong class="userinput"><code>echo  'This   is   "a     long"  line' &gt; mylist</code></strong>
<code class="prompt">bash$</code> <strong class="userinput"><code>echo @mylist</code></strong>
@mylist
<code class="prompt">bash$</code> <strong class="userinput"><code>cmd</code></strong>
<code class="prompt">c:\&gt;</code> <strong class="userinput"><code>c:\cygwin\bin\echo @mylist</code></strong>
This is a     long line
</pre></div></div><br class="example-break"></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-cygwinenv"></a>The <code class="envar">CYGWIN</code> environment
variable</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cygwinenv-implemented-options"></a>Implemented options</h3></div></div></div><p>The <code class="envar">CYGWIN</code> environment variable is used to configure
many global settings for the Cygwin runtime system. It contains the options
listed below, separated by blank characters. Many options can be turned off
by prefixing with <code class="literal">no</code>.</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="envar">(no)dosfilewarning</code> - If set, Cygwin will warn the
first time a user uses an "MS-DOS" style path name rather than a POSIX-style
path name.  Defaults to set.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)envcache</code> - If set, environment variable
conversions (between Win32 and POSIX) are cached.  Note that this may
cause problems if the mount table changes, as the cache is not invalidated
and may contain values that depend on the previous mount table
contents. Defaults to set.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)export</code> - If set, the final values of these
settings are re-exported to the environment as <code class="envar">CYGWIN</code> again.
Defaults to off.</p></li><li style="list-style-type: disc"><p>
<code class="envar">error_start:Win32filepath</code> - if set, runs 
<code class="filename">Win32filepath</code> when cygwin encounters a fatal error,
which is useful for debugging.  <code class="filename">Win32filepath</code> is
usually set to the path to <span class="command"><strong>gdb</strong></span> or
<span class="command"><strong>dumper</strong></span>, for example
<code class="filename">C:\cygwin\bin\gdb.exe</code>. 
There is no default set.
</p></li><li style="list-style-type: disc"><p><code class="envar">forkchunk:32768</code> - causes <code class="function">fork()</code>
to copy memory some number of bytes at a time, in the above example 
32768 bytes (32Kb) at a time. The default is to copy as many bytes as 
possible, which is preferable in most cases but may slow some older systems
down.
</p></li><li style="list-style-type: disc"><p><code class="envar">proc_retry:n</code> - causes <code class="function">fork()</code> and
<code class="function">exec*()</code> to retry n times when a child process fails
due to certain windows-specific errors.  These errors usually occur when
processes are being started while a user is logging off.
</p></li><li style="list-style-type: disc"><p><code class="envar">(no)glob[:ignorecase]</code> - if set, command line arguments
containing UNIX-style file wildcard characters (brackets, question mark,
asterisk, escaped with \) are expanded into lists of files that match 
those wildcards.
This is applicable only to programs running from a DOS command line prompt.
Default is set.</p><p>This option also accepts an optional <code class="literal">[no]ignorecase</code> modifer.
If supplied, wildcard matching is case insensitive.  The default is <code class="literal">noignorecase</code></p></li><li style="list-style-type: disc"><p><code class="envar">(no)reset_com</code> - if set, serial ports are reset
to 9600-8-N-1 with no flow control when used. This is done at open
time and when handles are inherited.  Defaults to set.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)strip_title</code> - if set, strips the directory
part off the window title, if any.  Default is not set.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)title</code> - if set, the title bar
reflects the name of the program currently running.  Default is not
set.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)tty</code> - if set, Cygwin enables extra support
(i.e., termios) for UNIX-like ttys in the Windows console. 
It is not compatible with some Windows programs.
Defaults to not set, in which case the tty is opened in text mode.
Note that this has been changed such that ^D works as
expected instead of ^Z, and is settable via <span class="command"><strong>stty</strong></span>.
This option must be specified before starting a Cygwin shell 
and it cannot be changed in the shell.  It should not be set when using
other terminals (i.e., rxvt or xterm). 
</p></li><li style="list-style-type: disc"><p><code class="envar">(no)upcaseenv</code> - if set, Cygwin converts all
environment variables to all-uppercase, when a Cygwin process is started
from a non-Cygwin native Windows process.  This was the default behavior in
releases prior to Cygwin 1.7.  If not set, Cygwin does not change the case
of environment variables, except for a restricted set to maintain minimal
backward compatibility and for correct handling of certain essential
variables.  The current list of always uppercased variables is:</p><pre class="screen">
  ALLUSERSPROFILE
  COMMONPROGRAMFILES
  COMPUTERNAME
  COMSPEC
  HOME
  HOMEDRIVE
  HOMEPATH
  NUMBER_OF_PROCESSORS
  OS
  PATH
  PATHEXT
  PROCESSOR_ARCHITECTURE
  PROCESSOR_IDENTIFIER
  PROCESSOR_LEVEL
  PROCESSOR_REVISION
  PROGRAMFILES
  SYSTEMDRIVE
  SYSTEMROOT
  TEMP
  TERM
  TMP
  TMPDIR
  WINDIR
</pre><p>Defaults to not set.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)winsymlinks</code> - if set, Cygwin creates
symlinks as Windows shortcuts with a special header and the R/O attribute
set. If not set, Cygwin creates symlinks as plain files with a magic number,
a path and the system attribute set. Defaults to not set since plain
file symlinks are faster to write and faster to read.  The new style of
plain file symlinks is incompatible with older Cygwin releases because
the new symlinks use UTF-16 to encode the target filename, while the
old symlinks used the current ANSI or OEM charset.</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cygwinenv-removed-options"></a>Obsolete options</h3></div></div></div><p>
Certain CYGWIN options available in past releases have been removed in
Cygwin 1.7 for one reason or another.  These obsolete options are listed
below.</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="envar">(no)binmode</code> - This option has been removed because
all file opens default to binary mode, unless the open mode has been specified
explicitly in the open(2) call.
</p></li><li style="list-style-type: disc"><p><code class="envar">check_case</code> - This option has been removed in favor of
real case sensitivity and the per-mount option "posix=[0|1]".  For more
information, read the documentation in <a class="xref" href="#mount-table" title="The Cygwin Mount Table">the section called &#8220;The Cygwin Mount Table&#8221;</a> and
<a class="xref" href="#pathnames-casesensitive" title="Case sensitive filenames">the section called &#8220;Case sensitive filenames&#8221;</a>.</p></li><li style="list-style-type: disc"><p><code class="envar">codepage:[ansi|oem]</code> - This option controled
which character set is used for file and console operations.  Since Cygwin
is now doing all character conversion by itself, depending on the
application call to the <code class="function">setlocale()</code> function, and in
turn by the setting of the environment variables <code class="envar">$LANG</code>,
<code class="envar">$LC_ALL</code>, or <code class="envar">$LC_CTYPE</code>, this setting
became superfluous.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)ntea</code> -  This option has been removed since it
only fakes security which is considered dangerous and useless.  It also
created an uncontrollably large file on FAT and was entirely useless
on FAT32.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)ntsec</code> - This option has been removed in favor of
the per-mount option "acl"/"noacl".  For more information, read the
documentation in <a class="xref" href="#mount-table" title="The Cygwin Mount Table">the section called &#8220;The Cygwin Mount Table&#8221;</a>.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)server</code> - Originally this option had to be
enabled on the client side to use features only available when running
<span class="command"><strong>cygserver</strong></span>.  This option has been removed because Cygwin now
always tries to contact cygserver if a function is called which requires
cygserver being available.  For more information, read the documentation
in <a class="xref" href="#using-cygserver" title="Cygserver">the section called &#8220;Cygserver&#8221;</a>.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)smbntsec</code> - This option has been removed in favor of
the per-mount option "acl"/"noacl".  For more information, read the
documentation in <a class="xref" href="#mount-table" title="The Cygwin Mount Table">the section called &#8220;The Cygwin Mount Table&#8221;</a>.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)transparent_exe</code> - This option has been removed
because the behaviour it switched on is now the standard behaviour in
Cygwin.</p></li><li style="list-style-type: disc"><p><code class="envar">(no)traverse</code> - This option has been removed because
traverse checking is not quite correctly implemented by Microsoft and
it's behaviour has been getting worse with each new OS version.  This
complicates its usage so the option has been removed for now.</p></li></ul></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-cygserver"></a>Cygserver</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="what-is-cygserver"></a>What is Cygserver?</h3></div></div></div><p>
  Cygserver is a program which is designed to run as a background service.
  It provides Cygwin applications with services which require security
  arbitration or which need to persist while no other cygwin application
  is running.
</p><p>
  The implemented services so far are:
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Control slave tty/pty handle dispersal from tty owner to other
    processes without compromising the owner processes' security.</p></li><li style="list-style-type: disc"><p>XSI IPC Message Queues.</p></li><li style="list-style-type: disc"><p>XSI IPC Semaphores.</p></li><li style="list-style-type: disc"><p>XSI IPC Shared Memory.</p></li><li style="list-style-type: disc"><p>Allows non-privileged users to store obfuscated
  passwords in the registry to be used by <span class="command"><strong>setuid</strong></span> and
  <span class="command"><strong>seteuid</strong></span> calls to create user tokens with network
  credentials.  This service is used by <span class="command"><strong><a class="link" href="#passwd" title="passwd">passwd</a> -R</strong></span>.  Using the stored
  passwords in <span class="command"><strong>set(e)uid</strong></span> does not require running
  Cygserver.  For details, see <a class="xref" href="#ntsec-setuid-overview" title="Switching the user context">the section called &#8220;Switching the user context&#8221;</a>.
  </p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cygserver-command-line"></a>Cygserver command line options</h3></div></div></div><p>
  Options to Cygserver take the normal UNIX-style `-X' or `--longoption' form.
  Nearly all options have a counterpart in the configuration file (see below)
  so setting them on the command line isn't really necessary.  Command line
  options override settings from the Cygserver configuration file.
</p><p>
  The one-character options are prepended by a single dash, the long variants
  are prepended with two dashes.  Arguments to options are marked in angle
  brackets below.  These are not part of the actual syntax but are used only to
  denote the arguments.  Note that all arguments are required.  Cygserver
  has no options with optional arguments.
</p><p>
  The recognized options are:
</p><div class="itemizedlist"><ul type="disc" compact><li><pre class="screen">-f, --config-file &lt;file&gt;</pre><p>  
    Use &lt;file&gt; as configuration file instead of the default configuration
    line.  The default configuration file is /etc/cygserver.conf. 
    The --help and --version options will print the default configuration
    pathname.
  </p><p>
    This option has no counterpart in the configuration file, for obvious
   reasons.
  </p></li><li><pre class="screen">-c, --cleanup-threads &lt;num&gt;</pre><p>  
    Number of threads started to perform cleanup tasks.  Default is 2.
    Configuration file option:  kern.srv.cleanup_threads
  </p></li><li><pre class="screen">-r, --request-threads &lt;num&gt;</pre><p>  
    Number of threads started to serve application requests.  Default is 10.
    The -c and -r options can be used to play with Cygserver's performance
    under heavy load conditions or on slow machines.
    Configuration file option:  kern.srv.request_threads
  </p></li><li><pre class="screen">-d, --debug</pre><p>  
    Log debug messages to stderr.  These will clutter your stderr output with
    a lot of information, typically only useful to developers.
  </p></li><li><pre class="screen">-e, --stderr</pre><p>  
    Force logging to stderr.  This is the default if stderr is connected to
    a tty.  Otherwise, the default is logging to the system log.  By using
    the -e, -E, -y, -Y options (or the appropriate settings in the
    configuration file), you can explicitly set the logging output as you
    like, even to both, stderr and syslog.
    Configuration file option:  kern.log.stderr
  </p></li><li><pre class="screen">-E, --no-stderr</pre><p>  
    Don't log to stderr.  Configuration file option:  kern.log.stderr
  </p></li><li><pre class="screen">-y, --syslog</pre><p>  
    Force logging to the system log.  This is the default, if stderr is not
    connected to a tty, e. g. redirected to a file.
    Configuration file option:  kern.log.syslog
  </p></li><li><pre class="screen">-Y, --no-syslog</pre><p>  
    Don't log to syslog.  Configuration file option:  kern.log.syslog
  </p></li><li><pre class="screen">-l, --log-level &lt;level&gt;</pre><p> 
    Set the verbosity level of the logging output.  Valid values are between
    1 and 7.  The default level is 6, which is relatively chatty.  If you set
    it to 1, you will get only messages which are printed under severe conditions,
    which will result in stopping Cygserver itself.
    Configuration file option:  kern.log.level
  </p></li><li><pre class="screen">-m, --no-sharedmem</pre><p>  
    Don't start XSI IPC Shared Memory support.  If you don't need XSI IPC
    Shared Memory support, you can switch it off here.
    Configuration file option:  kern.srv.sharedmem
  </p></li><li><pre class="screen">-q, --no-msgqueues</pre><p>  
    Don't start XSI IPC Message Queues. 
    Configuration file option:  kern.srv.msgqueues
  </p></li><li><pre class="screen">-s, --no-semaphores</pre><p>  
    Don't start XSI IPC Semaphores.
    Configuration file option:  kern.srv.semaphores
  </p></li><li><pre class="screen">-S, --shutdown</pre><p>  
    Shutdown a running daemon and exit.  Other methods are sending a SIGHUP
    to the Cygserver PID or, if running as service, calling `net stop
    cygserver' or `cygrunsrv -E cygserver'.
  </p></li><li><pre class="screen">-h, --help</pre><p>  
    Output usage information and exit.
  </p></li><li><pre class="screen">-v, --version</pre><p>  
    Output version information and exit.
  </p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="start-cygserver"></a>How to start Cygserver</h3></div></div></div><p>
  Before you run Cygserver for the first time, you should run the
  /usr/bin/cygserver-config script once.  It creates the default
  configuration file and, upon request, installs Cygserver as service.
  The script only performs a default install, with no further options
  given to Cygserver when running as service.  Due to the wide
  configurability by changing the configuration file, that's typically
  not necessary.
</p><p>
  You should always run Cygserver as a service under LocalSystem account. 
  This is the way it is installed for you by the /usr/bin/cygserver-config
  script.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cygserver-config"></a>The Cygserver configuration file</h3></div></div></div><p>
  Cygserver has many options, which allow you to customize the server
  to your needs.  Customization is accomplished by editing the configuration
  file, which is by default /etc/cygserver.conf.  This file is only read
  once, at startup of Cygserver.  There's no option to re-read the file at
  runtime by, say, sending a signal to Cygserver.
</p><p>
  The configuration file determines how Cygserver operates.  There are
  options which set the number of threads running in parallel, options
  for setting how and what to log and options to set various maximum
  values for the IPC services.
</p><p>
  The default configuration file delivered with Cygserver is installed
  to /etc/defaults/etc.  The /usr/bin/cygserver-config script copies it to
  /etc, giving you the option to overwrite an already existing file or to
  leave it alone.  Therefore, the /etc file is safe to be changed by you,
  since it will not be overwritten by a later update installation.
</p><p>
  The default configuration file contains many comments which describe
  everything needed to understand the settings.  A comment at the start of the
  file describes the syntax rules for the file.  The default options are shown
  in the file but are commented out.
</p><p>
  It is generally a good idea to uncomment only options which you intend to
  change from the default values.  Since reading the options file on Cygserver
  startup doesn't take much time, it's also considered good practice to keep
  all other comments in the file.  This keeps you from searching for clues
  in other sources.
</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-utils"></a>Cygwin Utilities</h2></div></div></div><p>Cygwin comes with a number of command-line utilities that are
used to manage the UNIX emulation portion of the Cygwin environment.
While many of these reflect their UNIX counterparts, each was written
specifically for Cygwin.  You may use the long or short option names 
interchangeably; for example, <code class="literal">--help</code> and 
<code class="literal">-h</code> function identically. All of the Cygwin 
command-line utilities support the <code class="literal">--help</code> and
<code class="literal">--version</code> options. 
</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cygcheck"></a>cygcheck</h3></div></div></div><pre class="screen">
Usage: cygcheck PROGRAM [ -v ] [ -h ]
       cygcheck -c [ PACKAGE ... ] [ -d ]
       cygcheck -s [ -r ] [ -v ] [ -h ]
       cygcheck -k
       cygcheck -f FILE [ FILE ... ]
       cygcheck -l [ PACKAGE ... ]
       cygcheck -p REGEXP
List system information, check installed packages, or query package database.

At least one command option or a PROGRAM is required, as shown above.

  PROGRAM              list library (DLL) dependencies of PROGRAM
  -c, --check-setup    show installed version of PACKAGE and verify integrity
                       (or for all installed packages if none specified)
  -d, --dump-only      just list packages, do not verify (with -c)
  -s, --sysinfo        produce diagnostic system information (implies -c -d)
  -r, --registry       also scan registry for Cygwin settings (with -s)
  -k, --keycheck       perform a keyboard check session (must be run from a
                       plain console only, not from a pty/rxvt/xterm)
  -f, --find-package   find the package to which FILE belongs
  -l, --list-package   list contents of PACKAGE (or all packages if none given)
  -p, --package-query  search for REGEXP in the entire cygwin.com package
                       repository (requires internet connectivity)
  -v, --verbose        produce more verbose output
  -h, --help           annotate output with explanatory comments when given
                       with another command, otherwise print this help
  -V, --version        print the version of cygcheck and exit

Note: -c, -f, and -l only report on packages that are currently installed. To
  search all official Cygwin packages use -p instead.  The -p REGEXP matches
  package names, descriptions, and names of files/paths within all packages.
</pre><p>
The <span class="command"><strong>cygcheck</strong></span> program is a diagnostic utility for
dealing with Cygwin programs. If you are familiar with
<span class="command"><strong>dpkg</strong></span> or <span class="command"><strong>rpm</strong></span>,
<span class="command"><strong>cygcheck</strong></span> is similar in many ways. (The major difference
is that <span class="command"><strong>setup.exe</strong></span> handles installing and uninstalling
packages; see <a class="xref" href="#internet-setup" title="Internet Setup">the section called &#8220;Internet Setup&#8221;</a> for more information.)
</p><p>
The <code class="literal">-c</code> option checks the version and status of 
installed Cygwin packages. If you specify one or more package names,
<span class="command"><strong>cygcheck</strong></span> will limit its output to those packages,
or with no arguments it lists all packages. A package will be marked
<code class="literal">Incomplete</code> if files originally installed are no longer
present. The best thing to do in that situation is reinstall the package
with <span class="command"><strong>setup.exe</strong></span>. To see which files are missing, use the
<code class="literal">-v</code> option. If you do not need to know the status
of each package and want <span class="command"><strong>cygcheck</strong></span> to run faster, add the
<code class="literal">-d</code> option and <span class="command"><strong>cygcheck</strong></span> will only
output the name and version for each package.
</p><p>
If you list one or more programs on the command line,
<span class="command"><strong>cygcheck</strong></span> will diagnose the runtime environment of that
program or programs, providing the names of DLL files on which the program
depends.  If you specify the <code class="literal">-s</code> option,
<span class="command"><strong>cygcheck</strong></span> will give general system information.  If you
list one or more programs on the command line and specify
<code class="literal">-s</code>, <span class="command"><strong>cygcheck</strong></span> will report on
both.</p><p>
The <code class="literal">-f</code> option helps you to track down which package a
file came from, and <code class="literal">-l</code> lists all files in a package.
For example, to find out about <code class="filename">/usr/bin/less</code> and its
package:
</p><div class="example"><a name="utils-cygcheck-ex"></a><p class="title"><b>Example 3.3. Example <span class="command">cygcheck</span> usage</b></p><div class="example-contents"><pre class="screen">
$ cygcheck -f /usr/bin/less
less-381-1

$ cygcheck -l less
/usr/bin/less.exe
/usr/bin/lessecho.exe
/usr/bin/lesskey.exe
/usr/man/man1/less.1
/usr/man/man1/lesskey.1
</pre></div></div><p><br class="example-break">
</p><p>The <code class="literal">-h</code> option prints additional helpful
messages in the report, at the beginning of each section.  It also
adds table column headings.  While this is useful information, it also
adds some to the size of the report, so if you want a compact report
or if you know what everything is already, just leave this out.</p><p>The <code class="literal">-v</code> option causes the output to be more
verbose.  What this means is that additional information will be
reported which is usually not interesting, such as the internal
version numbers of DLLs, additional information about recursive DLL
usage, and if a file in one directory in the PATH also occurs in other
directories on the PATH.  </p><p>The <code class="literal">-r</code> option causes
<span class="command"><strong>cygcheck</strong></span> to search your registry for information
that is relevent to Cygwin programs.  These registry entries are the
ones that have "Cygwin" in the name.  If you are paranoid about
privacy, you may remove information from this report, but please keep
in mind that doing so makes it harder to diagnose your problems.</p><p>In contrast to the other options that search the packages that are
installed on your local system, the <code class="literal">-p</code> option can be used
to search the entire official Cygwin package repository.  It takes as argument
a Perl-compatible regular expression which is used to match package names, 
package descriptions, and path/filenames of the contents of packages.  This
feature requires an active internet connection, since it must query the
<code class="literal">cygwin.com</code> web site.  In fact, it is equalivant to the
search that is available on the <a class="ulink" href="http://cygwin.com/packages/" target="_top">Cygwin
package listing</a> page.</p><p>For example, perhaps you are getting an error because you are missing a
certain DLL and you want to know which package includes that file:
</p><div class="example"><a name="utils-search-ex"></a><p class="title"><b>Example 3.4. Searching all packages for a file</b></p><div class="example-contents"><pre class="screen">
$ cygcheck -p 'cygintl-2\.dll'
Found 1 matches for 'cygintl-2\.dll'.

libintl2-0.12.1-3         GNU Internationalization runtime library

$ cygcheck -p 'libexpat.*\.a'
Found 2 matches for 'libexpat.*\.a'.

expat-1.95.7-1            XML parser library written in C
expat-1.95.8-1            XML parser library written in C

$ cygcheck -p '/ls\.exe'
Found 2 matches for '/ls\.exe'.

coreutils-5.2.1-5         GNU core utilities (includes fileutils, sh-utils and textutils)
coreutils-5.3.0-6         GNU core utilities (includes fileutils, sh-utils and textutils)
</pre></div></div><p><br class="example-break">
</p><p>Note that this option takes a regular expression, not a glob or wildcard.
This means that you need to use <code class="literal">.*</code> if you want something
similar to the wildcard <code class="literal">*</code> commonly used in filename globbing.
Similarly, to match the period character you should use <code class="literal">\.</code>
since the <code class="literal">.</code> character in a regexp is a metacharacter that
will match any character.  Also be aware that the characters such as 
<code class="literal">\</code> and <code class="literal">*</code> are shell metacharacters, so 
they must be either escaped or quoted, as in the example above.</p><p>The third example above illustrates that if you want to match a whole 
filename, you should include the <code class="literal">/</code> path seperator.  In the
given example this ensures that filenames that happen to end in
<code class="literal">ls.exe</code> such as <code class="literal">ncftpls.exe</code> are not shown.
Note that this use does not mean "look for packages with <code class="literal">ls</code>
in the root directory," since the <code class="literal">/</code> can match anywhere in the
path.  It's just there to anchor the match so that it matches a full
filename.</p><p>By default the matching is case-sensitive.  To get a case insensitive
match, begin your regexp with <code class="literal">(?i)</code> which is a PCRE-specific
feature.  For complete documentation on Perl-compatible regular expression
syntax and options, read the <span class="command"><strong>perlre</strong></span> manpage, or one of many
websites such as <code class="literal">perldoc.com</code> that document the Perl
language.</p><p>The <span class="command"><strong>cygcheck</strong></span> program should be used to send
information about your system for troubleshooting when requested.  
When asked to run this command save the output so that you can email it,
for example:</p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>cygcheck -s -v -r -h &gt; cygcheck_output.txt</code></strong>
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cygpath"></a>cygpath</h3></div></div></div><pre class="screen">
Usage: cygpath (-d|-m|-u|-w|-t TYPE) [-f FILE] [OPTION]... NAME...
       cygpath [-c HANDLE] 
       cygpath [-ADHOPSW] 
       cygpath [-F ID] 
Convert Unix and Windows format paths, or output system path information

Output type options:
  -d, --dos             print DOS (short) form of NAMEs (C:\PROGRA~1\)
  -m, --mixed           like --windows, but with regular slashes (C:/WINNT)
  -M, --mode            report on mode of file (currently binmode or textmode)
  -u, --unix            (default) print Unix form of NAMEs (/cygdrive/c/winnt)
  -w, --windows         print Windows form of NAMEs (C:\WINNT)
  -t, --type TYPE       print TYPE form: 'dos', 'mixed', 'unix', or 'windows'
Path conversion options:
  -a, --absolute        output absolute path
  -l, --long-name       print Windows long form of NAMEs (with -w, -m only)
  -p, --path            NAME is a PATH list (i.e., '/bin:/usr/bin')
  -s, --short-name      print DOS (short) form of NAMEs (with -w, -m only)
  -C, --codepage CP     print DOS, Windows, or mixed pathname in Windows
                        codepage CP.  CP can be a numeric codepage identifier,
                        or one of the reserved words ANSI, OEM, or UTF8.
                        If this option is missing, cygpath defaults to the
                        character set defined by the current locale.
System information:
  -A, --allusers        use `All Users' instead of current user for -D, -P
  -D, --desktop         output `Desktop' directory and exit
  -H, --homeroot        output `Profiles' directory (home root) and exit
  -O, --mydocs          output `My Documents' directory and exit
  -P, --smprograms      output Start Menu `Programs' directory and exit
  -S, --sysdir          output system directory and exit
  -W, --windir          output `Windows' directory and exit
  -F, --folder ID       output special folder with numeric ID and exit
Other options:
  -f, --file FILE       read FILE for input; use - to read from STDIN
  -o, --option          read options from FILE as well (for use with --file)
  -c, --close HANDLE    close HANDLE (for use in captured process)
  -i, --ignore          ignore missing argument
  -h, --help            output usage information and exit
  -v, --version         output version information and exit
</pre><p>The <span class="command"><strong>cygpath</strong></span> program is a utility that
converts Windows native filenames to Cygwin POSIX-style pathnames and
vice versa.  It can be used when a Cygwin program needs to pass a file 
name to a native Windows program, or expects to get a file name from a
native Windows program.  Alternatively, <span class="command"><strong>cygpath</strong></span> can 
output information about the location of important system directories 
in either format.  
</p><p>The <code class="literal">-u</code> and <code class="literal">-w</code> options
indicate whether you want a conversion to UNIX (POSIX) format 
(<code class="literal">-u</code>) or to Windows format (<code class="literal">-w</code>).  
Use the <code class="literal">-d</code> to get DOS-style (8.3) file and path names.
The <code class="literal">-m</code> option will output Windows-style format
but with forward slashes instead of backslashes.  This option is 
especially useful in shell scripts, which use backslashes as an escape 
character.</p><p> In combination with the <code class="literal">-w</code> option, you can use
the <code class="literal">-l</code> and <code class="literal">-s</code> options to use normal
(long) or DOS-style (short) form. The <code class="literal">-d</code> option is 
identical to <code class="literal">-w</code> and <code class="literal">-s</code> together.
</p><p>The <code class="literal">-C</code> option allows to specify a Windows codepage
to print DOS and Windows paths created with one of the <code class="literal">-d</code>,
<code class="literal">-m</code>, or <code class="literal">-w</code> options.  The default is to
use the character set of the current locale defined by one of the
internationalization environment variables <code class="envar">LC_ALL</code>,
<code class="envar">LC_CTYPE</code>, or <code class="envar">LANG</code>, see
<a class="xref" href="#setup-locale" title="Internationalization">the section called &#8220;Internationalization&#8221;</a>.  This is sometimes not sufficent for
interaction with native Windows tools, which might expect native, non-ASCII
characters in a specific Windows codepage.  Console tools, for instance, might
expect pathnames in the current OEM codepage, while graphical tools like
Windows Explorer might expect pathnames in the current ANSI codepage.</p><p>The <code class="literal">-C</code> option takes a single parameter:</p><div class="itemizedlist"><ul type="disc" compact><li><p><code class="literal">ANSI</code>, to specify the current ANSI codepage</p></li><li><p><code class="literal">OEM</code>, to specify the current OEM (console) codepage</p></li><li><p><code class="literal">UTF8</code>, to specify UTF-8.</p></li><li><p>A numerical, decimal codepage number, for instance 936 for GBK,
28593 for ISO-8859-3, etc.  A full list of supported codepages is listed on the
Microsoft MSDN page
<a class="ulink" href="http://msdn.microsoft.com/en-us/library/dd317756(VS.85).aspx" target="_top">Code Page Identifiers</a>.  A codepage of 0 is the same as if the
<code class="literal">-C</code> hasn't been specified at all.</p></li></ul></div><p>The <code class="literal">-p</code> option means that you want to convert
a path-style string rather than a single filename.  For example, the
PATH environment variable is semicolon-delimited in Windows, but
colon-delimited in UNIX.  By giving <code class="literal">-p</code> you are
instructing <span class="command"><strong>cygpath</strong></span> to convert between these
formats.</p><p>The <code class="literal">-i</code> option supresses the print out of the
usage message if no filename argument was given.  It can be used in
make file rules converting variables that may be omitted
to a proper format.  Note that <span class="command"><strong>cygpath</strong></span> output may 
contain spaces (C:\Program Files) so should be enclosed in quotes.
</p><div class="example"><a name="utils-cygpath-ex"></a><p class="title"><b>Example 3.5. Example <span class="command">cygpath</span> usage</b></p><div class="example-contents"><pre class="screen">

#!/bin/sh
if [ "${1}" = "" ];
	then
		XPATH=".";
	else
		XPATH="$(cygpath -C ANSI -w "${1}")";
fi
explorer $XPATH &amp;

</pre></div></div><br class="example-break"><p>The capital options 
<code class="literal">-D</code>, <code class="literal">-H</code>, <code class="literal">-P</code>, 
<code class="literal">-S</code>, and <code class="literal">-W</code> output directories used 
by Windows that are not the same on all systems, for example 
<code class="literal">-S</code> might output C:\WINNT\system32 or C:\Windows\System32. 
The <code class="literal">-H</code> shows the Windows profiles directory that can 
be used as root of home.  The <code class="literal">-A</code> option forces use of 
the "All Users" directories instead of the current user for the 
<code class="literal">-D</code>, <code class="literal">-O</code> and <code class="literal">-P</code> 
options.
The <code class="literal">-F</code> outputs other special folders specified by
their internal numeric code (decimal or 0xhex). For valid codes and
symbolic names, see the CSIDL_* definitions in the include file
/usr/include/w32api/shlobj.h from package w32api. The current valid
range of codes for folders is 0 (Desktop) to 59 (CDBurn area).
By default the output is in UNIX (POSIX) format; 
use the <code class="literal">-w</code> or <code class="literal">-d</code> options to get
other formats.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dumper"></a>dumper</h3></div></div></div><pre class="screen">
Usage: dumper [OPTION] FILENAME WIN32PID
Dump core from WIN32PID to FILENAME.core

-d, --verbose  be verbose while dumping
-h, --help     output help information and exit
-q, --quiet    be quiet while dumping (default)
-v, --version  output version information and exit
</pre><p>The <span class="command"><strong>dumper</strong></span> utility can be used to create a
core dump of running Windows process. This core dump can be later loaded
to <span class="command"><strong>gdb</strong></span> and analyzed. One common way to use 
<span class="command"><strong>dumper</strong></span> is to plug it into cygwin's Just-In-Time 
debugging facility by adding

</p><pre class="screen">
error_start=x:\path\to\dumper.exe
</pre><p>

to the <span class="emphasis"><em>CYGWIN</em></span> environment variable. Please note that
<code class="literal">x:\path\to\dumper.exe</code> is Windows-style and not cygwin
path. If <code class="literal">error_start</code> is set this way, then dumper will
be started whenever some program encounters a fatal error.
</p><p>
<span class="command"><strong>dumper</strong></span> can be also be started from the command line to 
create a core dump of any running process. Unfortunately, because of a Windows 
API limitation, when a core dump is created and <span class="command"><strong>dumper</strong></span> 
exits, the target process is terminated too.
</p><p>
To save space in the core dump, <span class="command"><strong>dumper</strong></span> doesn't write those
portions of target process' memory space that are loaded from executable and
dll files and are unchangeable, such as program code and debug info. Instead,
<span class="command"><strong>dumper</strong></span> saves paths to files which contain that data. When a
core dump is loaded into gdb, it uses these paths to load appropriate files.
That means that if you create a core dump on one machine and try to debug it on
another, you'll need to place identical copies of the executable and dlls in 
the same directories as on the machine where the core dump was created.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="getfacl"></a>getfacl</h3></div></div></div><pre class="screen">
Usage: getfacl [-adn] FILE [FILE2...]
Display file and directory access control lists (ACLs).

  -a, --all      display the filename, the owner, the group, and
                 the ACL of the file
  -d, --dir      display the filename, the owner, the group, and
                 the default ACL of the directory, if it exists
  -h, --help     output usage information and exit
  -n, --noname   display user and group IDs instead of names
  -v, --version  output version information and exit

When multiple files are specified on the command line, a blank
line separates the ACLs for each file.
</pre><p>
For each argument that is a regular file, special file or
directory, <span class="command"><strong>getfacl</strong></span> displays the owner, the group, and the 
ACL.  For directories <span class="command"><strong>getfacl</strong></span> displays additionally the 
default ACL.  With no options specified, <span class="command"><strong>getfacl</strong></span> displays 
the filename, the owner, the group, and both the ACL and the default ACL, if 
it exists. For more information on Cygwin and Windows ACLs, see
<a class="xref" href="#ntsec" title="Using Windows security in Cygwin">the section called &#8220;Using Windows security in Cygwin&#8221;</a> in the Cygwin User's Guide.
The format for ACL output is as follows:
</p><pre class="screen">
     # file: filename
     # owner: name or uid
     # group: name or uid
     user::perm
     user:name or uid:perm
     group::perm
     group:name or gid:perm
     mask:perm
     other:perm
     default:user::perm
     default:user:name or uid:perm
     default:group::perm
     default:group:name or gid:perm
     default:mask:perm
     default:other:perm
</pre><p>
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="kill"></a>kill</h3></div></div></div><pre class="screen">
Usage: kill [-f] [-signal] [-s signal] pid1 [pid2 ...]
       kill -l [signal]
Send signals to processes

 -f, --force     force, using win32 interface if necessary
 -l, --list      print a list of signal names
 -s, --signal    send signal (use kill --list for a list)
 -h, --help      output usage information and exit
 -v, --version   output version information and exit
</pre><p>The <span class="command"><strong>kill</strong></span> program allows you to send arbitrary
signals to other Cygwin programs.  The usual purpose is to end a
running program from some other window when ^C won't work, but you can
also send program-specified signals such as SIGUSR1 to trigger actions
within the program, like enabling debugging or re-opening log files.
Each program defines the signals they understand.</p><p>You may need to specify the full path to use <span class="command"><strong>kill</strong></span> 
from within some shells, including <span class="command"><strong>bash</strong></span>, the default Cygwin
shell. This is because <span class="command"><strong>bash</strong></span> defines a 
<span class="command"><strong>kill</strong></span> builtin function; see the <span class="command"><strong>bash</strong></span>
man page under <span class="emphasis"><em>BUILTIN COMMANDS</em></span> for more information.
To make sure you are using the Cygwin version, try

</p><pre class="screen">
$ /bin/kill --version
</pre><p>

which should give the Cygwin <span class="command"><strong>kill</strong></span> version number and
copyright information.
</p><p>Unless you specific the <code class="literal">-f</code> option, the "pid" values 
used by <span class="command"><strong>kill</strong></span> are the Cygwin pids, not the Windows pids.  
To get a list of running programs and their Cygwin pids, use the Cygwin
<span class="command"><strong>ps</strong></span> program. <span class="command"><strong>ps -W</strong></span> will display
<span class="emphasis"><em>all</em></span> windows pids.</p><p>The <span class="command"><strong>kill -l</strong></span> option prints the name of the
given signal, or a list of all signal names if no signal is given.</p><p>To send a specific signal, use the <code class="literal">-signN</code>
option, either with a signal number or a signal name (minus the "SIG"
part), as shown in these examples:</p><div class="example"><a name="utils-kill-ex"></a><p class="title"><b>Example 3.6. Using the kill command</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>kill 123</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>kill -1 123</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>kill -HUP 123</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>kill -f 123</code></strong>
</pre></div></div><br class="example-break"><p>Here is a list of available signals, their numbers, and some
commentary on them, from the file
<code class="literal">&lt;sys/signal.h&gt;</code>, which should be considered
the official source of this information.</p><pre class="screen">
SIGHUP       1    hangup
SIGINT       2    interrupt
SIGQUIT      3    quit
SIGILL       4    illegal instruction (not reset when caught)
SIGTRAP      5    trace trap (not reset when caught)
SIGABRT      6    used by abort
SIGEMT       7    EMT instruction
SIGFPE       8    floating point exception
SIGKILL      9    kill (cannot be caught or ignored)
SIGBUS      10    bus error
SIGSEGV     11    segmentation violation
SIGSYS      12    bad argument to system call
SIGPIPE     13    write on a pipe with no one to read it
SIGALRM     14    alarm clock
SIGTERM     15    software termination signal from kill
SIGURG      16    urgent condition on IO channel
SIGSTOP     17    sendable stop signal not from tty
SIGTSTP     18    stop signal from tty
SIGCONT     19    continue a stopped process
SIGCHLD     20    to parent on child stop or exit
SIGTTIN     21    to readers pgrp upon background tty read
SIGTTOU     22    like TTIN for output if (tp-&gt;t_local&amp;LTOSTOP)
SIGPOLL     23    System V name for SIGIO
SIGXCPU     24    exceeded CPU time limit
SIGXFSZ     25    exceeded file size limit
SIGVTALRM   26    virtual time alarm
SIGPROF     27    profiling time alarm
SIGWINCH    28    window changed
SIGLOST     29    resource lost (eg, record-lock lost)
SIGUSR1     30    user defined signal 1
SIGUSR2     31    user defined signal 2
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mkgroup"></a>mkgroup</h3></div></div></div><pre class="screen">
Usage: mkgroup [OPTION]...
Print /etc/group file to stdout

Options:
   -l,--local [machine[,offset]]
                           print local groups with gid offset offset
                           (from local machine if no machine specified)
   -L,--Local [machine[,offset]]
                           ditto, but generate groupname with machine prefix
   -d,--domain [domain[,offset]]
                           print domain groups with gid offset offset
                           (from current domain if no domain specified)
   -D,--Domain [domain[,offset]]
                           ditto, but generate groupname with machine prefix
   -c,--current            print current group
   -C,--Current            ditto, but generate groupname with machine or
                           domain prefix
   -S,--separator char     for -L, -D, -C use character char as domain\group
                           separator in groupname instead of the default '\'
   -o,--id-offset offset   change the default offset (10000) added to gids
                           in domain or foreign server accounts.
   -g,--group groupname    only return information for the specified group
                           one of -l, -L, -d, -D must be specified, too
   -b,--no-builtin         don't print BUILTIN groups
   -U,--unix grouplist     additionally print UNIX groups when using -l or -L
                           on a UNIX Samba server
                           grouplist is a comma-separated list of groupnames
                           or gid ranges (root,-25,50-100).
			   (enumerating large ranges can take a long time!)
   -s,--no-sids            (ignored)
   -u,--users              (ignored)
   -h,--help               print this message
   -v,--version            print version information and exit

Default is to print local groups on stand-alone machines, plus domain
groups on domain controllers and domain member machines.
</pre><p>The <span class="command"><strong>mkgroup</strong></span> program can be used to help
configure Cygwin by creating a <code class="filename">/etc/group</code>
file.  Its use is essential to include Windows security information.</p><p>The command is initially called by <span class="command"><strong>setup.exe</strong></span> to
create a default <code class="filename">/etc/group</code>.  This should be
sufficient in most circumstances.  However, especially when working
in a multi-domain environment, you can use <span class="command"><strong>mkgroup</strong></span>
manually to create a more complete <code class="filename">/etc/group</code> file for
all domains.  Especially when you have the same group name used on
multiple machines or in multiple domains, you can use the <code class="literal">-D</code>,
<code class="literal">-L</code> and <code class="literal">-C</code> options to create unique
domain\group style groupnames.</p><p>Note that this information is static.  If you change the group
information in your system, you'll need to regenerate the group file
for it to have the new information.</p><p>The <code class="literal">-d/-D</code> and <code class="literal">-l/-L</code> options
allow you to specify where the information comes from, the
local SAM of a machine or from the domain, or both.
With the <code class="literal">-d/-D</code> options the program contacts a Domain
Controller, which my be unreachable or have restricted access.
Comma-separated from the machine or domain, you can specify an offset
which is used as base added to the group's RID to compute the gid
(offset + RID = gid).  This allows you to create the same gids every time you
re-run <span class="command"><strong>mkgroup</strong></span>.
For very simple needs, an entry for the current user's group can be
created by using the option <code class="literal">-c</code> or <code class="literal">-C</code>.
If you want to use one of the <code class="literal">-D</code>, <code class="literal">-L</code>
or <code class="literal">-C</code> options, but you don't like the backslash as
domain/group separator, you can specify another separator using the
<code class="literal">-S</code> option, for instance:</p><div class="example"><a name="utils-mkgroup-ex"></a><p class="title"><b>Example 3.7. Setting up group entry for current user with different domain/group separator</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>mkgroup -C -S+ &gt; /etc/group</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>cat /etc/group</code></strong>
DOMAIN+my_group:S-1-5-21-2913048732-1697188782-3448811101-1144:11144:
</pre></div></div><br class="example-break"><p>The <code class="literal">-o</code> option allows for special cases
(such as multiple domains) where the GIDs might match otherwise.
The <code class="literal">-g</code> option only prints the information for one group.
The <code class="literal">-U</code> option allows you to enumerate the standard UNIX
groups on a Samba machine.  It's used together with
<code class="literal">-l samba-server</code> or <code class="literal">-L samba-server</code>.
The normal UNIX groups are usually not enumerated, but they can show
up as a group in <span class="command"><strong>ls -l</strong></span> output.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mkpasswd"></a>mkpasswd</h3></div></div></div><pre class="screen">
Usage: mkpasswd [OPTIONS]...
Print /etc/passwd file to stdout

Options:
   -l,--local [machine[,offset]]
                           print local user accounts with uid offset offset
                           (from local machine if no machine specified)
   -L,--Local [machine[,offset]]
                           ditto, but generate username with machine prefix
   -d,--domain [domain[,offset]]
                           print domain accounts with uid offset offset
                           (from current domain if no domain specified)
   -D,--Domain [domain[,offset]]
                           ditto, but generate username with domain prefix
   -c,--current            print current user
   -C,--Current            ditto, but generate username with machine or
                           domain prefix
   -S,--separator char     for -L, -D, -C use character char as domain\user
                           separator in username instead of the default '\'
   -o,--id-offset offset   change the default offset (10000) added to uids
                           in domain or foreign server accounts.
   -u,--username username  only return information for the specified user
                           one of -l, -L, -d, -D must be specified, too
   -p,--path-to-home path  use specified path instead of user account home dir
                           or /home prefix
   -m,--no-mount           don't use mount points for home dir
   -U,--unix userlist      additionally print UNIX users when using -l or -L\
                           on a UNIX Samba server
                           userlist is a comma-separated list of usernames
                           or uid ranges (root,-25,50-100).
                           (enumerating large ranges can take a long time!)
   -s,--no-sids            (ignored)
   -g,--local-groups       (ignored)
   -h,--help               displays this message
   -v,--version            version information and exit

Default is to print local accounts on stand-alone machines, domain accounts
on domain controllers and domain member machines.
</pre><p>The <span class="command"><strong>mkpasswd</strong></span> program can be used to help
configure Cygwin by creating a <code class="filename">/etc/passwd</code> from
your system information.
Its use is essential to include Windows security information.  However,
the actual passwords are determined by Windows, not by the content of
<code class="filename">/etc/passwd</code>.</p><p>The command is initially called by <span class="command"><strong>setup.exe</strong></span> to
create a default <code class="filename">/etc/passwd</code>.  This should be
sufficient in most circumstances.  However, especially when working
in a multi-domain environment, you can use <span class="command"><strong>mkpasswd</strong></span>
manually to create a more complete <code class="filename">/etc/passwd</code> file for
all domains.  Especially when you have the same user name used on
multiple machines or in multiple domains, you can use the <code class="literal">-D</code>,
<code class="literal">-L</code> and <code class="literal">-C</code> options to create unique
domain\user style usernames.</p><p>Note that this information is static.  If you change the user
information in your system, you'll need to regenerate the passwd file
for it to have the new information.</p><p>The <code class="literal">-d/-D</code> and <code class="literal">-l/-L</code> options
allow you to specify where the information comes from, the
local machine or the domain (default or given), or both.
With the  <code class="literal">-d/-D</code> options the program contacts the Domain
Controller, which may be unreachable or have restricted access.
Comma-separated from the machine or domain, you can specify an offset
which is used as base added to the user's RID to compute the uid
(offset + RID = uid).  This allows to create the same uids every time you
re-run <span class="command"><strong>mkpasswd</strong></span>.
An entry for the current user can be created by using the
option <code class="literal">-c</code> or  <code class="literal">-C</code>.
If you want to use one of the <code class="literal">-D</code>, <code class="literal">-L</code>
or <code class="literal">-C</code> options, but you don't like the backslash as
domain/group separator, you can specify another separator using the
<code class="literal">-S</code> option, similar to the <span class="command"><strong>mkgroup</strong></span>.
The <code class="literal">-o</code> option allows for special cases
(such as multiple domains) where the UIDs might match otherwise.
The <code class="literal">-m</code> option bypasses the current
mount table so that, for example, two users who have a Windows home 
directory of H: could mount them differently.  For more information on
SIDs, see <a class="xref" href="#ntsec" title="Using Windows security in Cygwin">the section called &#8220;Using Windows security in Cygwin&#8221;</a> in the Cygwin User's Guide.  The
<code class="literal">-p</code> option causes <span class="command"><strong>mkpasswd</strong></span> to
use the specified prefix instead of the account home dir or <code class="literal">/home/
</code>. For example, this command:

</p><div class="example"><a name="utils-althome-ex"></a><p class="title"><b>Example 3.8. Using an alternate home root</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>mkpasswd -l -p "$(cygpath -H)" &gt; /etc/passwd</code></strong>
</pre></div></div><p><br class="example-break">

would put local users' home directories in the Windows 'Profiles' directory. 
The <code class="literal">-u</code> option creates just an entry for
the specified user.
The <code class="literal">-U</code> option allows you to enumerate the standard UNIX
users on a Samba machine.  It's used together with
<code class="literal">-l samba-server</code> or <code class="literal">-L samba-server</code>.
The normal UNIX users are usually not enumerated, but they can show
up as file owners in <span class="command"><strong>ls -l</strong></span> output.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="mount"></a>mount</h3></div></div></div><pre class="screen">
Usage: mount [OPTION] [&lt;win32path&gt; &lt;posixpath&gt;]
Display information about mounted filesystems, or mount a filesystem

  -c, --change-cygdrive-prefix  change the cygdrive path prefix to &lt;posixpath&gt;
  -f, --force                   force mount, don't warn about missing mount
                                point directories
  -h, --help                    output usage information and exit
  -m, --mount-entries           write fstab entries to replicate mount points
                                and cygdrive prefixes
  -o, --options X[,X...]        specify mount options
  -p, --show-cygdrive-prefix    show user and/or system cygdrive path prefix
  -v, --version                 output version information and exit
</pre><p>The <span class="command"><strong>mount</strong></span> program is used to map your drives
and shares onto Cygwin's simulated POSIX directory tree, much like as is
done by mount commands on typical UNIX systems.  However, in contrast to
mount points given in <code class="filename">/etc/fstab</code>, mount points
created or changed with <span class="command"><strong>mount</strong></span> are not persistent.  They
disappear immediately after the last process of the current user exited.
Please see <a class="xref" href="#mount-table" title="The Cygwin Mount Table">the section called &#8220;The Cygwin Mount Table&#8221;</a> for more information on the
concepts behind the Cygwin POSIX file system and strategies for using
mounts. To remove mounts temporarily, use <span class="command"><strong>umount</strong></span></p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="utils-mount"></a>Using mount</h4></div></div></div><p>If you just type <span class="command"><strong>mount</strong></span> with no parameters, it
will display the current mount table for you.</p><div class="example"><a name="utils-mount-ex"></a><p class="title"><b>Example 3.9. Displaying the current set of mount points</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>mount</code></strong>
c:\cygwin\bin on /usr/bin type ntfs (binary)
c:\cygwin\lib on /usr/lib type ntfs (binary)
c:\cygwin on / type ntfs (binary)
c: on /c type ntfs (binary,user,noumount)
d: on /d type fat (binary,user,noumount)
</pre></div></div><br class="example-break"><p>In this example, c:\cygwin is the POSIX root and D drive is mapped to
<code class="filename">/d</code>.  Note that in this case, the root mount is a
system-wide mount point that is visible to all users running Cygwin
programs, whereas the <code class="filename">/d</code> mount is only visible
to the current user.</p><p>The <span class="command"><strong>mount</strong></span> utility is also the mechanism for
adding new mounts to the mount table.  The following example
demonstrates how to mount the directory
<code class="filename">//pollux/home/joe/data</code> to <code class="filename">/data</code>
for the duration of the current session.
</p><div class="example"><a name="utils-mount-add-ex"></a><p class="title"><b>Example 3.10. Adding mount points</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>ls /data</code></strong>
ls: /data: No such file or directory
<code class="prompt">$</code> <strong class="userinput"><code>mount //pollux/home/joe/data /data</code></strong>
mount: warning - /data does not exist!
<code class="prompt">$</code> <strong class="userinput"><code>mount</code></strong>
//pollux/home/joe/data on /data type smbfs (binary)
c:/cygwin/bin on /usr/bin type ntfs (binary)
c:/cygwin/lib on /usr/lib type ntfs (binary)
c:/cygwin on / type ntfs (binary)
c: on /c type ntfs (binary,user,noumount)
d: on /d type fat (binary,user,noumount)
</pre></div></div><br class="example-break"><p>A given POSIX path may only exist once in the mount table.  Attempts to
replace the mount will fail with a busy error.  The <code class="literal">-f</code>
(force) option causes the old mount to be silently replaced with the new one,
provided the old mount point was a user mount point.  It's not valid to
replace system-wide mount points.  Additionally, the <code class="literal">-f</code>
option will silence warnings about the non-existence of directories at the
Win32 path location.</p><p>
The <code class="literal">-o</code> option is the method via which various options about
the mount point may be recorded.  The following options are available (note that
most of the options are duplicates of other mount flags):</p><pre class="screen">
  acl        - Use the filesystem's access control lists (ACLs) to
               implement real POSIX permissions (default).
  binary     - Files default to binary mode (default).
  cygexec    - Treat all files below mount point as cygwin executables.
  exec       - Treat all files below mount point as executable.
  noacl      - Ignore ACLs and fake POSIX permissions.
  nosuid     - No suid files are allowed (currently unimplemented)
  notexec    - Treat all files below mount point as not executable.
  override   - Override immutable mount points.
  posix=0    - Switch off case sensitivity for paths under this mount point.
  posix=1    - Switch on case sensitivity for paths under this mount point
               (default).
  text       - Files default to CRLF text mode line endings.
</pre><p>For a more complete description of the mount options and the
<code class="filename">/etc/fstab</code> file, see
<a class="xref" href="#mount-table" title="The Cygwin Mount Table">the section called &#8220;The Cygwin Mount Table&#8221;</a>.</p><p>Note that all mount points added with <span class="command"><strong>mount</strong></span> are
user mount points.  System mount points can only be specified in
the <code class="filename">/etc/fstab</code> file.</p><p>
The <code class="literal">-m</code> option causes the <span class="command"><strong>mount</strong></span> utility
to output the current mount table in a series of fstab entries.
You can save this output as a backup when experimenting with the mount table.
Copy the output to <code class="filename">/etc/fstab</code> to restore the old state.
It also makes moving your settings to a different machine much easier.</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="utils-cygdrive"></a>Cygdrive mount points</h4></div></div></div><p>Whenever Cygwin cannot use any of the existing mounts to convert
from a particular Win32 path to a POSIX one, Cygwin will, instead,
convert to a POSIX path using a default mount point:
<code class="filename">/cygdrive</code>.  For example, if Cygwin accesses
<code class="filename">z:\foo</code> and the z drive is not currently in the
mount table, then <code class="filename">z:\</code> will be accessible as
<code class="filename">/cygdrive/z</code>.  The <span class="command"><strong>mount</strong></span> utility 
can be used to change this default automount prefix through the use of the
"--change-cygdrive-prefix" option.  In the following example, we will
set the automount prefix to <code class="filename">/mnt</code>:</p><div class="example"><a name="utils-cygdrive-ex"></a><p class="title"><b>Example 3.11. Changing the default prefix</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>mount --change-cygdrive-prefix /mnt</code></strong>
</pre></div></div><br class="example-break"><p>Note that the cygdrive prefix can be set both per-user and system-wide, 
and that as with all mounts, a user-specific mount takes precedence over the 
system-wide setting.  The <span class="command"><strong>mount</strong></span> utility creates system-wide 
mounts by default if you do not specify a type.
You can always see the user and system cygdrive prefixes with the 
<code class="literal">-p</code> option.  Using the <code class="literal">--options</code>
flag with <code class="literal">--change-cygdrive-prefix</code> makes all new 
automounted filesystems default to this set of options.  For instance
(using the short form of the command line flags)</p><div class="example"><a name="utils-cygdrive-ex2"></a><p class="title"><b>Example 3.12. Changing the default prefix with specific mount options</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>mount -c /mnt -o binary,noacl</code></strong>
</pre></div></div><br class="example-break"></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="utils-limitations"></a>Limitations</h4></div></div></div><p>Limitations: there is a hard-coded limit of 30 mount
points.  Also, although you can mount to pathnames that do not start
with "/", there is no way to make use of such mount points.</p><p>Normally the POSIX mount point in Cygwin is an existing empty
directory, as in standard UNIX. If this is the case, or if there is a
place-holder for the mount point (such as a file, a symbolic link
pointing anywhere, or a non-empty directory), you will get the expected
behavior. Files present in a mount point directory before the mount
become invisible to Cygwin programs.
</p><p>It is sometimes desirable to mount to a non-existent directory,
for example to avoid cluttering the root directory with names
such as
<code class="filename">a</code>, <code class="filename">b</code>, <code class="filename">c</code>
pointing to disks.
Although <span class="command"><strong>mount</strong></span> will give you a warning, most
everything will work properly when you refer to the mount point
explicitly.  Some strange effects can occur however.
For example if your current working directory is
<code class="filename">/dir</code>,
say, and <code class="filename">/dir/mtpt</code> is a mount point, then
<code class="filename">mtpt</code> will not show up in an <span class="command"><strong>ls</strong></span>
or
<span class="command"><strong>echo *</strong></span> command and <span class="command"><strong>find .</strong></span> will
not
find <code class="filename">mtpt</code>.
</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="passwd"></a>passwd</h3></div></div></div><pre class="screen">
Usage: passwd [OPTION] [USER]
Change USER's password or password attributes.

User operations:
  -l, --lock               lock USER's account.
  -u, --unlock             unlock USER's account.
  -c, --cannot-change      USER can't change password.
  -C, --can-change         USER can change password.
  -e, --never-expires      USER's password never expires.
  -E, --expires            USER's password expires according to system's
                           password aging rule.
  -p, --pwd-not-required   no password required for USER.
  -P, --pwd-required       password is required for USER.
  -R, --reg-store-pwd      enter password to store it in the registry for
                           later usage by services to be able to switch
                           to this user context with network credentials.

System operations:
  -i, --inactive NUM       set NUM of days before inactive accounts are disabled
                           (inactive accounts are those with expired passwords).
  -n, --minage DAYS        set system minimum password age to DAYS days.
  -x, --maxage DAYS        set system maximum password age to DAYS days.
  -L, --length LEN         set system minimum password length to LEN.

Other options:
  -d, --logonserver SERVER connect to SERVER (e.g. domain controller).
                           Default server is the local system, unless
                           changing the current user, in which case the
                           default is the content of $LOGONSERVER.
  -S, --status             display password status for USER (locked, expired,
                           etc.) plus global system password settings.
  -h, --help               output usage information and exit.
  -v, --version            output version information and exit.

If no option is given, change USER's password.  If no user name is given,
operate on current user.  System operations must not be mixed with user
operations.  Don't specify a USER when triggering a system operation. 

Don't specify a user or any other option together with the -R option.
Non-Admin users can only store their password if cygserver is running.
Note that storing even obfuscated passwords in the registry is not overly
secure.  Use this feature only if the machine is adequately locked down.
Don't use this feature if you don't need network access within a remote
session.  You can delete your stored password by using `passwd -R' and
specifying an empty password.
</pre><p> <span class="command"><strong>passwd</strong></span> changes passwords for user accounts.
A normal user may only change the password for their own account,
but administrators may change passwords on any account.
<span class="command"><strong>passwd</strong></span> also changes account information, such as
password expiry dates and intervals.</p><p>For password changes, the user is first prompted for their old
password, if one is present.  This password is then encrypted and
compared against the stored password.  The user has only one chance to
enter the correct password.  The administrators are permitted to
bypass this step so that forgotten passwords may be changed.</p><p>The user is then prompted for a replacement password.
<span class="command"><strong>passwd</strong></span> will prompt twice for this replacement and 
compare the second entry against the first.  Both entries are required to 
match in order for the password to be changed.</p><p>After the password has been entered, password aging information
is checked to see if the user is permitted to change their password
at this time.  If not, <span class="command"><strong>passwd</strong></span> refuses to change the
password and exits.</p><p>
To get current password status information, use the
<code class="literal">-S</code> option. Administrators can use
<span class="command"><strong>passwd</strong></span> to perform several account maintenance
functions (users may perform some of these functions on their own
accounts).  Accounts may be locked with the <code class="literal">-l</code> flag
and unlocked with the <code class="literal">-u</code> flag.  Similarly,
<code class="literal">-c</code> disables a user's ability to change passwords, and
<code class="literal">-C</code> allows a user to change passwords.  For password
expiry, the <code class="literal">-e</code> option disables expiration, while the
<code class="literal">-E</code> option causes the password to expire according to
the system's normal aging rules.  Use <code class="literal">-p</code> to disable
the password requirement for a user, or <code class="literal">-P</code> to require
a password.
</p><p>Administrators can also use <span class="command"><strong>passwd</strong></span> to change
system-wide password expiry and length requirements with the
<code class="literal">-i</code>, <code class="literal">-n</code>, <code class="literal">-x</code>,
and <code class="literal">-L</code> options.  The <code class="literal">-i</code>
option is used to disable an account after the password has been expired
for a number of days.  After a user account has had an expired password
for <span class="emphasis"><em>NUM</em></span> days, the user may no longer sign on to
the account.  The <code class="literal">-n</code> option is
used to set the minimum number of days before a password may be changed.
The user will not be permitted to change the password until
<span class="emphasis"><em>MINDAYS</em></span> days have elapsed.  The
<code class="literal">-x</code> option is used to set the maximum number of days
a password remains valid.  After <span class="emphasis"><em>MAXDAYS</em></span> days, the
password is required to be changed.  Allowed values for the above options 
are 0 to 999.  The <code class="literal">-L</code> option sets the minimum length of 
allowed passwords for users who don't belong to the administrators group
to <span class="emphasis"><em>LEN</em></span> characters.  Allowed values for the minimum
password length are 0 to 14.  In any of the above cases, a value of 0
means `no restrictions'.</p><p>
All operations affecting the current user are by default run against
the logon server of the current user (taken from the environment
variable <code class="envar">LOGONSERVER</code>.  When password or account information
of other users should be changed, the default server is the local system.
To change a user account on a remote machine, use the <code class="literal">-d</code>
option to specify the machine to run the command against.  Note that the
current user must be a valid member of the administrators group on the remote
machine to perform such actions.
</p><p>Users can use the <span class="command"><strong>passwd -R</strong></span> to enter
a password which then gets stored in a special area of the registry on the
local system, which is also used by Windows to store passwords of accounts
running Windows services.  When a privileged Cygwin application calls the
<span class="command"><strong>set{e}uid(user_id)</strong></span> system call, Cygwin checks if a
password for that user has been stored in this registry area.  If so, it
uses this password to switch to this user account using that password.
This allows you to logon through, for instance, <span class="command"><strong>ssh</strong></span> with
public key authentication and get a full qualified user token with
all credentials for network access.  However, the method has some
drawbacks security-wise.  This is explained in more detail in
<a class="xref" href="#ntsec" title="Using Windows security in Cygwin">the section called &#8220;Using Windows security in Cygwin&#8221;</a>.</p><p>Please note that storing passwords in that registry area is a
privileged operation which only administrative accounts are allowed to
do.  If normal, non-admin users should be allowed to enter their
passwords using <span class="command"><strong>passwd -R</strong></span>, it's required to run
<span class="command"><strong>cygserver</strong></span> as a service under the LocalSystem account
before running <span class="command"><strong>passwd -R</strong></span>.  This only affects storing
passwords.  Using passwords in privileged processes does not require
<span class="command"><strong>cygserver</strong></span> to run.</p><p>Limitations: Users may not be able to change their password on
some systems.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ps"></a>ps</h3></div></div></div><pre class="screen">
Usage: ps [-aefls] [-u UID]
Report process status

 -a, --all       show processes of all users
 -e, --everyone  show processes of all users
 -f, --full      show process uids, ppids
 -h, --help      output usage information and exit
 -l, --long      show process uids, ppids, pgids, winpids
 -p, --process   show information for specified PID
 -s, --summary   show process summary
 -u, --user      list processes owned by UID
 -v, --version   output version information and exit
 -W, --windows   show windows as well as cygwin processes
With no options, ps outputs the long format by default
</pre><p>The <span class="command"><strong>ps</strong></span> program gives the status of all the
Cygwin processes running on the system (ps = "process status").  Due
to the limitations of simulating a POSIX environment under Windows,
there is little information to give.  
</p><p>
The PID column is the process ID you need to give to the 
<span class="command"><strong>kill</strong></span> command. The PPID is the parent process ID,
and PGID is the process group ID.  The WINPID column is the process 
ID displayed by NT's Task Manager program. The TTY column gives which 
pseudo-terminal a process is running on, or a <code class="literal">'?'</code>
for services. The UID column shows which user owns each process. 
STIME is the time the process was started, and COMMAND gives the name
of the program running. Listings may also have a status flag in
column zero; <code class="literal">S</code> means stopped or suspended (in other
words, in the background), <code class="literal">I</code> means waiting for
input or interactive (foreground), and <code class="literal">O</code> means
waiting to output. 
</p><p>
By default, <span class="command"><strong>ps</strong></span> will only show processes owned by the
current user. With either the <code class="literal">-a</code> or <code class="literal">-e</code>
option, all user's processes (and system processes) are listed. There are
historical UNIX reasons for the synonomous options, which are functionally
identical. The <code class="literal">-f</code> option outputs a "full" listing with
usernames for UIDs. The <code class="literal">-l</code> option is the default display
mode, showing a "long" listing with all the above columns. The other display
option is <code class="literal">-s</code>, which outputs a shorter listing of just
PID, TTY, STIME, and COMMAND. The <code class="literal">-u</code> option allows you
to show only processes owned by a specific user. The <code class="literal">-p</code>
option allows you to show information for only the process with the
specified PID. The <code class="literal">-W</code>
option causes <span class="command"><strong>ps</strong></span> show non-Cygwin Windows processes as 
well as Cygwin processes. The WINPID is also the PID, and they can be killed
with the Cygwin <span class="command"><strong>kill</strong></span> command's <code class="literal">-f</code>
option.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="regtool"></a>regtool</h3></div></div></div><pre class="screen">
Usage: regtool [OPTION] (add|check|get|list|remove|unset|load|unload|save) KEY
View or edit the Win32 registry

Actions:
 add KEY\SUBKEY             add new SUBKEY
 check KEY                  exit 0 if KEY exists, 1 if not
 get KEY\VALUE              prints VALUE to stdout
 list KEY                   list SUBKEYs and VALUEs
 remove KEY                 remove KEY
 set KEY\VALUE [data ...]   set VALUE
 unset KEY\VALUE            removes VALUE from KEY
 load KEY\SUBKEY PATH       load hive from PATH into new SUBKEY
 unload KEY\SUBKEY          unload hive and remove SUBKEY
 save KEY\SUBKEY PATH       save SUBKEY into new hive PATH

Options for 'list' Action:
 -k, --keys           print only KEYs
 -l, --list           print only VALUEs
 -p, --postfix        like ls -p, appends '\' postfix to KEY names

Options for 'get' Action:
 -b, --binary         print REG_BINARY data as hex bytes

Options for 'set' Action:
 -b, --binary         set type to REG_BINARY (hex args or '-')
 -e, --expand-string  set type to REG_EXPAND_SZ
 -i, --integer        set type to REG_DWORD
 -m, --multi-string   set type to REG_MULTI_SZ
 -s, --string         set type to REG_SZ

Options for 'set' and 'unset' Actions:
 -K&lt;c&gt;, --key-separator[=]&lt;c&gt;  set key separator to &lt;c&gt; instead of '\'

Other Options:
 -h, --help     output usage information and exit
 -q, --quiet    no error output, just nonzero return if KEY/VALUE missing
 -v, --verbose  verbose output, including VALUE contents when applicable
 -w, --wow64    access 64 bit registry view (ignored on 32 bit Windows)
 -W, --wow32    access 32 bit registry view (ignored on 32 bit Windows)
 -V, --version  output version information and exit

KEY is in the format [host]\prefix\KEY\KEY\VALUE, where host is optional
remote host in either \\hostname or hostname: format and prefix is any of:
  root     HKCR  HKEY_CLASSES_ROOT (local only)
  config   HKCC  HKEY_CURRENT_CONFIG (local only)
  user     HKCU  HKEY_CURRENT_USER (local only)
  machine  HKLM  HKEY_LOCAL_MACHINE
  users    HKU   HKEY_USERS

You can use forward slash ('/') as a separator instead of backslash, in
that case backslash is treated as escape character
Example: regtool.exe get '\user\software\Microsoft\Clock\iFormat'
</pre><p>The <span class="command"><strong>regtool</strong></span> program allows shell scripts
to access and modify the Windows registry.  Note that modifying the
Windows registry is dangerous, and carelessness here can result
in an unusable system.  Be careful.</p><p>The <code class="literal">-v</code> option means "verbose".  For most
commands, this causes additional or lengthier messages to be printed.
Conversely, the <code class="literal">-q</code> option supresses error messages,
so you can use the exit status of the program to detect if a key
exists or not (for example).</p><p>The <code class="literal">-w</code> option allows you to access the 64 bit view
of the registry.  Several subkeys exist in a 32 bit and a 64 bit version
when running on Windows 64.  Since Cygwin is running in 32 bit mode, it
only has access to the 32 bit view of these registry keys.  When using
the <code class="literal">-w</code> switch, the 64 bit view is used and
<span class="command"><strong>regtool</strong></span> can access the entire registry.
This option is simply ignored when running on 32 bit Windows versions.
</p><p>The <code class="literal">-W</code> option allows you to access the 32 bit view
on the registry.  The purpose of this option is mainly for symmetry.  It
permits creation of OS agnostic scripts which would also work in a hypothetical
64 bit version of Cygwin.</p><p>You must provide <span class="command"><strong>regtool</strong></span> with an 
<span class="emphasis"><em>action</em></span> following options (if any). Currently,
the action must be <code class="literal">add</code>, <code class="literal">set</code>,
<code class="literal">check</code>, <code class="literal">get</code>, <code class="literal">list</code>,
<code class="literal">remove</code>, <code class="literal">set</code>, or <code class="literal">unset</code>.
</p><p>The <code class="literal">add</code> action adds a new key.  The 
<code class="literal">check</code> action checks to see if a key exists (the 
exit code of the program is zero if it does, nonzero if it does not).
The <code class="literal">get</code> action gets the value of a key,
and prints it (and nothing else) to stdout.  Note: if the value
doesn't exist, an error message is printed and the program returns a
non-zero exit code.  If you give <code class="literal">-q</code>, it doesn't
print the message but does return the non-zero exit code.</p><p>
The <code class="literal">list</code> action lists the subkeys and values
belonging to the given key. With <code class="literal">list</code>, the 
<code class="literal">-k</code> option instructs <span class="command"><strong>regtool</strong></span>
to print only KEYs, and the <code class="literal">-l</code> option to print
only VALUEs. The <code class="literal">-p</code> option postfixes a 
<code class="literal">'/'</code> to each KEY, but leave VALUEs with no
postfix.  The <code class="literal">remove</code> action 
removes a key.  Note that you may need to remove everything in the key 
before you may remove it, but don't rely on this stopping you from 
accidentally removing too much.  
</p><p>The <code class="literal">set</code> action sets a value within a key.
<code class="literal">-b</code> means it's binary data (REG_BINARY).
The binary values are specified as hex bytes in the argument list.
If the argument is <code class="literal">'-'</code>, binary data is read
from stdin instead.
<code class="literal">-e</code> means it's an expanding string (REG_EXPAND_SZ)
that contains embedded environment variables.  
<code class="literal">-i</code> means the value is an integer (REG_DWORD).
<code class="literal">-m</code> means it's a multi-string (REG_MULTI_SZ).  
<code class="literal">-s</code> means the value is a string (REG_SZ).
If you don't specify one of these, <span class="command"><strong>regtool</strong></span> tries to
guess the type based on the value you give.  If it looks like a
number, it's a DWORD.  If it starts with a percent, it's an expanding
string.  If you give multiple values, it's a multi-string.  Else, it's
a regular string.
The <code class="literal">unset</code> action removes a value from a key.
</p><p>The <code class="literal">load</code> action adds a new subkey and loads
the contents of a registry hive into it.
The parent key must be HKEY_LOCAL_MACHINE or HKEY_USERS.
The <code class="literal">unload</code> action unloads the file and removes
the subkey.
</p><p>The <code class="literal">save</code> action saves a subkey into a
registry hive.
</p><p>
By default, the last "\" or "/" is assumed to be the separator between the
key and the value.  You can use the <code class="literal">-K</code> option to provide 
an alternate key/value separator character.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setfacl"></a>setfacl</h3></div></div></div><pre class="screen">
Usage: setfacl [-r] (-f ACL_FILE | -s acl_entries) FILE...
       setfacl [-r] ([-d acl_entries] [-m acl_entries]) FILE...
Modify file and directory access control lists (ACLs)

  -d, --delete     delete one or more specified ACL entries
  -f, --file       set ACL entries for FILE to ACL entries read
                   from a ACL_FILE
  -m, --modify     modify one or more specified ACL entries
  -r, --replace    replace mask entry with maximum permissions
                   needed for the file group class
  -s, --substitute substitute specified ACL entries for the
                   ACL of FILE
  -h, --help       output usage information and exit
  -v, --version    output version information and exit

At least one of (-d, -f, -m, -s) must be specified
</pre><p>
For each file given as parameter, <span class="command"><strong>setfacl</strong></span> will 
either replace its complete ACL (<code class="literal">-s</code>, <code class="literal">-f</code>), 
or it will add, modify, or delete ACL entries.
For more information on Cygwin and Windows ACLs, see
see <a class="xref" href="#ntsec" title="Using Windows security in Cygwin">the section called &#8220;Using Windows security in Cygwin&#8221;</a> in the Cygwin User's Guide.
</p><p>
Acl_entries are one or more comma-separated ACL entries 
from the following list:
</p><pre class="screen">
         u[ser]::perm
         u[ser]:uid:perm
         g[roup]::perm
         g[roup]:gid:perm
         m[ask]::perm
         o[ther]::perm
</pre><p>
Default entries are like the above with the additional
default identifier. For example: 
</p><pre class="screen">
         d[efault]:u[ser]:uid:perm
</pre><p>
</p><p>
<span class="emphasis"><em>perm</em></span> is either a 3-char permissions string in the form
"rwx" with the character <code class="literal">'-'</code> for no permission
or it is the octal representation of the permissions, a
value from 0 (equivalent to "---") to 7 ("rwx").
<span class="emphasis"><em>uid</em></span> is a user name or a numerical uid.
<span class="emphasis"><em>gid</em></span> is a group name or a numerical gid.
</p><p>
The following options are supported:
</p><p>
<code class="literal">-d</code>
Delete one or more specified entries from the file's ACL.
The owner, group and others entries must not be deleted.
Acl_entries to be deleted should be specified without
permissions, as in the following list:
</p><pre class="screen">
         u[ser]:uid
         g[roup]:gid
         d[efault]:u[ser]:uid
         d[efault]:g[roup]:gid
         d[efault]:m[ask]:
         d[efault]:o[ther]:
</pre><p>
</p><p>
<code class="literal">-f</code>
Take the Acl_entries from ACL_FILE one per line. Whitespace
characters are ignored, and the character "#" may be used
to start a comment.  The special filename "-" indicates
reading from stdin. Note that you can use this with 
<span class="command"><strong>getfacl</strong></span> and <span class="command"><strong>setfacl</strong></span> to copy 
ACLs from one file to another:
</p><pre class="screen">
$ getfacl source_file | setfacl -f - target_file
</pre><p>
</p><p>
Required entries are: 
one user entry for the owner of the file,
one group entry for the group of the file, and
one other entry.
</p><p>
If additional user and group entries are given:
a mask entry for the file group class of the file, and 
no duplicate user or group entries with the same uid/gid.
</p><p>
If it is a directory:
one default user entry for the owner of the file,
one default group entry for the group of the file,
one default mask entry for the file group class, and
one default other entry.
</p><p>
<code class="literal">-m</code>
Add or modify one or more specified ACL entries.  Acl_entries is a 
comma-separated list of entries from the same list as above.
</p><p>
<code class="literal">-r</code>   
Causes the permissions specified in the mask 
entry to be ignored and replaced by the maximum permissions needed for 
the file group class.
</p><p>
<code class="literal">-s</code>   
Like <code class="literal">-f</code>, but substitute the 
file's ACL with Acl_entries specified in a comma-separated list on the 
command line.
</p><p>
While the <code class="literal">-d</code> and <code class="literal">-m</code> options may be used 
in the same command, the <code class="literal">-f</code> and <code class="literal">-s</code> 
options may be used only exclusively.
</p><p>
Directories may contain default ACL entries.  Files created
in a directory that contains default ACL entries will have
permissions according to the combination of the current umask,
the explicit permissions requested and the default ACL entries
</p><p>
Limitations: Under Cygwin, the default ACL entries are not taken into
account currently.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ssp"></a>ssp</h3></div></div></div><pre class="screen">
Usage: ssp [options] low_pc high_pc command...
Single-step profile COMMAND

 -c, --console-trace  trace every EIP value to the console. *Lots* slower.
 -d, --disable        disable single-stepping by default; use
                      OutputDebugString ("ssp on") to enable stepping
 -e, --enable         enable single-stepping by default; use
                      OutputDebugString ("ssp off") to disable stepping
 -h, --help           output usage information and exit
 -l, --dll            enable dll profiling.  A chart of relative DLL usage
                      is produced after the run.
 -s, --sub-threads    trace sub-threads too.  Dangerous if you have
                      race conditions.
 -t, --trace-eip      trace every EIP value to a file TRACE.SSP.  This
                      gets big *fast*.
 -v, --verbose        output verbose messages about debug events.
 -V, --version        output version information and exit

Example: ssp 0x401000 0x403000 hello.exe
</pre><p>
SSP - The Single Step Profiler
</p><p>
Original Author:  DJ Delorie 
</p><p>
The SSP is a program that uses the Win32 debug API to run a program
one ASM instruction at a time.  It records the location of each
instruction used, how many times that instruction is used, and all
function calls.  The results are saved in a format that is usable by
the profiling program <span class="command"><strong>gprof</strong></span>, although 
<span class="command"><strong>gprof</strong></span> will claim the values
are seconds, they really are instruction counts.  More on that later.
</p><p>
Because the SSP was originally designed to profile the cygwin DLL, it
does not automatically select a block of code to report statistics on.
You must specify the range of memory addresses to keep track of
manually, but it's not hard to figure out what to specify.  Use the
"objdump" program to determine the bounds of the target's ".text"
section.  Let's say we're profiling cygwin1.dll.  Make sure you've
built it with debug symbols (else <span class="command"><strong>gprof</strong></span> won't run) 
and run objdump like this:

</p><pre class="screen">
$ objdump -h cygwin1.dll
</pre><p>

It will print a report like this:
</p><pre class="screen">
cygwin1.dll:     file format pei-i386

Sections:
Idx Name          Size      VMA       LMA       File off  Algn
  0 .text         0007ea00  61001000  61001000  00000400  2**2
                  CONTENTS, ALLOC, LOAD, READONLY, CODE, DATA
  1 .data         00008000  61080000  61080000  0007ee00  2**2
                  CONTENTS, ALLOC, LOAD, DATA
  . . .
</pre><p>
</p><p>
The only information we're concerned with are the VMA of 
the .text section and the VMA of the section after it 
(sections are usually contiguous; you can also add the 
Size to the VMA to get the end address).  In this case, 
the VMA is 0x61001000 and the ending address is either 
0x61080000 (start of .data method) or 0x0x6107fa00 (VMA+Size
method).
</p><p>
There are two basic ways to use SSP - either profiling a whole
program, or selectively profiling parts of the program.
</p><p>
To profile a whole program, just run <span class="command"><strong>ssp</strong></span> without options.  
By default, it will step the whole program.  Here's a simple example, using 
the numbers above:

</p><pre class="screen">
$ ssp 0x61001000 0x61080000 hello.exe
</pre><p>

This will step the whole program.  It will take at least 8 minutes on
a PII/300 (yes, really).  When it's done, it will create a file called
"gmon.out".  You can turn this data file into a readable report with
<span class="command"><strong>gprof</strong></span>:

</p><pre class="screen">
$ gprof -b cygwin1.dll
</pre><p>

The "-b" means 'skip the help pages'.  You can omit this until you're
familiar with the report layout.  The <span class="command"><strong>gprof</strong></span> documentation 
explains a lot about this report, but <span class="command"><strong>ssp</strong></span> changes a few 
things.  For example, the first part of the report reports the amount of time 
spent in each function, like this:

</p><pre class="screen">
Each sample counts as 0.01 seconds.
  %   cumulative   self              self     total
 time   seconds   seconds    calls  ms/call  ms/call  name
 10.02    231.22    72.43       46  1574.57  1574.57  strcspn
  7.95    288.70    57.48      130   442.15   442.15  strncasematch
</pre><p>

The "seconds" columns are really CPU opcodes, 1/100 second per opcode.
So, "231.22" above means 23,122 opcodes.  The ms/call values are 10x
too big; 1574.57 means 157.457 opcodes per call.  Similar adjustments
need to be made for the "self" and "children" columns in the second
part of the report.
</p><p>
OK, so now we've got a huge report that took a long time to generate,
and we've identified a spot we want to work on optimizing.  Let's say
it's the time() function.  We can use SSP to selectively profile this
function by using OutputDebugString() to control SSP from within the
program.  Here's a sample program:

</p><pre class="screen">
	#include &lt;windows.h&gt;
	main()
	{
	  time_t t;
	  OutputDebugString("ssp on");
	  time(&amp;t);
	  OutputDebugString("ssp off");
	}
</pre><p>
</p><p>
Then, add the <code class="literal">-d</code> option to ssp to default to 
*disabling* profiling.  The program will run at full speed until the first 
OutputDebugString, then step until the second.
You can then use <span class="command"><strong>gprof</strong></span> (as usual) to see the performance 
profile for just that portion of the program's execution.
</p><p>
There are many options to ssp.  Since step-profiling makes your
program run about 1,000 times slower than normal, it's best to
understand all the options so that you can narrow down the parts
of your program you need to single-step.
</p><p>
<code class="literal">-v</code> - verbose.  This prints messages about threads 
starting and stopping, OutputDebugString calls, DLLs loading, etc.
</p><p>
<code class="literal">-t</code> and <code class="literal">-c</code> - tracing.  
With <code class="literal">-t</code>, *every* step's address is written
to the file "trace.ssp".  This can be used to help debug functions,
since it can trace multiple threads.  Clever use of scripts can match
addresses with disassembled opcodes if needed.  Warning: creates
*huge* files, very quickly.  <code class="literal">-c</code> prints each address to 
the console, useful for debugging key chunks of assembler.  Use 
<code class="literal">addr2line -C -f -s -e foo.exe &lt; trace.ssp &gt; lines.ssp</code>
and then <code class="literal">perl cvttrace</code> to convert to symbolic traces.
</p><p>
<code class="literal">-s</code> - subthreads.  Usually, you only need to trace the 
main thread, but sometimes you need to trace all threads, so this enables that.
It's also needed when you want to profile a function that only a
subthread calls.  However, using OutputDebugString automatically
enables profiling on the thread that called it, not the main thread.
</p><p>
<code class="literal">-l</code> - dll profiling.  Generates a pretty table of how much 
time was spent in each dll the program used.  No sense optimizing a function in
your program if most of the time is spent in the DLL.
I usually use the <code class="literal">-v</code>, <code class="literal">-s</code>, and 
<code class="literal">-l</code> options:

</p><pre class="screen">
$ ssp <code class="literal">-v</code> <code class="literal">-s</code> <code class="literal">-l</code> <code class="literal">-d</code> 0x61001000 0x61080000 hello.exe
</pre><p>
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="strace"></a>strace</h3></div></div></div><pre class="screen">
Usage: strace.exe [OPTIONS] &lt;command-line&gt;
Usage: strace.exe [OPTIONS] -p &lt;pid&gt;
Trace system calls and signals

  -b, --buffer-size=SIZE       set size of output file buffer
  -d, --no-delta               don't display the delta-t microsecond timestamp
  -f, --trace-children         trace child processes (toggle - default true)
  -h, --help                   output usage information and exit
  -m, --mask=MASK              set message filter mask
  -n, --crack-error-numbers    output descriptive text instead of error
                               numbers for Windows errors
  -o, --output=FILENAME        set output file to FILENAME
  -p, --pid=n                  attach to executing program with cygwin pid n
  -q, --quiet                  toggle "quiet" flag.  Defaults to on if "-p",
                               off otherwise.
  -S, --flush-period=PERIOD    flush buffered strace output every PERIOD secs
  -t, --timestamp              use an absolute hh:mm:ss timestamp insted of 
                               the default microsecond timestamp.  Implies -d
  -T, --toggle                 toggle tracing in a process already being
  -u, --usecs                  toggle printing of microseconds timestamp
                               traced. Requires -p &lt;pid&gt;
  -v, --version                output version information and exit
  -w, --new-window             spawn program under test in a new window

    MASK can be any combination of the following mnemonics and/or hex values
    (0x is optional).  Combine masks with '+' or ',' like so:

                      --mask=wm+system,malloc+0x00800

    Mnemonic Hex     Corresponding Def  Description
    =========================================================================
    all      0x00001 (_STRACE_ALL)      All strace messages.
    flush    0x00002 (_STRACE_FLUSH)    Flush output buffer after each message.
    inherit  0x00004 (_STRACE_INHERIT)  Children inherit mask from parent.
    uhoh     0x00008 (_STRACE_UHOH)     Unusual or weird phenomenon.
    syscall  0x00010 (_STRACE_SYSCALL)  System calls.
    startup  0x00020 (_STRACE_STARTUP)  argc/envp printout at startup.
    debug    0x00040 (_STRACE_DEBUG)    Info to help debugging. 
    paranoid 0x00080 (_STRACE_PARANOID) Paranoid info.
    termios  0x00100 (_STRACE_TERMIOS)  Info for debugging termios stuff.
    select   0x00200 (_STRACE_SELECT)   Info on ugly select internals.
    wm       0x00400 (_STRACE_WM)       Trace Windows msgs (enable _strace_wm).
    sigp     0x00800 (_STRACE_SIGP)     Trace signal and process handling.
    minimal  0x01000 (_STRACE_MINIMAL)  Very minimal strace output.
    exitdump 0x04000 (_STRACE_EXITDUMP) Dump strace cache on exit.
    system   0x08000 (_STRACE_SYSTEM)   Serious error; goes to console and log.
    nomutex  0x10000 (_STRACE_NOMUTEX)  Don't use mutex for synchronization.
    malloc   0x20000 (_STRACE_MALLOC)   Trace malloc calls.
    thread   0x40000 (_STRACE_THREAD)   Thread-locking calls.
</pre><p>The <span class="command"><strong>strace</strong></span> program executes a program, and
optionally the children of the program, reporting any Cygwin DLL output
from the program(s) to stdout, or to a file with the <code class="literal">-o</code>
option.  With the <code class="literal">-w</code> option, you can start an strace
session in a new window, for example:

</p><pre class="screen">
$ strace -o tracing_output -w sh -c 'while true; do echo "tracing..."; done' &amp;
</pre><p>
This is particularly useful for <span class="command"><strong>strace</strong></span> sessions that
take a long time to complete.
</p><p>
Note that <span class="command"><strong>strace</strong></span> is a standalone Windows program and so does 
not rely on the Cygwin DLL itself (you can verify this with 
<span class="command"><strong>cygcheck</strong></span>). As a result it does not understand symlinks.
This program is mainly useful for debugging the Cygwin DLL itself.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="umount"></a>umount</h3></div></div></div><pre class="screen">
Usage: umount.exe [OPTION] [&lt;posixpath&gt;]
Unmount filesystems

  -h, --help                    output usage information and exit
  -U, --remove-user-mounts      remove all user mounts
  -v, --version                 output version information and exit
</pre><p>The <span class="command"><strong>umount</strong></span> program removes mounts from the
mount table in the current session.  If you specify a POSIX path that
corresponds to a current mount point, <span class="command"><strong>umount</strong></span> will
remove it from the current mount table.  Note that you can only remove
user mount points.  The <code class="literal">-U</code> flag may be used to
specify removing all user mount points from the current user session.</p><p>See <a class="xref" href="#mount-table" title="The Cygwin Mount Table">the section called &#8220;The Cygwin Mount Table&#8221;</a> for more information on the mount
table.</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-effectively"></a>Using Cygwin effectively with Windows</h2></div></div></div><p>
Cygwin is not a full operating system, and so must rely on Windows for
accomplishing some tasks. For example, Cygwin provides a POSIX view
of the Windows filesystem, but does not provide filesystem drivers of 
its own. Therefore part of using Cygwin effectively is learning to use
Windows effectively. 
Many Windows utilities provide a good way to interact with Cygwin's 
predominately command-line environment. For example, 
<span class="command"><strong>ipconfig.exe</strong></span> provides information about network 
configuration, and <span class="command"><strong>net.exe</strong></span> views and configures
network file and printer resources.  Most of these tools
support the <code class="literal">/?</code> switch to display usage information. 
</p><p>
Unfortunately, no standard set of tools included with all versions of 
Windows exists.  If you are unfamiliar with the tools available 
on your system, here is a general guide.  Windows NT 4.0 has only a basic 
set of tools, which later versions of Windows expanded. 
Microsoft also provides free downloads for Windows NT 4.0 (the Resource Kit 
Support Tools), Windows 2000 (the Resource Kit Tools), and XP (the 
Windows Support Tools).  Generally, the younger the Windows version, the
more complete are the on-board tools.  Additionally, many independent sites
such as 
<a class="ulink" href="http://download.com" target="_top">download.com</a>, 
<a class="ulink" href="http://simtel.net" target="_top">simtel.net</a>, 
and Microsoft's own
<a class="ulink" href="http://technet.microsoft.com/en-us/sysinternals/default.aspx" target="_top">Sysinternals</a>
provide quite useful command-line utilities, as far as they are not
already provided by Cygwin.  A few Windows tools, such as 
<span class="command"><strong>find.exe</strong></span>, <span class="command"><strong>link.exe</strong></span> and
<span class="command"><strong>sort.exe</strong></span>, may conflict with the Cygwin versions
make sure that you use the full path (<span class="command"><strong>/usr/bin/find</strong></span>)
or that your Cygwin <code class="literal">bin</code> directory comes first in your
<code class="envar">PATH</code>.
</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="using-pathnames-effectively"></a>Pathnames</h3></div></div></div><p>
Windows programs do not understand POSIX pathnames, so any arguments 
that reference the filesystem must be in Windows (or DOS) format or 
translated.  Cygwin provides the <span class="command"><strong>cygpath</strong></span> utility for 
converting between Windows and POSIX paths. A complete description of its 
options and examples of its usage are in <a class="xref" href="#cygpath" title="cygpath">the section called &#8220;cygpath&#8221;</a>, 
including a shell script for starting Windows Explorer in any directory. 
The same format works for most Windows programs, for example 
</p><pre class="screen">
<code class="literal">notepad.exe "$(cygpath -aw "Desktop/Phone Numbers.txt")"</code>
</pre><p>
A few programs require a Windows-style, semicolon-delimited path list, 
which <span class="command"><strong>cygpath</strong></span> can translate from a POSIX path with the
<code class="literal">-p</code> option. For example, a Java compilation from 
<span class="command"><strong>bash</strong></span> might look like this: 
</p><pre class="screen">
<code class="literal">javac -cp "$(cygpath -pw "$CLASSPATH")" hello.java</code>
</pre><p>
Since using quoting and subshells is somewhat awkward, it is often 
preferable to use <span class="command"><strong>cygpath</strong></span> in shell scripts.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="using-console"></a>Console Programs</h3></div></div></div><p>
Another issue is receiving output from or giving input to console-based 
Windows programs.  Unfortunately, interacting with Windows console 
applications is not a simple matter of using a translation utility. Windows 
console applications are designed to run under 
<span class="command"><strong>cmd.exe</strong></span>, and some do not deal gracefully with other
situations.  Cygwin can receive console input only if it
is also running in a console window since Windows does not provide
any way to attach to the backend of the console device. Another
traditional Unix input/output method, ptys (pseudo-terminals), is
supported by Cygwin but not entirely by Windows.  The basic problem is 
that a Cygwin pty is a pipe and some Windows applications do not like 
having their input or output redirected to pipes.  
</p><p>
To help deal with these issues, Cygwin supports customizable levels of 
Windows versus Unix compatibility behavior.  To be most compatible with 
Windows programs, use a DOS prompt, running only the occasional Cygwin 
command or script. Next would be to run <span class="command"><strong>bash</strong></span> within 
a default DOS box. To make Cygwin more Unix compatible in this case, 
set <code class="envar">CYGWIN=tty</code> (see <a class="xref" href="#using-cygwinenv" title="The CYGWIN environment variable">the section called &#8220;The CYGWIN environment
variable&#8221;</a>).
Alternatively, the optional <code class="systemitem">rxvt</code> package provides 
a native-Windows version of the popular X11 terminal emulator (it is not 
necessary to set <code class="envar">CYGWIN=tty</code> with <span class="command"><strong>rxvt</strong></span>). 
Using <span class="command"><strong>rxvt.exe</strong></span> provides the most Unix-like environment, 
but expect some compatibility problems with Windows programs.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="using-net"></a>Cygwin and Windows Networking</h3></div></div></div><p>
Many popular Cygwin packages, such as <code class="systemitem">ncftp</code>, 
<code class="systemitem">lynx</code>, and <code class="systemitem">wget</code>, require a 
network connection.  Since Cygwin relies on Windows for connectivity, 
if one of these tools is not working as expected you may need to 
troubleshoot using Windows tools. The first test is to see if you
can reach the URL's host with <span class="command"><strong>ping.exe</strong></span>, one of the 
few utilities included with every Windows version since Windows 95.
If you chose to install the <code class="systemitem">inetutils</code> package, 
you may have both
Windows and Cygwin versions of utilities such as <span class="command"><strong>ftp</strong></span>
and <span class="command"><strong>telnet</strong></span>. If you are having problems using one
of these programs, see if the alternate one works as expected. 
</p><p>
There are a variety of other programs available for specific situations.
If your system does not have an always-on network connection, you 
may be interested in <span class="command"><strong>rasdial.exe</strong></span> for automating dialup
connections.  
Users who frequently change their network 
configuration can script these changes with <span class="command"><strong>netsh.exe</strong></span> 
(Windows 2000 and later). For proxy users, the open source 
<a class="ulink" href="http://apserver.sourceforge.net" target="_top">
NTLM Authorization Proxy Server</a> or the no-charge
<a class="ulink" href="http://www.hummingbird.com/products/nc/socks/index.html" target="_top">
Hummingbird SOCKS Proxy</a> may allow you to use Cygwin network
programs in your environment.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="using-cygutils"></a>The cygutils package</h3></div></div></div><p>
The optional <code class="systemitem">cygutils</code> package contains
miscellaneous tools that are small enough to not require their own package.
It is not included in a default Cygwin install; select it from the Utils
category in <span class="command"><strong>setup.exe</strong></span>. Several of the
<code class="systemitem">cygutils</code> tools are useful for interacting with
Windows.</p><p>
One of the hassles of Unix-Windows interoperability is the different line 
endings on text files.  As mentioned in <a class="xref" href="#using-textbinary" title="Text and Binary modes">the section called &#8220;Text and Binary modes&#8221;</a>, 
Unix tools such as <span class="command"><strong>tr</strong></span> can convert between CRLF and LF 
endings, but <code class="systemitem">cygutils</code> provides several dedicated programs: 
<span class="command"><strong>conv</strong></span>, <span class="command"><strong>d2u</strong></span>, <span class="command"><strong>dos2unix</strong></span>, 
<span class="command"><strong>u2d</strong></span>, and <span class="command"><strong>unix2dos</strong></span>. Use the
<code class="literal">--help</code> switch for usage information. 
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="using-shortcuts"></a>Creating shortcuts with cygutils</h3></div></div></div><p>
Another problem area is between Unix-style links, which link one file
to another, and Microsoft .lnk files, which provide a shortcut to a
file.  They seem similar at first glance but, in reality, are fairly 
different.  By default, Cygwin uses a mechanism that creates symbolic
links that are compatible with standard Microsoft .lnk files. However,
they do not include much of the information that is available in a 
standard Microsoft shortcut, such as the working directory, an icon, 
etc.  The <code class="systemitem">cygutils</code> package includes a 
<span class="command"><strong>mkshortcut</strong></span> 
utility for creating standard Microsoft .lnk files.
</p><p>
If Cygwin handled these native shortcuts like any other symlink, 
you could not archive Microsoft .lnk files into <span class="command"><strong>tar</strong></span>
archives and keep all the information in them.  After unpacking, 
these shortcuts would have lost all the extra information and would
be no different than standard Cygwin symlinks. Therefore these two types 
of links are treated differently.  Unfortunately, this means that the 
usual Unix way of creating and using symlinks does not work with 
Windows shortcuts. 
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="using-printing"></a>Printing with cygutils</h3></div></div></div><p>
There are several options for printing from Cygwin, including the 
<span class="command"><strong>lpr</strong></span> found in <code class="systemitem">cygutils</code> (not to be confused with the 
native Windows <span class="command"><strong>lpr.exe</strong></span>). The easiest way to use <code class="systemitem">cygutils</code>' 
<span class="command"><strong>lpr</strong></span> is to specify a default device name in the 
<code class="envar">PRINTER</code> environment variable.  You may also specify a device 
on the command line with the <code class="literal">-d</code> or <code class="literal">-P</code> 
options, which will override the environment variable setting. 
</p><p>
A device name 
may be a UNC path (<code class="literal">\\server_name\printer_name</code>), a reserved 
DOS device name (<code class="literal">prn</code>, <code class="literal">lpt1</code>), or a 
local port name that is mapped to a printer share. Note that forward slashes 
may be used in a UNC path (<code class="literal">//server_name/printer_name</code>),
which is helpful when using <span class="command"><strong>lpr</strong></span> from a shell that uses
the backslash as an escape character. 
</p><p>
<span class="command"><strong>lpr</strong></span> sends raw data to the printer; no formatting is done.
Many, but not all, printers accept plain text as input. If your printer 
supports PostScript, packages such as 
<code class="systemitem">a2ps</code> and <code class="systemitem">enscript</code> can prepare 
text files for printing. The <code class="systemitem">ghostscript</code> package also 
provides some translation
from PostScript to various native printer languages. Additionally, a native 
Windows application for printing PostScript, <span class="command"><strong>gsprint</strong></span>, is 
available from the <a class="ulink" href="http://www.cs.wisc.edu/~ghost/" target="_top">Ghostscript
website</a>.
</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="programming"></a>Chapter 4. Programming with Cygwin</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#gcc">Using GCC with Cygwin</a></span></dt><dd><dl><dt><span class="sect2"><a href="#gcc-cons">Console Mode Applications</a></span></dt><dt><span class="sect2"><a href="#gcc-gui">GUI Mode Applications</a></span></dt></dl></dd><dt><span class="sect1"><a href="#gdb">Debugging Cygwin Programs</a></span></dt><dt><span class="sect1"><a href="#dll">Building and Using DLLs</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dll-build">Building DLLs</a></span></dt><dt><span class="sect2"><a href="#dll-link">Linking Against DLLs</a></span></dt></dl></dd><dt><span class="sect1"><a href="#windres">Defining Windows Resources</a></span></dt></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gcc"></a>Using GCC with Cygwin</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="gcc-cons"></a>Console Mode Applications</h3></div></div></div><p>Use gcc to compile, just like under UNIX.
Refer to the GCC User's Guide for information on standard usage and
options.  Here's a simple example:</p><div class="example"><a name="gcc-hello-world"></a><p class="title"><b>Example 4.1. Building Hello World with GCC</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">bash$</code> <strong class="userinput"><code>gcc hello.c -o hello.exe</code></strong>
<code class="prompt">bash$</code> <strong class="userinput"><code>hello.exe</code></strong>
Hello, World

<code class="prompt">bash$</code>
</pre></div></div><br class="example-break"></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="gcc-gui"></a>GUI Mode Applications</h3></div></div></div><p>Cygwin allows you to build programs with full access to the
standard Windows 32-bit API, including the GUI functions as defined in
any Microsoft or off-the-shelf publication.  However, the process of
building those applications is slightly different, as you'll be using
the GNU tools instead of the Microsoft tools.</p><p>For the most part, your sources won't need to change at all.
However, you should remove all __export attributes from functions
and replace them like this:</p><pre class="screen">
int foo (int) __attribute__ ((__dllexport__));

int
foo (int i)
</pre><p>The Makefile is similar to any other UNIX-like Makefile,
and like any other Cygwin makefile.  The only difference is that you use
<span class="command"><strong>gcc -mwindows</strong></span> to link your program into a GUI
application instead of a command-line application.  Here's an example:</p><pre class="screen">

myapp.exe : myapp.o myapp.res
	gcc -mwindows myapp.o myapp.res -o $@

myapp.res : myapp.rc resource.h
	windres $&lt; -O coff -o $@

</pre><p>Note the use of <code class="filename">windres</code> to compile the
Windows resources into a COFF-format <code class="filename">.res</code> file.
That will include all the bitmaps, icons, and other resources you
need, into one handy object file.  Normally, if you omitted the "-O
coff" it would create a Windows <code class="filename">.res</code> format file,
but we can only link COFF objects.  So, we tell
<code class="filename">windres</code> to produce a COFF object, but for
compatibility with the many examples that assume your linker can
handle Windows resource files directly, we maintain the
<code class="filename">.res</code> naming convention.  For more information on
<code class="filename">windres</code>, consult the Binutils manual.  </p><p>
The following is a simple GUI-mode "Hello, World!" program to help
get you started:
</p><pre class="screen">
/*-------------------------------------------------*/
/* hellogui.c - gui hello world                    */
/* build: gcc -mwindows hellogui.c -o hellogui.exe */
/*-------------------------------------------------*/
#include &lt;windows.h&gt;

char glpszText[1024];

LRESULT CALLBACK WndProc(HWND, UINT, WPARAM, LPARAM);

int APIENTRY WinMain(HINSTANCE hInstance, 
		HINSTANCE hPrevInstance,
		LPSTR lpCmdLine,
		int nCmdShow)
{
	sprintf(glpszText, 
		"Hello World\nGetCommandLine(): [%s]\n"
		"WinMain lpCmdLine: [%s]\n",
		lpCmdLine, GetCommandLine() );

	WNDCLASSEX wcex; 
 
	wcex.cbSize = sizeof(wcex);
	wcex.style = CS_HREDRAW | CS_VREDRAW;
	wcex.lpfnWndProc = WndProc;
	wcex.cbClsExtra = 0;
	wcex.cbWndExtra = 0;
	wcex.hInstance = hInstance;
	wcex.hIcon = LoadIcon(NULL, IDI_APPLICATION);
	wcex.hCursor = LoadCursor(NULL, IDC_ARROW);
	wcex.hbrBackground = (HBRUSH)(COLOR_WINDOW+1);
	wcex.lpszMenuName = NULL;
	wcex.lpszClassName = "HELLO";
	wcex.hIconSm = NULL;

	if (!RegisterClassEx(&amp;wcex))
		return FALSE; 

	HWND hWnd;
	hWnd = CreateWindow("HELLO", "Hello", WS_OVERLAPPEDWINDOW,
		CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, NULL, NULL, hInstance, NULL);

	if (!hWnd)
		return FALSE;

	ShowWindow(hWnd, nCmdShow);
	UpdateWindow(hWnd);

	MSG msg;
	while (GetMessage(&amp;msg, NULL, 0, 0)) 
	{
		TranslateMessage(&amp;msg);
		DispatchMessage(&amp;msg);
	}

	return msg.wParam;
}

LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)
{
	PAINTSTRUCT ps;
	HDC hdc;
	
	switch (message) 
	{
		case WM_PAINT:
			hdc = BeginPaint(hWnd, &amp;ps);
			RECT rt;
			GetClientRect(hWnd, &amp;rt);
			DrawText(hdc, glpszText, strlen(glpszText), &amp;rt, DT_TOP | DT_LEFT);
			EndPaint(hWnd, &amp;ps);
			break;
		case WM_DESTROY:
			PostQuitMessage(0);
			break;
		default:
			return DefWindowProc(hWnd, message, wParam, lParam);
	}
	return 0;
}
</pre><p>
</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gdb"></a>Debugging Cygwin Programs</h2></div></div></div><p>When your program doesn't work right, it usually has a "bug" in
it, meaning there's something wrong with the program itself that is
causing unexpected results or crashes.  Diagnosing these bugs and
fixing them is made easy by special tools called
<span class="emphasis"><em>debuggers</em></span>.  In the case of Cygwin, the debugger
is GDB, which stands for "GNU DeBugger".  This tool lets you run your
program in a controlled environment where you can investigate the
state of your program while it is running or after it crashes.
Crashing programs sometimes create "core" files. In Cygwin these are 
regular text files that cannot be used directly by GDB.
</p><p>Before you can debug your program, you need to prepare your
program for debugging.  What you need to do is add
<code class="literal">-g</code> to all the other flags you use when compiling
your sources to objects.</p><div class="example"><a name="gdb-g"></a><p class="title"><b>Example 4.2. Compiling with -g</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">bash$</code> gcc -g -O2 -c myapp.c
<code class="prompt">bash$</code> gcc -g myapp.c -o myapp
</pre></div></div><br class="example-break"><p>What this does is add extra information to the objects (they get
much bigger too) that tell the debugger about line numbers, variable
names, and other useful things.  These extra symbols and debugging
information give your program enough information about the original
sources so that the debugger can make debugging much easier for
you.</p><p>To invoke GDB, simply type <span class="command"><strong>gdb myapp.exe</strong></span> at the
command prompt.  It will display some text telling you about itself,
then <code class="literal">(gdb)</code> will appear to prompt you to enter
commands.  Whenever you see this prompt, it means that gdb is waiting
for you to type in a command, like <span class="command"><strong>run</strong></span> or
<span class="command"><strong>help</strong></span>.  Oh <code class="literal">:-)</code> type
<span class="command"><strong>help</strong></span> to get help on the commands you can type in, or
read the [<span class="citation">GDB User's Manual</span>] for a complete
description of GDB and how to use it.</p><p>If your program crashes and you're trying to figure out why it
crashed, the best thing to do is type <span class="command"><strong>run</strong></span> and let
your program run.  After it crashes, you can type
<span class="command"><strong>where</strong></span> to find out where it crashed, or
<span class="command"><strong>info locals</strong></span> to see the values of all the local
variables.  There's also a <span class="command"><strong>print</strong></span> that lets you look
at individual variables or what pointers point to.</p><p>If your program is doing something unexpected, you can use the
<span class="command"><strong>break</strong></span> command to tell gdb to stop your program when it
gets to a specific function or line number:</p><div class="example"><a name="gdb-break"></a><p class="title"><b>Example 4.3. "break" in gdb</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">(gdb)</code> break my_function
<code class="prompt">(gdb)</code> break 47
</pre></div></div><br class="example-break"><p>Now, when you type <span class="command"><strong>run</strong></span> your program will stop
at that "breakpoint" and you can use the other gdb commands to look at
the state of your program at that point, modify variables, and
<span class="command"><strong>step</strong></span> through your program's statements one at a
time.</p><p>Note that you may specify additional arguments to the
<span class="command"><strong>run</strong></span> command to provide command-line arguments to
your program.  These two cases are the same as far as your program is
concerned:</p><div class="example"><a name="gdb-cliargs"></a><p class="title"><b>Example 4.4. Debugging with command line arguments</b></p><div class="example-contents"><pre class="screen">
<code class="prompt">bash$</code> myprog -t foo --queue 47

<code class="prompt">bash$</code> gdb myprog
<code class="prompt">(gdb)</code> run -t foo --queue 47
</pre></div></div><br class="example-break"></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dll"></a>Building and Using DLLs</h2></div></div></div><p>DLLs are Dynamic Link Libraries, which means that they're linked
into your program at run time instead of build time.  There are three
parts to a DLL:</p><div class="itemizedlist"><ul type="disc" compact><li><p> the exports </p></li><li><p> the code and data </p></li><li><p> the import library </p></li></ul></div><p>The code and data are the parts you write - functions,
variables, etc.  All these are merged together, like if you were
building one big object files, and put into the dll.  They are not
put into your .exe at all.</p><p>The exports contains a list of functions and variables that the
dll makes available to other programs.  Think of this as the list of
"global" symbols, the rest being hidden.  Normally, you'd create this
list by hand with a text editor, but it's possible to do it
automatically from the list of functions in your code.  The
<code class="filename">dlltool</code> program creates the exports section of
the dll from your text file of exported symbols.</p><p>The import library is a regular UNIX-like
<code class="filename">.a</code> library, but it only contains the tiny bit of
information needed to tell the OS how your program interacts with
("imports") the dll.  This information is linked into your
<code class="filename">.exe</code>.  This is also generated by
<code class="filename">dlltool</code>.</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dll-build"></a>Building DLLs</h3></div></div></div><p>This page gives only a few simple examples of gcc's DLL-building 
capabilities. To begin an exploration of the many additional options,
see the gcc documentation and website, currently at 
<a class="ulink" href="http://gcc.gnu.org/" target="_top">http://gcc.gnu.org/</a>
</p><p>Let's go through a simple example of how to build a dll.
For this example, we'll use a single file
<code class="filename">myprog.c</code> for the program
(<code class="filename">myprog.exe</code>) and a single file
<code class="filename">mydll.c</code> for the contents of the dll
(<code class="filename">mydll.dll</code>).</p><p>Fortunately, with the latest gcc and binutils the process for building a dll
is now pretty simple. Say you want to build this minimal function in mydll.c:</p><pre class="screen">
#include &lt;stdio.h&gt;

int
hello()
{
  printf ("Hello World!\n");
}  
</pre><p>First compile mydll.c to object code:</p><pre class="screen">gcc -c mydll.c</pre><p>Then, tell gcc that it is building a shared library:</p><pre class="screen">gcc -shared -o mydll.dll mydll.o</pre><p>
That's it! To finish up the example, you can now link to the
dll with a simple program:
</p><pre class="screen">
int 
main ()
{
  hello ();
}  
</pre><p>
Then link to your dll with a command like:
</p><pre class="screen">gcc -o myprog myprog.c -L./ -lmydll</pre><p>However, if you are building a dll as an export library,
you will probably want to use the complete syntax:</p><pre class="screen">gcc -shared -o cyg${module}.dll \
    -Wl,--out-implib=lib${module}.dll.a \
    -Wl,--export-all-symbols \
    -Wl,--enable-auto-import \
    -Wl,--whole-archive ${old_libs} \
    -Wl,--no-whole-archive ${dependency_libs}</pre><p>
The name of your library is <code class="literal">${module}</code>, prefixed with
<code class="literal">cyg</code> for the DLL and <code class="literal">lib</code> for the
import library. Cygwin DLLs use the <code class="literal">cyg</code> prefix to 
differentiate them from native-Windows MinGW DLLs, see 
<a class="ulink" href="http://mingw.org" target="_top">the MinGW website</a> for more details.
<code class="literal">${old_libs}</code> are all
your object files, bundled together in static libs or single object
files and the <code class="literal">${dependency_libs}</code> are import libs you 
need to link against, e.g 
<strong class="userinput"><code>'-lpng -lz -L/usr/local/special -lmyspeciallib'</code></strong>.
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="dll-link"></a>Linking Against DLLs</h3></div></div></div><p>If you have an existing DLL already, you need to build a
Cygwin-compatible import library.  If you have the source to compile
the DLL, see <a class="xref" href="#dll-build" title="Building DLLs">the section called &#8220;Building DLLs&#8221;</a> for details on having 
<code class="filename">gcc</code> build one for you.  If you do not have the
source or a supplied working import library, you can get most of
the way by creating a .def file with these commands (you might need to
do this in <code class="filename">bash</code> for the quoting to work
correctly):</p><pre class="screen">
echo EXPORTS &gt; foo.def
nm foo.dll | grep ' T _' | sed 's/.* T _//' &gt;&gt; foo.def
</pre><p>Note that this will only work if the DLL is not stripped.
Otherwise you will get an error message: "No symbols in
foo.dll".</p><p>Once you have the <code class="filename">.def</code> file, you can create
an import library from it like this:</p><pre class="screen">
dlltool --def foo.def --dllname foo.dll --output-lib foo.a
</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="windres"></a>Defining Windows Resources</h2></div></div></div><p><code class="filename">windres</code> reads a Windows resource file
(<code class="filename">*.rc</code>) and converts it to a res or coff file.
The syntax and semantics of the input file are the same as for any
other resource compiler, so please refer to any publication describing
the Windows resource format for details.  Also, the
<code class="filename">windres</code> program itself is fully documented in the
Binutils manual.  Here's an example of using it in a project:</p><pre class="screen">

myapp.exe : myapp.o myapp.res
	gcc -mwindows myapp.o myapp.res -o $@

myapp.res : myapp.rc resource.h
	windres $&lt; -O coff -o $@

</pre><p>What follows is a quick-reference to the syntax
<code class="filename">windres</code> supports.</p><pre class="screen">

id ACCELERATORS suboptions
BEG
"^C" 12
"Q" 12
65 12
65 12 , VIRTKEY ASCII NOINVERT SHIFT CONTROL ALT
65 12 , VIRTKEY, ASCII, NOINVERT, SHIFT, CONTROL, ALT
(12 is an acc_id)
END

SHIFT, CONTROL, ALT require VIRTKEY


id BITMAP memflags "filename"
memflags defaults to MOVEABLE


id CURSOR memflags "filename"
memflags defaults to MOVEABLE,DISCARDABLE


id DIALOG memflags exstyle x,y,width,height styles BEG controls END
id DIALOGEX memflags exstyle x,y,width,height styles BEG controls END
id DIALOGEX memflags exstyle x,y,width,height,helpid styles BEG controls END

memflags defaults to MOVEABLE
exstyle may be EXSTYLE=number
styles:	CAPTION "string"
	CLASS id
	STYLE  FOO | NOT FOO | (12)
	EXSTYLE number
	FONT number, "name"
	FONT number, "name",weight,italic
	MENU id
	CHARACTERISTICS number
	LANGUAGE number,number
	VERSIONK number
controls:
	AUTO3STATE params
	AUTOCHECKBOX params
	AUTORADIOBUTTON params
	BEDIT params
	CHECKBOX params
	COMBOBOX params
	CONTROL ["name",] id, class, style, x,y,w,h [,exstyle] [data]
	CONTROL ["name",] id, class, style, x,y,w,h, exstyle, helpid [data]
	CTEXT params
	DEFPUSHBUTTON params
	EDITTEXT params
	GROUPBOX params
	HEDIT params
	ICON ["name",] id, x,y [data]
	ICON ["name",] id, x,y,w,h, style, exstyle [data]
	ICON ["name",] id, x,y,w,h, style, exstyle, helpid [data]
	IEDIT params
	LISTBOX params
	LTEXT params
	PUSHBOX params
	PUSHBUTTON params
	RADIOBUTTON params
	RTEXT params
	SCROLLBAR params
	STATE3 params
	USERBUTTON "string", id, x,y,w,h, style, exstyle
params:
	["name",] id, x, y, w, h, [data]
	["name",] id, x, y, w, h, style [,exstyle] [data]
	["name",] id, x, y, w, h, style, exstyle, helpid [data]

[data] is optional BEG (string|number) [,(string|number)] (etc) END


id FONT memflags "filename"
memflags defaults to MOVEABLE|DISCARDABLE

id ICON memflags "filename"
memflags defaults to MOVEABLE|DISCARDABLE

LANGUAGE num,num

id MENU options BEG items END
items:
	"string", id, flags
	SEPARATOR
	POPUP "string" flags BEG menuitems END
flags:
	CHECKED
	GRAYED
	HELP
	INACTIVE
	MENUBARBREAK
	MENUBREAK

id MENUEX suboptions BEG items END
items:
	MENUITEM "string"
	MENUITEM "string", id
	MENUITEM "string", id, type [,state]
	POPUP "string" BEG items END
	POPUP "string", id BEG items END
	POPUP "string", id, type BEG items END
	POPUP "string", id, type, state [,helpid] BEG items END

id MESSAGETABLE memflags "filename"
memflags defaults to MOVEABLE

id RCDATA suboptions BEG (string|number) [,(string|number)] (etc) END

STRINGTABLE suboptions BEG strings END
strings:
	id "string"
	id, "string"

(User data)
id id suboptions BEG (string|number) [,(string|number)] (etc) END

id VERSIONINFO stuffs BEG verblocks END
stuffs:	FILEVERSION num,num,num,num
	PRODUCTVERSION num,num,num,num
	FILEFLAGSMASK num
	FILEOS num
	FILETYPE num
	FILESUBTYPE num
verblocks:
	BLOCK "StringFileInfo" BEG BLOCK BEG vervals END END
	BLOCK "VarFileInfo" BEG BLOCK BEG vertrans END END
vervals: VALUE "foo","bar"
vertrans: VALUE num,num



suboptions:
	memflags
	CHARACTERISTICS num
	LANGUAGE num,num
	VERSIONK num

memflags are MOVEABLE/FIXED PURE/IMPURE PRELOAD/LOADONCALL DISCARDABLE

</pre></div></div></div></body></html>
