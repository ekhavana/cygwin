<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ANSI_X3.4-1968"><title>Programming Questions</title><link rel="stylesheet" href="docbook.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"><link rel="home" href="faq.html" title="Cygwin FAQ"><link rel="up" href="faq.html" title="Cygwin FAQ"><link rel="prev" href="faq.api.html" title="Cygwin API Questions"><link rel="next" href="faq.copyright.html" title="Copyright"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Programming Questions</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="faq.api.html">Prev</a>&#160;</td><th width="60%" align="center">&#160;</th><td width="20%" align="right">&#160;<a accesskey="n" href="faq.copyright.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="faq.programming"></a>Programming Questions</h2></div></div></div><div class="qandaset"><dl><dt>1. <a href="faq.programming.html#faq.programming.packages">How do I contribute a package?</a></dt><dt>2. <a href="faq.programming.html#faq.programming.contribute">How do I contribute to Cygwin?</a></dt><dt>3. <a href="faq.programming.html#faq.programming.huge-executables">Why are compiled executables so huge?!?</a></dt><dt>4. <a href="faq.programming.html#faq.programming.glibc">Where is glibc?</a></dt><dt>5. <a href="faq.programming.html#faq.programming.objective-c">Where is Objective C?</a></dt><dt>6. <a href="faq.programming.html#faq.programming.make-execvp">Why does my make fail on Cygwin with an execvp error? </a></dt><dt>7. <a href="faq.programming.html#faq.programming.ipc">How can I use IPC, or why do I get a Bad system call
error?</a></dt><dt>8. <a href="faq.programming.html#faq.programming.winmain">Why the undefined reference to WinMain@16?</a></dt><dt>9. <a href="faq.programming.html#faq.programming.win32-api">How do I use Win32 API calls?</a></dt><dt>10. <a href="faq.programming.html#faq.programming.win32-no-cygwin">How do I compile a Win32 executable that doesn't use Cygwin?</a></dt><dt>11. <a href="faq.programming.html#faq.programming.static-linking">Can I build a Cygwin program that does not require cygwin1.dll at runtime?</a></dt><dt>12. <a href="faq.programming.html#faq.programming.msvcrt-and-cygwin">Can I link with both MSVCRT*.DLL and cygwin1.dll?</a></dt><dt>13. <a href="faq.programming.html#faq.programming.no-console-window">How do I make the console window go away?</a></dt><dt>14. <a href="faq.programming.html#faq.programming.make-spaces">Why does make complain about a "missing separator"?</a></dt><dt>15. <a href="faq.programming.html#faq.programming.win32-headers">Why can't we redistribute Microsoft's Win32 headers?</a></dt><dt>16. <a href="faq.programming.html#faq.programming.msvs-mingw">How do I use cygwin1.dll with Visual Studio or MinGW?</a></dt><dt>17. <a href="faq.programming.html#faq.programming.linking-lib">How do I link against a .lib file?</a></dt><dt>18. <a href="faq.programming.html#faq.programming.building-cygwin">How do I build Cygwin on my own?</a></dt><dt>19. <a href="faq.programming.html#faq.programming.debugging-cygwin">I may have found a bug in Cygwin, how can I debug it (the symbols in gdb look funny)?</a></dt><dt>20. <a href="faq.programming.html#faq.programming.compiling-unsupported">How can I compile Cygwin for an unsupported platform (PowerPC, Alpha, ARM, Itanium)?</a></dt><dt>21. <a href="faq.programming.html#faq.programming.adjusting-heap">How can I adjust the heap/stack size of an application?</a></dt><dt>22. <a href="faq.programming.html#faq.programming.dll-cygcheck">How can I find out which DLLs are needed by an executable?</a></dt><dt>23. <a href="faq.programming.html#faq.programming.dll-building">How do I build a DLL?</a></dt><dt>24. <a href="faq.programming.html#faq.programming.breakpoint">How can I set a breakpoint at MainCRTStartup?</a></dt><dt>25. <a href="faq.programming.html#faq.programming.dll-relocatable">How can I build a relocatable dll?</a></dt><dt>26. <a href="faq.programming.html#faq.programming.debug">How can I debug what's going on?</a></dt><dt>27. <a href="faq.programming.html#faq.programming.system-trace">Can I use a system trace mechanism instead?</a></dt><dt>28. <a href="faq.programming.html#faq.programming.gdb-signals">Why doesn't gdb handle signals?</a></dt><dt>29. <a href="faq.programming.html#faq.programming.linker">The linker complains that it can't find something.</a></dt><dt>30. <a href="faq.programming.html#faq.programming.stat64">Why do I get an error using struct stat64?</a></dt><dt>31. <a href="faq.programming.html#faq.programming.undeclared-functions">I use a function I know is in the API, but I still get a link error.</a></dt><dt>32. <a href="faq.programming.html#faq.programming.libc">Can you make DLLs that are linked against libc ?</a></dt><dt>33. <a href="faq.programming.html#faq.programming.malloc-h">Where is malloc.h?</a></dt><dt>34. <a href="faq.programming.html#faq.programming.own-malloc">Can I use my own malloc?</a></dt><dt>35. <a href="faq.programming.html#faq.programming.msvc-gcc-objects">Can I mix objects compiled with msvc++ and gcc?</a></dt><dt>36. <a href="faq.programming.html#faq.programming.gdb-msvc">Can I use the gdb debugger to debug programs built by VC++?</a></dt><dt>37. <a href="faq.programming.html#faq.programming.x86-assembly">Where can I find info on x86 assembly?</a></dt><dt>38. <a href="faq.programming.html#faq.programming.make-scripts">Shell scripts aren't running properly from my makefiles?</a></dt><dt>39. <a href="faq.programming.html#faq.programming.preprocessor">What preprocessor macros do I need to know about?</a></dt><dt>40. <a href="faq.programming.html#faq.programming.unix-gui">How should I port my Unix GUI to Windows?</a></dt><dt>41. <a href="faq.programming.html#faq.programming.djgpp">Why not use DJGPP ?</a></dt></dl><table border="0" summary="Q and A Set"><col align="left" width="1%"><tbody><tr class="question"><td align="left" valign="top"><a name="faq.programming.packages"></a><p><b>1.</b></p></td><td align="left" valign="top"><p>How do I contribute a package?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If you are willing to be a package maintainer, great!  We urgently need
volunteers to prepare and maintain packages, because the priority of the
Cygwin Team is Cygwin itself.
</p><p>The Cygwin Package Contributor's Guide at
<a class="ulink" href="http://cygwin.com/setup.html" target="_top">http://cygwin.com/setup.html</a> details everything you need to know
about being a package maintainer. The quickest way to get started is to
read the <span class="emphasis"><em>Initial packaging procedure, script-based</em></span> section on
that page.  The <code class="literal">generic-build-script</code> found there works well for
most packages. 
</p><p>For questions about package maintenance, use the cygwin-apps mailing
list (start at <a class="ulink" href="http://cygwin.com/lists.html" target="_top">http://cygwin.com/lists.html</a>) <span class="emphasis"><em>after</em></span>
searching and browsing the cygwin-apps list archives, of course.  Be
sure to look at the <span class="emphasis"><em>Submitting a package</em></span> checklist at
<a class="ulink" href="http://cygwin.com/setup.html" target="_top">http://cygwin.com/setup.html</a> before sending an ITP (Intent To
Package) email to cygwin-apps.
</p><p>You should also announce your intentions to the general cygwin list, in
case others were thinking the same thing.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.contribute"></a><p><b>2.</b></p></td><td align="left" valign="top"><p>How do I contribute to Cygwin?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If you want to contribute to Cygwin itself, see
<a class="ulink" href="http://cygwin.com/contrib.html" target="_top">http://cygwin.com/contrib.html</a>.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.huge-executables"></a><p><b>3.</b></p></td><td align="left" valign="top"><p>Why are compiled executables so huge?!?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>By default, gcc compiles in all symbols.  You'll also find that gcc
creates large executables on UNIX.
</p><p>If that bothers you, just use the 'strip' program, part of the binutils
package.  Or compile with the <code class="literal">-s</code> option to gcc.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.glibc"></a><p><b>4.</b></p></td><td align="left" valign="top"><p>Where is glibc?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Cygwin does not provide glibc.  It uses newlib instead, which provides
much (but not all) of the same functionality.  Porting glibc to Cygwin
would be difficult.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.objective-c"></a><p><b>5.</b></p></td><td align="left" valign="top"><p>Where is Objective C?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Objective C hasn't been distributed with the Cygwin version of gcc
for a long time.  For several reason Cygwin was stuck with gcc version 3.4.4.
Fortunately the latest gcc maintainer is quite busy to create a working
gcc 4.x release which also comes with an Objective C package.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.make-execvp"></a><p><b>6.</b></p></td><td align="left" valign="top"><p>Why does my make fail on Cygwin with an execvp error? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>First of all, if you are using <code class="literal">make -j[N]</code>, then stop.  It doesn't
work well. Also beware of using non-portable shell features in your
Makefiles (see tips at <a class="ulink" href="http://cygwin.com/1.7/faq/faq.using.html#faq.using.shell-scripts" target="_top">http://cygwin.com/1.7/faq/faq.using.html#faq.using.shell-scripts</a>).
</p><p>Errors of <code class="literal">make: execvp: /bin/sh: Illegal Argument</code> or 
<code class="literal">make: execvp: /bin/sh: Argument list too long</code> are often
caused by the command-line being to long for the Windows execution model.
To circumvent this, mount the path of the executable using the -X switch
to enable cygexec for all executables in that folder; you will also need
to exclude non-cygwin executables with the -x switch. Enabling cygexec
causes cygwin executables to talk directly to one another, which increases
the command-line limit. To enable cygexec for <code class="literal">/bin</code> and 
<code class="literal">/usr/bin</code>, you can add or change these entries in /etc/fstab:
</p><pre class="screen">
C:/cygwin/bin /bin ntfs binary,cygexec 0 0
C:/cygwin/bin /usr/bin ntfs binary,cygexec 0 0
</pre><p>Note that if you have Tcl/Tk installed, you must additionally
exclude <code class="literal">tclsh84</code> and <code class="literal">wish84</code>, which
are linked to the Cygwin DLL but are not actually Cygwin programs:
</p><pre class="screen">
C:/cygwin/bin/tclsh84.exe /bin/tclsh84.exe ntfs binary,notexec 0 0
C:/cygwin/bin/tclsh84.exe /usr/bin/tclsh84.exe ntfs binary,notexec 0 0
C:/cygwin/bin/wish84.exe /bin/wish84.exe ntfs binary,notexec 0 0
C:/cygwin/bin/wish84.exe /usr/bin/wish84.exe ntfs binary,notexec 0 0
</pre><p>If you have added other non-Cygwin programs to a path you want to mount
cygexec, you can find them with a script like this:
</p><pre class="screen">
#!/bin/sh
cd /bin; for f in `find . -type f -name '*.exe'`; do
	cygcheck $f | (fgrep -qi cygwin1.dll || echo $f)
done
</pre><p>
See <a class="ulink" href="http://cygwin.com/1.7/cygwin-ug-net/using.html#mount-table" target="_top">http://cygwin.com/1.7/cygwin-ug-net/using.html#mount-table</a> 
for more information on using mount.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.ipc"></a><p><b>7.</b></p></td><td align="left" valign="top"><p>How can I use IPC, or why do I get a <code class="literal">Bad system call</code>
error?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>
Try running cygserver.  Read 
<a class="ulink" href="http://cygwin.com/1.7/cygwin-ug-net/using-cygserver.html" target="_top">http://cygwin.com/1.7/cygwin-ug-net/using-cygserver.html</a>. If you're
trying to use PostgreSQL, also read 
<code class="literal">/usr/share/doc/Cygwin/postgresql-*.README</code>.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.winmain"></a><p><b>8.</b></p></td><td align="left" valign="top"><p>Why the undefined reference to <code class="literal">WinMain@16</code>?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If you're using <code class="literal">gcc</code>, try adding an empty main() function to one
of your sources.  Or, perhaps you have <code class="literal">-lm</code> too early in the
link command line.  It should be at the end:
</p><pre class="screen">
    bash$ gcc hello.c -lm
    bash$ ./a.exe
    Hello World!
</pre><p>works, but
</p><pre class="screen">
    bash$  gcc -lm hello.c
    /c/TEMP/ccjLEGlU.o(.text+0x10):hello.c: multiple definition of `main'
    /usr/lib/libm.a(libcmain.o)(.text+0x0):libcmain.c: first defined here
    /usr/lib/libm.a(libcmain.o)(.text+0x6a):libcmain.c: undefined reference to `WinMain@16'
    collect2: ld returned 1 exit status
</pre><p>If you're using GCJ, you need to pass a "--main" flag:
</p><pre class="screen">
gcj --main=Hello Hello.java
</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.win32-api"></a><p><b>9.</b></p></td><td align="left" valign="top"><p>How do I use Win32 API calls?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>It's pretty simple actually.  Cygwin tools require that you explicitly
link the import libraries for whatever Win32 API functions that you
are going to use, with the exception of kernel32, which is linked
automatically (because the startup and/or built-in code uses it).
</p><p>For example, to use graphics functions (GDI) you must link
with gdi32 like this:
</p><p>gcc -o foo.exe foo.o bar.o -lgdi32
</p><p>or (compiling and linking in one step):
</p><p>gcc -o foo.exe foo.c bar.c -lgdi32
</p><p>The regular setup allows you to use the option -mwindows on the
command line to include a set of the basic libraries (and also
make your program a GUI program instead of a console program),
including user32, gdi32 and, IIRC, comdlg32.
</p><p>It is a good idea to put import libraries last on your link line,
or at least after all the object files and static libraries that reference them.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.win32-no-cygwin"></a><p><b>10.</b></p></td><td align="left" valign="top"><p>How do I compile a Win32 executable that doesn't use Cygwin?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><span class="bold"><strong>(Please note: This section has not yet been updated for the latest net release.)</strong></span>
</p><p>The -mno-cygwin flag to gcc makes gcc link against standard Microsoft
DLLs instead of Cygwin.  This is desirable for native Windows programs
that don't need a UNIX emulation layer.
</p><p>This is not to be confused with 'MinGW' (Minimalist GNU for Windows),
which is a completely separate effort.  That project's home page is
<a class="ulink" href="http://www.mingw.org/index.shtml" target="_top">http://www.mingw.org/index.shtml</a>.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.static-linking"></a><p><b>11.</b></p></td><td align="left" valign="top"><p>Can I build a Cygwin program that does not require cygwin1.dll at runtime?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>No.  If your program uses the Cygwin API, then your executable cannot
run without cygwin1.dll.  In particular, it is not possible to
statically link with a Cygwin library to obtain an independent,
self-contained executable.
</p><p>If this is an issue because you intend to distribute your Cygwin
application, then you had better read and understand
<a class="ulink" href="http://cygwin.com/licensing.html" target="_top">http://cygwin.com/licensing.html</a>, which explains the licensing
options.  Unless you purchase a special commercial license from Red
Hat, then your Cygwin application must be Open Source.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.msvcrt-and-cygwin"></a><p><b>12.</b></p></td><td align="left" valign="top"><p>Can I link with both MSVCRT*.DLL and cygwin1.dll?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>No, you must use one or the other, they are mutually exclusive.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.no-console-window"></a><p><b>13.</b></p></td><td align="left" valign="top"><p>How do I make the console window go away?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>The default during compilation is to produce a console application.
It you are writing a GUI program, you should either compile with
-mwindows as explained above, or add the string
"-Wl,--subsystem,windows" to the GCC command line.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.make-spaces"></a><p><b>14.</b></p></td><td align="left" valign="top"><p>Why does make complain about a "missing separator"?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>This problem usually occurs as a result of someone editing a Makefile
with a text editor that replaces tab characters with spaces.  Command
lines must start with tabs.  This is not specific to Cygwin.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.win32-headers"></a><p><b>15.</b></p></td><td align="left" valign="top"><p>Why can't we redistribute Microsoft's Win32 headers?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Subsection 2.d.f of the `Microsoft Open Tools License agreement' looks
like it says that one may not "permit further redistribution of the
Redistributables to their end users".  We take this to mean that we can
give them to you, but you can't give them to anyone else, which is
something that we can't agree to.  Fortunately, we
have our own Win32 headers which are pretty complete.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.msvs-mingw"></a><p><b>16.</b></p></td><td align="left" valign="top"><p>How do I use <code class="literal">cygwin1.dll</code> with Visual Studio or MinGW?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Before you begin, note that Cygwin is licensed under the GNU GPL (as
indeed are many other Cygwin-based libraries).  That means that if your
code links against the Cygwin dll (and if your program is calling
functions from Cygwin, it must, as a matter of fact, be linked against
it), you must apply the GPL to your source as well.  Of course, this
only matters if you plan to distribute your program in binary form.  For
more information, see <a class="ulink" href="http://gnu.org/licenses/gpl-faq.html" target="_top">http://gnu.org/licenses/gpl-faq.html</a>.  If
that is not a problem, read on.
</p><p>If you want to load the DLL dynamically, read
<code class="literal">winsup/cygwin/how-cygtls-works.txt</code> and the sample code in
<code class="literal">winsup/testsuite/cygload</code> to understand how this works.
The short version is:
</p><div class="orderedlist"><ol type="1"><li><p>Make sure you have 4K of scratch space at the bottom of your stack.
</p></li><li><p>Invoke <code class="literal">cygwin_dll_init()</code>:
</p><pre class="screen">
HMODULE h = LoadLibrary("cygwin1.dll");
void (*init)() = GetProcAddress(h, "cygwin_dll_init");
init();
</pre><p>
</p></li></ol></div><p>If you want to link statically from Visual Studio, to my knowledge
none of the Cygwin developers have done this, but we have this report
from the mailing list that it can be done this way:
</p><div class="orderedlist"><ol type="1"><li><p>Use the impdef program to generate a .def file for the cygwin1.dll
(if you build the cygwin dll from source, you will already have a def
file)
</p><pre class="screen">
impdef cygwin1.dll &gt; cygwin1.def
</pre></li><li><p>Use the MS VS linker (lib) to generate an import library
</p><pre class="screen">
lib /def=cygwin1.def /out=cygwin1.lib
</pre></li><li><p>Create a file "my_crt0.c" with the following contents
</p><pre class="screen">
#include &lt;sys/cygwin.h&gt;
#include &lt;stdlib.h&gt;

typedef int (*MainFunc) (int argc, char *argv[], char **env);

void
  my_crt0 (MainFunc f)
  {
    cygwin_crt0(f);
  }
</pre></li><li><p>Use gcc in a Cygwin prompt to build my_crt0.c into a DLL
       (e.g. my_crt0.dll). Follow steps 1 and 2 to generate .def and
       .lib files for the DLL.
</p></li><li><p>Download crt0.c from the cygwin website and include it in
       your sources. Modify it to call my_crt0() instead of
       cygwin_crt0().  
</p></li><li><p>Build your object files using the MS VC compiler cl.
</p></li><li><p>Link your object files, cygwin1.lib, and my_crt0.lib (or
       whatever you called it) into the executable.
</p></li></ol></div><p>Note that if you are using any other Cygwin based libraries
that you will probably need to build them as DLLs using gcc and
then generate import libraries for the MS VC linker.
</p><p>Thanks to Alastair Growcott (alastair dot growcott at bakbone dot co
dot uk) for this tip.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.linking-lib"></a><p><b>17.</b></p></td><td align="left" valign="top"><p>How do I link against a <code class="literal">.lib</code> file?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If your <code class="literal">.lib</code> file is a normal static or import library with
C-callable entry points, you can list <code class="literal">foo.lib</code> as an object file for
gcc/g++, just like any <code class="literal">*.o</code> file. Otherwise, here are some steps:
</p><div class="orderedlist"><ol type="1"><li><p>Build a C file with a function table.  Put all functions you intend
to use in that table.  This forces the linker to include all the object
files from the .lib.  Maybe there is an option to force LINK.EXE to
include an object file.
</p></li><li><p>Build a dummy 'LibMain'.
</p></li><li><p>Build a .def with all the exports you need.
</p></li><li><p>Link with your .lib using link.exe.
</p></li></ol></div><p>or
</p><div class="orderedlist"><ol type="1"><li><p>Extract all the object files from the .lib using LIB.EXE.
</p></li><li><p>Build a dummy C file referencing all the functions you need, either
      with a direct call or through an initialized function pointer.
</p></li><li><p>Build a dummy LibMain.
</p></li><li><p>Link all the objects with this file+LibMain.
</p></li><li><p>Write a .def.
</p></li><li><p>Link.
</p></li></ol></div><p>You can use these methods to use MSVC (and many other runtime libs)
with Cygwin development tools.
</p><p>Note that this is a lot of work (half a day or so), but much less than
rewriting the runtime library in question from specs...
</p><p>Thanks to Jacob Navia (root at jacob dot remcomp dot fr) for this explanation.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.building-cygwin"></a><p><b>18.</b></p></td><td align="left" valign="top"><p>How do I build Cygwin on my own?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>First, you need to make sure you have the necessary build tools
installed; you at least need <code class="literal">gcc</code>, <code class="literal">make</code>, 
<code class="literal">perl</code>, and <code class="literal">cocom</code>. If you want to run 
the tests, <code class="literal">dejagnu</code> is also required.
Normally, building ignores any errors in building the documentation,
which requires the <code class="literal">docbook-xml42</code>, <code class="literal">docbook-xsl</code>, and
<code class="literal">xmlto</code> packages.  For more information on building the
documentation, see the README included in the <code class="literal">cygwin-doc</code> package.
</p><p>Next, get the Cygwin source.  Ideally, you should check out
what you need from CVS (<a class="ulink" href="http://cygwin.com/cvs.html" target="_top">http://cygwin.com/cvs.html</a>).  This is the
<span class="emphasis"><em>preferred method</em></span> for acquiring the sources.  Otherwise, if
you are trying to duplicate a cygwin release then you should 
download the corresponding source package
(<code class="literal">cygwin-x.y.z-n-src.tar.bz2</code>). </p><p>You <span class="emphasis"><em>must</em></span> build cygwin in a separate directory from
the source, so create something like a <code class="literal">build/</code> directory.
Assuming you checked out the source in <code class="literal">/oss/src/</code>, and you
also want to install to the temporary location <code class="literal">install</code>:
</p><pre class="screen">
mkdir /oss/build
mkdir /oss/install 
cd build
(/oss/src/configure --prefix=/oss/install -v; make) &gt;&amp; make.out
make install &gt; install.log 2&gt;&amp;1
</pre><p>To check a cygwin1.dll, run "make check" in the build/i?86*cygwin/winsup
directory created after running make above.
If that works, install everything <span class="emphasis"><em>except</em></span> the dll (if
you can).  Then, close down all cygwin programs (including bash windows,
inetd, etc.), save your old dll, and copy the new dll to the correct
place.  Then start up a bash window, or  run a cygwin program from the
Windows command prompt, and see what happens.
</p><p>If you get the error "shared region is corrupted" it means that two
different versions of cygwin1.dll are running on your machine at the
same time. Remove all but one. 
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.debugging-cygwin"></a><p><b>19.</b></p></td><td align="left" valign="top"><p>I may have found a bug in Cygwin, how can I debug it (the symbols in gdb look funny)?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Debugging symbols are stripped from distibuted Cygwin binaries, so any
symbols that you see in gdb are basically meaningless. It is also a good
idea to use the latest code in case the bug has been fixed, so we
recommend trying the latest snapshot from
<a class="ulink" href="http://cygwin.com/snapshots/" target="_top">http://cygwin.com/snapshots/</a> or building the DLL from CVS.
</p><p>To build a debugging version of the Cygwin DLL, you will need to follow
the instructions at <a class="ulink" href="http://cygwin.com/1.7/faq/faq-nochunks.html#faq.programming.building-cygwin" target="_top">http://cygwin.com/1.7/faq/faq-nochunks.html#faq.programming.building-cygwin</a>. 
You can also contact the mailing list for pointers (a simple test case that 
demonstrates the bug is always welcome).  
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.compiling-unsupported"></a><p><b>20.</b></p></td><td align="left" valign="top"><p>How can I compile Cygwin for an unsupported platform (PowerPC, Alpha, ARM, Itanium)?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Unfortunately, this will be difficult.  Exception handling and signals
support semantics and args have been designed for x86 so you would need
to write specific support for your platform.  We don't know of any other
incompatibilities. Please send us patches if you do this work!
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.adjusting-heap"></a><p><b>21.</b></p></td><td align="left" valign="top"><p>How can I adjust the heap/stack size of an application?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If you need to change the maximum amount of memory available to Cygwin, see
<a class="ulink" href="http://cygwin.com/1.7/cygwin-ug-net/setup-maxmem.html" target="_top">http://cygwin.com/1.7/cygwin-ug-net/setup-maxmem.html</a>. Otherwise,
just pass heap/stack linker arguments to gcc.  To create foo.exe with
a heap size of 200MB and a stack size of 8MB, you would invoke
gcc as:
</p><p><code class="literal">gcc -Wl,--heap,200000000,--stack,8000000 -o foo foo.c</code>
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.dll-cygcheck"></a><p><b>22.</b></p></td><td align="left" valign="top"><p>How can I find out which DLLs are needed by an executable?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><code class="literal">objdump -p</code> provides this information, but is rather verbose.
</p><p><code class="literal">cygcheck</code> will do this much more concisely, and operates
recursively, provided the command is in your path.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.dll-building"></a><p><b>23.</b></p></td><td align="left" valign="top"><p>How do I build a DLL?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>There's documentation that explains the process in the Cygwin User's
Guide here: <a class="ulink" href="http://cygwin.com/1.7/cygwin-ug-net/dll.html" target="_top">http://cygwin.com/1.7/cygwin-ug-net/dll.html</a>
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.breakpoint"></a><p><b>24.</b></p></td><td align="left" valign="top"><p>How can I set a breakpoint at MainCRTStartup?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><span class="bold"><strong>(Please note: This section has not yet been updated for the latest net release.)</strong></span>
</p><p>Set a breakpoint at *0x401000 in gdb and then run the program in
question.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.dll-relocatable"></a><p><b>25.</b></p></td><td align="left" valign="top"><p>How can I build a relocatable dll?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><span class="bold"><strong>(Please note: This section has not yet been updated for the latest net release.  However, there was a discussion on the cygwin mailing list once that addresses this issue.  Read <a class="ulink" href="http://cygwin.com/ml/cygwin/2000-06/msg00688.html" target="_top">http://cygwin.com/ml/cygwin/2000-06/msg00688.html</a> and related messages.)</strong></span>
</p><p>You must execute the following sequence of five commands, in this
order:
</p><pre class="screen">
$(LD) -s --base-file BASEFILE --dll -o DLLNAME OBJS LIBS -e ENTRY

$(DLLTOOL) --as=$(AS) --dllname DLLNAME --def DEFFILE \
        --base-file BASEFILE --output-exp EXPFILE

$(LD) -s --base-file BASEFILE EXPFILE -dll -o DLLNAME OBJS LIBS -e ENTRY

$(DLLTOOL) --as=$(AS) --dllname DLLNAME --def DEFFILE \
	--base-file BASEFILE --output-exp EXPFILE

$(LD) EXPFILE --dll -o DLLNAME OBJS LIBS -e ENTRY
</pre><p>In this example, $(LD) is the linker, ld.
</p><p>$(DLLTOOL) is dlltool.
</p><p>$(AS) is the assembler, as.
</p><p>DLLNAME is the name of the DLL you want to create, e.g., tcl80.dll.
</p><p>OBJS is the list of object files you want to put into the DLL.
</p><p>LIBS is the list of libraries you want to link the DLL against.  For
example, you may or may not want -lcygwin.  You may want -lkernel32.
Tcl links against -lcygwin -ladvapi32 -luser32 -lgdi32 -lcomdlg32
-lkernel32.
</p><p>DEFFILE is the name of your definitions file.  A simple DEFFILE would
consist of ``EXPORTS'' followed by a list of all symbols which should
be exported from the DLL.  Each symbol should be on a line by itself.
Other programs will only be able to access the listed symbols.
</p><p>BASEFILE is a temporary file that is used during this five stage
process, e.g., tcl.base.
</p><p>EXPFILE is another temporary file, e.g., tcl.exp.
</p><p>ENTRY is the name of the function which you want to use as the entry
point.  This function should be defined using the WINAPI attribute,
and should take three arguments:
        int WINAPI startup (HINSTANCE, DWORD, LPVOID)
</p><p>This means that the actual symbol name will have an appended @12, so if
your entry point really is named <code class="literal">startup</code>, the string you should
use for ENTRY in the above examples would be <code class="literal">startup@12</code>.
</p><p>If your DLL calls any Cygwin API functions, the entry function will need
to initialize the Cygwin impure pointer.  You can do that by declaring
a global variable <code class="literal">_impure_ptr</code>, and then initializing it in the
entry function.  Be careful not to export the global variable
<code class="literal">_impure_ptr</code> from your DLL; that is, do not put it in DEFFILE.
</p><pre class="screen">
/* This is a global variable.  */
struct _reent *_impure_ptr;
extern struct _reent *__imp_reent_data;

int entry (HINSTANT hinst, DWORD reason, LPVOID reserved)
{
  _impure_ptr = __imp_reent_data;
  /* Whatever else you want to do.  */
}
</pre><p>You may put an optional `--subsystem windows' on the $(LD) lines.  The
Tcl build does this, but I admit that I no longer remember whether
this is important.  Note that if you specify a --subsytem &lt;x&gt; flag to ld,
the -e entry must come after the subsystem flag, since the subsystem flag
sets a different default entry point.
</p><p>You may put an optional `--image-base BASEADDR' on the $(LD) lines.
This will set the default image base.  Programs using this DLL will
start up a bit faster if each DLL occupies a different portion of the
address space.  Each DLL starts at the image base, and continues for
whatever size it occupies.
</p><p>Now that you've built your DLL, you may want to build a library so
that other programs can link against it.  This is not required: you
could always use the DLL via LoadLibrary.  However, if you want to be
able to link directly against the DLL, you need to create a library.
Do that like this:
</p><p>$(DLLTOOL) --as=$(AS) --dllname DLLNAME --def DEFFILE --output-lib LIBFILE
</p><p>$(DLLTOOL), $(AS), DLLNAME, and DEFFILE are the same as above.  Make
sure you use the same DLLNAME and DEFFILE, or things won't work right.
</p><p>LIBFILE is the name of the library you want to create, e.g.,
libtcl80.a.  You can then link against that library using something
like -ltcl80 in your linker command.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.debug"></a><p><b>26.</b></p></td><td align="left" valign="top"><p>How can I debug what's going on?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>You can debug your application using <code class="literal">gdb</code>.  Make sure you
compile it with the -g flag!  If your application calls functions in
MS DLLs, gdb will complain about not being able to load debug information
for them when you run your program.  This is normal since these DLLs
don't contain debugging information (and even if they did, that debug
info would not be compatible with gdb).
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.system-trace"></a><p><b>27.</b></p></td><td align="left" valign="top"><p>Can I use a system trace mechanism instead?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Yes.  You can use the <code class="literal">strace.exe</code> utility to run other cygwin
programs with various debug and trace messages enabled.  For information
on using <code class="literal">strace</code>, see the Cygwin User's Guide or the file
<code class="literal">winsup/utils/utils.sgml</code> in the Cygwin sources.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.gdb-signals"></a><p><b>28.</b></p></td><td align="left" valign="top"><p>Why doesn't gdb handle signals?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Unfortunately, there is only minimal signal handling support in gdb
currently.  Signal handling only works with Windows-type signals.
SIGINT may work, SIGFPE may work, SIGSEGV definitely does.  You cannot
'stop', 'print' or 'nopass' signals like SIGUSR1 or SIGHUP to the
process being debugged.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.linker"></a><p><b>29.</b></p></td><td align="left" valign="top"><p>The linker complains that it can't find something.</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>A common error is to put the library on the command line before
the thing that needs things from it.
</p><p>This is wrong <code class="literal">gcc -lstdc++ hello.cc</code>.
This is right <code class="literal">gcc hello.cc -lstdc++</code>.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.stat64"></a><p><b>30.</b></p></td><td align="left" valign="top"><p>Why do I get an error using <code class="literal">struct stat64</code>?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><code class="literal">struct stat64</code> is not used in Cygwin, just
use <code class="literal">struct stat</code>.  It's 64 bit aware.</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.undeclared-functions"></a><p><b>31.</b></p></td><td align="left" valign="top"><p>I use a function I know is in the API, but I still get a link error.</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>The function probably isn't declared in the header files, or
the UNICODE stuff for it isn't filled in.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.libc"></a><p><b>32.</b></p></td><td align="left" valign="top"><p>Can you make DLLs that are linked against libc ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Yes.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.malloc-h"></a><p><b>33.</b></p></td><td align="left" valign="top"><p>Where is malloc.h?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>It exists, but you should rather include stdlib.h instead of malloc.h.
stdlib.h is POSIX standard for defining malloc and friends, malloc.h is
definitely non-standard.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.own-malloc"></a><p><b>34.</b></p></td><td align="left" valign="top"><p>Can I use my own malloc?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If you define a function called <code class="literal">malloc</code> in your own code, and link
with the DLL, the DLL <span class="emphasis"><em>will</em></span> call your <code class="literal">malloc</code>.  Needless to
say, you will run into serious problems if your malloc is buggy.
</p><p>If you run any programs from the DOS command prompt, rather than from in
bash, the DLL will try and expand the wildcards on the command line.
This process uses <code class="literal">malloc</code> <span class="emphasis"><em>before</em></span> your main line is started.
If you have written your own <code class="literal">malloc</code> to need some initialization
to occur after <code class="literal">main</code> is called, then this will surely break.
</p><p>Moreover, there is an outstanding issue with <code class="literal">_malloc_r</code> in
<code class="literal">newlib</code>.  This re-entrant version of <code class="literal">malloc</code> will be called
directly from within <code class="literal">newlib</code>, by-passing your custom version, and
is probably incompatible with it.  But it may not be possible to replace
<code class="literal">_malloc_r</code> too, because <code class="literal">cygwin1.dll</code> does not export it and
Cygwin does not expect your program to replace it.  This is really a
newlib issue, but we are open to suggestions on how to deal with it.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.msvc-gcc-objects"></a><p><b>35.</b></p></td><td align="left" valign="top"><p>Can I mix objects compiled with msvc++ and gcc?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Yes, but only if you are combining C object files.  MSVC C++ uses a
different mangling scheme than GNU C++, so you will have difficulties
combining C++ objects.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.gdb-msvc"></a><p><b>36.</b></p></td><td align="left" valign="top"><p>Can I use the gdb debugger to debug programs built by VC++?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>No, not for full (high level source language) debugging.
The Microsoft compilers generate a different type of debugging
symbol information, which gdb does not understand.
</p><p>However, the low-level (assembly-type) symbols generated by
Microsoft compilers are coff, which gdb DOES understand.
Therefore you should at least be able to see all of your
global symbols; you just won't have any information about
data types, line numbers, local variables etc.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.x86-assembly"></a><p><b>37.</b></p></td><td align="left" valign="top"><p>Where can I find info on x86 assembly?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>CPU reference manuals for Intel's current chips are available in
downloadable PDF form on Intel's web site:
</p><p><a class="ulink" href="http://developer.intel.com/" target="_top">http://developer.intel.com/</a>
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.make-scripts"></a><p><b>38.</b></p></td><td align="left" valign="top"><p>Shell scripts aren't running properly from my makefiles?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If your scripts are in the current directory, you must have <code class="literal">.</code>
(dot) in your $PATH.  (It is not normally there by default.)  Better yet,
add /bin/sh in front of each and every shell script invoked in your Makefiles.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.preprocessor"></a><p><b>39.</b></p></td><td align="left" valign="top"><p>What preprocessor macros do I need to know about?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>gcc for Cygwin defines __CYGWIN__ when building for a Cygwin
environment.
</p><p>Microsoft defines the preprocessor symbol _WIN32 in their Windows
development environment.
</p><p>In gcc for Cygwin, _WIN32 is only defined when you use the -mwin32
gcc command line options.  This is because Cygwin is supposed to be a
POSIX emulation environment in the first place and defining _WIN32 confuses
some programs which think that they have to make special concessions for
a Windows environment which Cygwin handles automatically.
</p><p>Check out the predefined symbols in detail by running, for example
</p><pre class="screen">
       $ gcc  -dM -E -xc /dev/null &gt;gcc.txt
       $ gcc -mwin32 -dM -E -xc /dev/null &gt;gcc-mwin32.txt
</pre><p>Then use the diff and grep utilities to check what the difference is.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.unix-gui"></a><p><b>40.</b></p></td><td align="left" valign="top"><p>How should I port my Unix GUI to Windows?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>There are two basic strategies for porting Unix GUIs to Windows.
</p><p>The first is to use a portable graphics library such as tcl/tk, X11, or
V (and others?).  Typically, you will end up with a GUI on Windows that
requires some runtime support.  With tcl/tk, you'll want to include the
necessary library files and the tcl/tk DLLs.  In the case of X11, you'll
need everyone using your program to have the X11 server installed.
</p><p>The second method is to rewrite your GUI using Win32 API calls (or MFC
with VC++).  If your program is written in a fairly modular fashion, you
may still want to use Cygwin if your program contains a lot of shared
(non-GUI-related) code.  That way you still gain some of the portability
advantages inherent in using Cygwin.
</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq.programming.djgpp"></a><p><b>41.</b></p></td><td align="left" valign="top"><p>Why not use DJGPP ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>DJGPP is a similar idea, but for DOS instead of Win32.  DJGPP uses a
"DOS extender" to provide a more reasonable operating interface for its
applications.   The Cygwin toolset doesn't have to do this since all of
the applications are native WIN32.   Applications compiled with the
Cygwin tools can access the Win32 API functions, so you can write
programs which use the Windows GUI.
</p><p>You can get more info on DJGPP by following
<a class="ulink" href="http://www.delorie.com/" target="_top">http://www.delorie.com/</a>.
</p></td></tr></tbody></table></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="faq.api.html">Prev</a>&#160;</td><td width="20%" align="center">&#160;</td><td width="40%" align="right">&#160;<a accesskey="n" href="faq.copyright.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Cygwin API Questions&#160;</td><td width="20%" align="center"><a accesskey="h" href="faq.html">Home</a></td><td width="40%" align="right" valign="top">&#160;Copyright</td></tr></table></div></body></html>
